import{j as e,f as q,a as Q,g as W,r as n,aW as X,aX as Z,aY as D,aZ as U,a_ as H}from"./index-7fa67d35.js";const E=({name:s,avatarUrl:a,teacher:l=!1})=>e.jsxs("div",{className:"flex items-center gap-3",children:[!l&&e.jsx("img",{src:a,alt:s,className:"w-8 h-8 rounded-full object-cover border border-gray-200"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:s})]}),J=({onView:s,onDisable:a,status:l})=>e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[l!=="disabled"&&e.jsx("button",{onClick:a,className:"p-2 rounded-md hover:bg-gray-100 text-[#344054] hover:text-red-700 transition font-inter font-semibold text-[14px] leading-[145%] tracking-[0%] text-center align-middle",title:"Disable",children:"Disable"}),e.jsx("button",{onClick:s,className:"p-2 rounded-md hover:bg-gray-100 text-[#9FC43E] hover:text-gray-800 transition font-inter font-semibold text-[14px] leading-[145%] tracking-[0%] text-center align-middle",title:"View",children:"View"})]}),ee=s=>{var i,d,b,c;const a=((i=s.name??`${s.firstname??""} ${s.lastname??""}`)==null?void 0:i.trim())||"—",l=`${((d=s.parent)==null?void 0:d.firstname)??""} ${((b=s.parent)==null?void 0:b.lastname)??""}`.trim()||"—";return{id:s.id,name:a,class:((c=s.class)==null?void 0:c.class_name)||"—",avatarUrl:s.image||"",teacher:{name:l,avatarUrl:""}}},te=({open:s,message:a,onConfirm:l,onCancel:i})=>s?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",role:"dialog","aria-modal":"true","aria-labelledby":"disable-student-title",children:e.jsxs("div",{className:"w-full max-w-md rounded-2xl bg-white shadow-2xl overflow-hidden",children:[e.jsx("div",{className:"bg-lime-500 px-5 py-3",children:e.jsx("h3",{id:"disable-student-title",className:"text-white text-base font-semibold",children:"Disable Student"})}),e.jsxs("div",{className:"px-6 py-5",children:[e.jsx("p",{className:"text-center text-gray-700 text-sm",children:a}),e.jsxs("div",{className:"mt-6 flex items-center justify-center gap-3",children:[e.jsx("button",{onClick:i,className:"rounded-full border border-gray-300 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:l,className:"rounded-full bg-lime-500 px-4 py-2 text-sm text-white hover:bg-lime-600",children:"Yes, disable student"})]})]})]})}):null,se=({open:s,message:a,onClose:l})=>s?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30",children:e.jsxs("div",{className:"bg-white w-full max-w-sm rounded-lg p-6 space-y-6 shadow-lg text-center",children:[e.jsx("p",{className:"text-gray-700 text-base",children:a}),e.jsx("button",{onClick:l,className:"mx-auto px-4 py-2 text-sm bg-green-600 text-white rounded-md hover:bg-green-700",children:"OK"})]})}):null,re=()=>{var _;const s=q(),a=Q(W),i=((((_=a==null?void 0:a.user)==null?void 0:_.role)||(a==null?void 0:a.role)||(a==null?void 0:a.user_type)||"")??"").toString().toLowerCase(),[d,b]=n.useState(""),[c,L]=n.useState("name"),[x,S]=n.useState(1),[o,w]=n.useState("active"),[O,C]=n.useState(1),[F,k]=n.useState(0),[P,T]=n.useState([]),[f,$]=n.useState(!1),[p,A]=n.useState(null),[K,j]=n.useState(!1),[V,M]=n.useState(!1),[u,z]=n.useState(null);n.useEffect(()=>{S(1)},[o]),n.useEffect(()=>{let t=!1;return(async()=>{var h;try{$(!0),A(null);const g=i==="schooladmin",v=i==="teacher";let m;if(g?m=await U(o,String(x)):v?m=await H(o,String(x)):m=await U(o,String(x)),t)return;const r=(h=m==null?void 0:m.data)==null?void 0:h.data,I=(r==null?void 0:r.records)??[];T(I.map(ee)),k((r==null?void 0:r.totalRecord)??0);const Y=r!=null&&r.number_pages&&r.number_pages>0?r.number_pages:Math.max(1,Math.ceil(((r==null?void 0:r.totalRecord)??0)/((r==null?void 0:r.record_per_page)??10)));C(Y)}catch(g){console.error("[Students] fetch error",g),t||(T([]),k(0),C(1),A("Failed to load students."))}finally{t||$(!1)}})(),()=>{t=!0}},[x,i,o]);const R=n.useMemo(()=>P.filter(t=>t.name.toLowerCase().includes(d.toLowerCase())),[P,d]),y=n.useMemo(()=>{const t=[...R];return t.sort((N,h)=>{const g=c==="teacher"?N.teacher.name:N[c]||"",v=c==="teacher"?h.teacher.name:h[c]||"";return String(g).localeCompare(String(v))}),t},[R,c]),B=t=>{z(t),j(!0)},G=()=>{j(!1),M(!0)};return e.jsxs("div",{className:"p-6 bg-white rounded-lg shadow space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h1",{className:"text-xl font-semibold",children:["Students"," ",e.jsx("span",{className:"ml-2 inline-block bg-green-100 text-green-600 text-sm px-2 py-0.5 rounded-full",children:F})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1 rounded-full bg-gray-100 p-1",children:[e.jsx("button",{type:"button",onClick:()=>w("active"),className:`rounded-full px-3 py-1 text-sm transition ${o==="active"?"bg-green-600 text-white":"text-gray-700 hover:bg-white"}`,children:"Active"}),e.jsx("button",{type:"button",onClick:()=>w("disabled"),className:`rounded-full px-3 py-1 text-sm transition ${o==="disabled"?"bg-green-600 text-white":"text-gray-700 hover:bg-white"}`,children:"Disabled"})]}),e.jsx(X,{value:d,onChange:b,placeholder:"Search here…"}),e.jsx(Z,{options:[{label:"Name",value:"name"},{label:"Class",value:"class"},{label:"Teacher",value:"teacher"}],value:c,onChange:t=>L(t)})]})]}),e.jsxs("table",{className:"w-full table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-sm text-gray-500 border-b",children:[e.jsx("th",{className:"py-2",children:"Student's Name"}),e.jsx("th",{className:"py-2",children:"Class"}),e.jsx("th",{className:"py-2",children:"Teacher's Name"}),e.jsx("th",{className:"py-2"})]})}),e.jsxs("tbody",{children:[f&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"py-10 text-center text-gray-500",children:"Loading students…"})}),!f&&p&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"py-10 text-center text-red-600",children:p})}),!f&&!p&&y.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"py-10 text-center text-gray-500",children:"No students found."})}),!f&&!p&&y.length>0&&y.map(t=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-3",children:e.jsx(E,{name:t.name,avatarUrl:t.avatarUrl})}),e.jsx("td",{className:"py-3 text-sm text-gray-600",children:t.class}),e.jsx("td",{className:"py-3",children:e.jsx(E,{name:t.teacher.name,avatarUrl:t.teacher.avatarUrl,teacher:!0})}),e.jsx("td",{className:"py-3 text-right",children:e.jsx(J,{status:o,onView:()=>s(`/schooldashboard/students/${t.id}`),onDisable:()=>B(t)})})]},t.id))]})]}),e.jsx(D,{currentPage:x,totalPages:O,onPageChange:S}),e.jsx(te,{open:K,message:`Are you sure you want to disable ${(u==null?void 0:u.name)??"this student"}?`,onCancel:()=>j(!1),onConfirm:G}),e.jsx(se,{open:V,message:u?`${u.name} disabled successfully!`:"Disabled",onClose:()=>M(!1)})]})};export{re as default};
