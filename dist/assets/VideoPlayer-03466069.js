import{f as Lr,a as di,g as ci,j as se,br as Kn,bs as Hn,R as Dt,r as At,bt as Wn,$ as ui,ct as Vn,cu as Yn,cQ as Xn,cA as zn,cB as qn,cs as $n,bg as Qn,cv as Zn,cw as Jn,a0 as fi,bh as ea,bi as ta,T as Ar,b4 as Yt,m as ra,bl as ia,J as Ot,M as Xt,x as na}from"./index-7fa67d35.js";import{N as br}from"./nexticon-3dad45ac.js";import{T as aa,C as sa,a as oa}from"./TabInReadingPage-f60bc204.js";import"./videoicon-372ef70a.js";const la=({lanType:H,title:Z,quiz:C})=>{var F,G;const O=Lr(),[L]=di(ci);return se.jsxs("div",{className:"py-4 pl-20 font-Recoleta content-nav text-[24px]  font-semibold items-center rounded-full bg-white gap-8 flex px-8",children:[se.jsxs("div",{className:"flex gap-3 cursor-pointer  ",onClick:()=>{O(`/${(L==null?void 0:L.role)==="user"?"parent":"school"}/languages`)},children:[se.jsx("span",{children:"African Languages"}),se.jsx("img",{loading:"lazy",src:br,alt:"nextIcon"})]}),se.jsxs("div",{className:`flex gap-3  cursor-pointer  ${Z?"text-black":"text-[#B5B5C3]"} `,onClick:()=>{O(`/${(L==null?void 0:L.role)==="user"?"parent":"school"}/languages`)},children:[se.jsx("span",{className:"",children:H&&((G=(F=H==null?void 0:H.split("-"))==null?void 0:F.join(" "))==null?void 0:G.charAt(0).toUpperCase())+H.slice(1)}),Z&&se.jsx("img",{loading:"lazy",src:br,alt:"nextIcon"})]}),se.jsxs("div",{className:`flex gap-3  cursor-pointer  ${C?"text-black":"text-[#B5B5C3]"}  `,children:[Z&&se.jsx("span",{children:Z}),C&&se.jsx("img",{loading:"lazy",src:br,alt:"nextIcon"})]}),se.jsx("div",{className:"flex gap-2  cursor-pointer  ",children:se.jsx("span",{children:C})})]})},ua="/assets/congrats-50b63c98.svg",fa="/assets/saveIcon-e3520faa.svg",da="/assets/shareIcon-2ff32580.svg";var hi={exports:{}};(function(H,Z){typeof window<"u"&&function(O,L){H.exports=L()}(Kn,function(){return function(C){var O={};function L(F){if(O[F])return O[F].exports;var G=O[F]={i:F,l:!1,exports:{}};return C[F].call(G.exports,G,G.exports,L),G.l=!0,G.exports}return L.m=C,L.c=O,L.d=function(F,G,A){L.o(F,G)||Object.defineProperty(F,G,{enumerable:!0,get:A})},L.r=function(F){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(F,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(F,"__esModule",{value:!0})},L.t=function(F,G){if(G&1&&(F=L(F)),G&8||G&4&&typeof F=="object"&&F&&F.__esModule)return F;var A=Object.create(null);if(L.r(A),Object.defineProperty(A,"default",{enumerable:!0,value:F}),G&2&&typeof F!="string")for(var q in F)L.d(A,q,(function(d){return F[d]}).bind(null,q));return A},L.n=function(F){var G=F&&F.__esModule?function(){return F.default}:function(){return F};return L.d(G,"a",G),G},L.o=function(F,G){return Object.prototype.hasOwnProperty.call(F,G)},L.p="/dist/",L(L.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(C,O,L){var F=Object.prototype.hasOwnProperty,G="~";function A(){}Object.create&&(A.prototype=Object.create(null),new A().__proto__||(G=!1));function q(E,S,I){this.fn=E,this.context=S,this.once=I||!1}function d(E,S,I,_,k){if(typeof I!="function")throw new TypeError("The listener must be a function");var N=new q(I,_||E,k),U=G?G+S:S;return E._events[U]?E._events[U].fn?E._events[U]=[E._events[U],N]:E._events[U].push(N):(E._events[U]=N,E._eventsCount++),E}function h(E,S){--E._eventsCount===0?E._events=new A:delete E._events[S]}function X(){this._events=new A,this._eventsCount=0}X.prototype.eventNames=function(){var S=[],I,_;if(this._eventsCount===0)return S;for(_ in I=this._events)F.call(I,_)&&S.push(G?_.slice(1):_);return Object.getOwnPropertySymbols?S.concat(Object.getOwnPropertySymbols(I)):S},X.prototype.listeners=function(S){var I=G?G+S:S,_=this._events[I];if(!_)return[];if(_.fn)return[_.fn];for(var k=0,N=_.length,U=new Array(N);k<N;k++)U[k]=_[k].fn;return U},X.prototype.listenerCount=function(S){var I=G?G+S:S,_=this._events[I];return _?_.fn?1:_.length:0},X.prototype.emit=function(S,I,_,k,N,U){var ee=G?G+S:S;if(!this._events[ee])return!1;var K=this._events[ee],V=arguments.length,te,ae;if(K.fn){switch(K.once&&this.removeListener(S,K.fn,void 0,!0),V){case 1:return K.fn.call(K.context),!0;case 2:return K.fn.call(K.context,I),!0;case 3:return K.fn.call(K.context,I,_),!0;case 4:return K.fn.call(K.context,I,_,k),!0;case 5:return K.fn.call(K.context,I,_,k,N),!0;case 6:return K.fn.call(K.context,I,_,k,N,U),!0}for(ae=1,te=new Array(V-1);ae<V;ae++)te[ae-1]=arguments[ae];K.fn.apply(K.context,te)}else{var ie=K.length,oe;for(ae=0;ae<ie;ae++)switch(K[ae].once&&this.removeListener(S,K[ae].fn,void 0,!0),V){case 1:K[ae].fn.call(K[ae].context);break;case 2:K[ae].fn.call(K[ae].context,I);break;case 3:K[ae].fn.call(K[ae].context,I,_);break;case 4:K[ae].fn.call(K[ae].context,I,_,k);break;default:if(!te)for(oe=1,te=new Array(V-1);oe<V;oe++)te[oe-1]=arguments[oe];K[ae].fn.apply(K[ae].context,te)}}return!0},X.prototype.on=function(S,I,_){return d(this,S,I,_,!1)},X.prototype.once=function(S,I,_){return d(this,S,I,_,!0)},X.prototype.removeListener=function(S,I,_,k){var N=G?G+S:S;if(!this._events[N])return this;if(!I)return h(this,N),this;var U=this._events[N];if(U.fn)U.fn===I&&(!k||U.once)&&(!_||U.context===_)&&h(this,N);else{for(var ee=0,K=[],V=U.length;ee<V;ee++)(U[ee].fn!==I||k&&!U[ee].once||_&&U[ee].context!==_)&&K.push(U[ee]);K.length?this._events[N]=K.length===1?K[0]:K:h(this,N)}return this},X.prototype.removeAllListeners=function(S){var I;return S?(I=G?G+S:S,this._events[I]&&h(this,I)):(this._events=new A,this._eventsCount=0),this},X.prototype.off=X.prototype.removeListener,X.prototype.addListener=X.prototype.on,X.prefixed=G,X.EventEmitter=X,C.exports=X},"./node_modules/url-toolkit/src/url-toolkit.js":function(C,O,L){(function(F){var G=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#.*)?$/,A=/^([^\/?#]*)(.*)$/,q=/(?:\/|^)\.(?=\/)/g,d=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,h={buildAbsoluteURL:function(X,E,S){if(S=S||{},X=X.trim(),E=E.trim(),!E){if(!S.alwaysNormalize)return X;var I=h.parseURL(X);if(!I)throw new Error("Error trying to parse base URL.");return I.path=h.normalizePath(I.path),h.buildURLFromParts(I)}var _=h.parseURL(E);if(!_)throw new Error("Error trying to parse relative URL.");if(_.scheme)return S.alwaysNormalize?(_.path=h.normalizePath(_.path),h.buildURLFromParts(_)):E;var k=h.parseURL(X);if(!k)throw new Error("Error trying to parse base URL.");if(!k.netLoc&&k.path&&k.path[0]!=="/"){var N=A.exec(k.path);k.netLoc=N[1],k.path=N[2]}k.netLoc&&!k.path&&(k.path="/");var U={scheme:k.scheme,netLoc:_.netLoc,path:null,params:_.params,query:_.query,fragment:_.fragment};if(!_.netLoc&&(U.netLoc=k.netLoc,_.path[0]!=="/"))if(!_.path)U.path=k.path,_.params||(U.params=k.params,_.query||(U.query=k.query));else{var ee=k.path,K=ee.substring(0,ee.lastIndexOf("/")+1)+_.path;U.path=h.normalizePath(K)}return U.path===null&&(U.path=S.alwaysNormalize?h.normalizePath(_.path):_.path),h.buildURLFromParts(U)},parseURL:function(X){var E=G.exec(X);return E?{scheme:E[1]||"",netLoc:E[2]||"",path:E[3]||"",params:E[4]||"",query:E[5]||"",fragment:E[6]||""}:null},normalizePath:function(X){for(X=X.split("").reverse().join("").replace(q,"");X.length!==(X=X.replace(d,"")).length;);return X.split("").reverse().join("")},buildURLFromParts:function(X){return X.scheme+X.netLoc+X.path+X.params+X.query+X.fragment}};C.exports=h})()},"./node_modules/webworkify-webpack/index.js":function(C,O,L){function F(S){var I={};function _(N){if(I[N])return I[N].exports;var U=I[N]={i:N,l:!1,exports:{}};return S[N].call(U.exports,U,U.exports,_),U.l=!0,U.exports}_.m=S,_.c=I,_.i=function(N){return N},_.d=function(N,U,ee){_.o(N,U)||Object.defineProperty(N,U,{configurable:!1,enumerable:!0,get:ee})},_.r=function(N){Object.defineProperty(N,"__esModule",{value:!0})},_.n=function(N){var U=N&&N.__esModule?function(){return N.default}:function(){return N};return _.d(U,"a",U),U},_.o=function(N,U){return Object.prototype.hasOwnProperty.call(N,U)},_.p="/",_.oe=function(N){throw console.error(N),N};var k=_(_.s=ENTRY_MODULE);return k.default||k}var G="[\\.|\\-|\\+|\\w|/|@]+",A="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+G+").*?\\)";function q(S){return(S+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function d(S){return!isNaN(1*S)}function h(S,I,_){var k={};k[_]=[];var N=I.toString(),U=N.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!U)return k;for(var ee=U[1],K=new RegExp("(\\\\n|\\W)"+q(ee)+A,"g"),V;V=K.exec(N);)V[3]!=="dll-reference"&&k[_].push(V[3]);for(K=new RegExp("\\("+q(ee)+'\\("(dll-reference\\s('+G+'))"\\)\\)'+A,"g");V=K.exec(N);)S[V[2]]||(k[_].push(V[1]),S[V[2]]=L(V[1]).m),k[V[2]]=k[V[2]]||[],k[V[2]].push(V[4]);for(var te=Object.keys(k),ae=0;ae<te.length;ae++)for(var ie=0;ie<k[te[ae]].length;ie++)d(k[te[ae]][ie])&&(k[te[ae]][ie]=1*k[te[ae]][ie]);return k}function X(S){var I=Object.keys(S);return I.reduce(function(_,k){return _||S[k].length>0},!1)}function E(S,I){for(var _={main:[I]},k={main:[]},N={main:{}};X(_);)for(var U=Object.keys(_),ee=0;ee<U.length;ee++){var K=U[ee],V=_[K],te=V.pop();if(N[K]=N[K]||{},!(N[K][te]||!S[K][te])){N[K][te]=!0,k[K]=k[K]||[],k[K].push(te);for(var ae=h(S,S[K][te],K),ie=Object.keys(ae),oe=0;oe<ie.length;oe++)_[ie[oe]]=_[ie[oe]]||[],_[ie[oe]]=_[ie[oe]].concat(ae[ie[oe]])}}return k}C.exports=function(S,I){I=I||{};var _={main:L.m},k=I.all?{main:Object.keys(_.main)}:E(_,S),N="";Object.keys(k).filter(function(te){return te!=="main"}).forEach(function(te){for(var ae=0;k[te][ae];)ae++;k[te].push(ae),_[te][ae]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",N=N+"var "+te+" = ("+F.toString().replace("ENTRY_MODULE",JSON.stringify(ae))+")({"+k[te].map(function(ie){return""+JSON.stringify(ie)+": "+_[te][ie].toString()}).join(",")+`});
`}),N=N+"new (("+F.toString().replace("ENTRY_MODULE",JSON.stringify(S))+")({"+k.main.map(function(te){return""+JSON.stringify(te)+": "+_.main[te].toString()}).join(",")+"}))(self);";var U=new window.Blob([N],{type:"text/javascript"});if(I.bare)return U;var ee=window.URL||window.webkitURL||window.mozURL||window.msURL,K=ee.createObjectURL(U),V=new window.Worker(K);return V.objectURL=K,V}},"./src/crypt/decrypter.js":function(C,O,L){L.r(O);var F=function(){function N(ee,K){this.subtle=ee,this.aesIV=K}var U=N.prototype;return U.decrypt=function(K,V){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},V,K)},N}(),G=function(){function N(ee,K){this.subtle=ee,this.key=K}var U=N.prototype;return U.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},N}(),A=G;function q(N){var U=N.byteLength,ee=U&&new DataView(N).getUint8(U-1);return ee?N.slice(0,U-ee):N}var d=function(){function N(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}var U=N.prototype;return U.uint8ArrayToUint32Array_=function(K){for(var V=new DataView(K),te=new Uint32Array(4),ae=0;ae<4;ae++)te[ae]=V.getUint32(ae*4);return te},U.initTable=function(){var K=this.sBox,V=this.invSBox,te=this.subMix,ae=te[0],ie=te[1],oe=te[2],ue=te[3],be=this.invSubMix,Ce=be[0],ke=be[1],De=be[2],ut=be[3],Fe=new Uint32Array(256),Ge=0,Ke=0,Pe=0;for(Pe=0;Pe<256;Pe++)Pe<128?Fe[Pe]=Pe<<1:Fe[Pe]=Pe<<1^283;for(Pe=0;Pe<256;Pe++){var Me=Ke^Ke<<1^Ke<<2^Ke<<3^Ke<<4;Me=Me>>>8^Me&255^99,K[Ge]=Me,V[Me]=Ge;var je=Fe[Ge],me=Fe[je],Je=Fe[me],Ie=Fe[Me]*257^Me*16843008;ae[Ge]=Ie<<24|Ie>>>8,ie[Ge]=Ie<<16|Ie>>>16,oe[Ge]=Ie<<8|Ie>>>24,ue[Ge]=Ie,Ie=Je*16843009^me*65537^je*257^Ge*16843008,Ce[Me]=Ie<<24|Ie>>>8,ke[Me]=Ie<<16|Ie>>>16,De[Me]=Ie<<8|Ie>>>24,ut[Me]=Ie,Ge?(Ge=je^Fe[Fe[Fe[Je^je]]],Ke^=Fe[Fe[Ke]]):Ge=Ke=1}},U.expandKey=function(K){for(var V=this.uint8ArrayToUint32Array_(K),te=!0,ae=0;ae<V.length&&te;)te=V[ae]===this.key[ae],ae++;if(!te){this.key=V;var ie=this.keySize=V.length;if(ie!==4&&ie!==6&&ie!==8)throw new Error("Invalid aes key size="+ie);var oe=this.ksRows=(ie+6+1)*4,ue,be,Ce=this.keySchedule=new Uint32Array(oe),ke=this.invKeySchedule=new Uint32Array(oe),De=this.sBox,ut=this.rcon,Fe=this.invSubMix,Ge=Fe[0],Ke=Fe[1],Pe=Fe[2],Me=Fe[3],je,me;for(ue=0;ue<oe;ue++){if(ue<ie){je=Ce[ue]=V[ue];continue}me=je,ue%ie===0?(me=me<<8|me>>>24,me=De[me>>>24]<<24|De[me>>>16&255]<<16|De[me>>>8&255]<<8|De[me&255],me^=ut[ue/ie|0]<<24):ie>6&&ue%ie===4&&(me=De[me>>>24]<<24|De[me>>>16&255]<<16|De[me>>>8&255]<<8|De[me&255]),Ce[ue]=je=(Ce[ue-ie]^me)>>>0}for(be=0;be<oe;be++)ue=oe-be,be&3?me=Ce[ue]:me=Ce[ue-4],be<4||ue<=4?ke[be]=me:ke[be]=Ge[De[me>>>24]]^Ke[De[me>>>16&255]]^Pe[De[me>>>8&255]]^Me[De[me&255]],ke[be]=ke[be]>>>0}},U.networkToHostOrderSwap=function(K){return K<<24|(K&65280)<<8|(K&16711680)>>8|K>>>24},U.decrypt=function(K,V,te,ae){for(var ie=this.keySize+6,oe=this.invKeySchedule,ue=this.invSBox,be=this.invSubMix,Ce=be[0],ke=be[1],De=be[2],ut=be[3],Fe=this.uint8ArrayToUint32Array_(te),Ge=Fe[0],Ke=Fe[1],Pe=Fe[2],Me=Fe[3],je=new Int32Array(K),me=new Int32Array(je.length),Je,Ie,vt,dt,Ae,Ve,et,nt,st,bt,qe,ht,Ye,Tt,ye=this.networkToHostOrderSwap;V<je.length;){for(st=ye(je[V]),bt=ye(je[V+1]),qe=ye(je[V+2]),ht=ye(je[V+3]),Ae=st^oe[0],Ve=ht^oe[1],et=qe^oe[2],nt=bt^oe[3],Ye=4,Tt=1;Tt<ie;Tt++)Je=Ce[Ae>>>24]^ke[Ve>>16&255]^De[et>>8&255]^ut[nt&255]^oe[Ye],Ie=Ce[Ve>>>24]^ke[et>>16&255]^De[nt>>8&255]^ut[Ae&255]^oe[Ye+1],vt=Ce[et>>>24]^ke[nt>>16&255]^De[Ae>>8&255]^ut[Ve&255]^oe[Ye+2],dt=Ce[nt>>>24]^ke[Ae>>16&255]^De[Ve>>8&255]^ut[et&255]^oe[Ye+3],Ae=Je,Ve=Ie,et=vt,nt=dt,Ye=Ye+4;Je=ue[Ae>>>24]<<24^ue[Ve>>16&255]<<16^ue[et>>8&255]<<8^ue[nt&255]^oe[Ye],Ie=ue[Ve>>>24]<<24^ue[et>>16&255]<<16^ue[nt>>8&255]<<8^ue[Ae&255]^oe[Ye+1],vt=ue[et>>>24]<<24^ue[nt>>16&255]<<16^ue[Ae>>8&255]<<8^ue[Ve&255]^oe[Ye+2],dt=ue[nt>>>24]<<24^ue[Ae>>16&255]<<16^ue[Ve>>8&255]<<8^ue[et&255]^oe[Ye+3],Ye=Ye+3,me[V]=ye(Je^Ge),me[V+1]=ye(dt^Ke),me[V+2]=ye(vt^Pe),me[V+3]=ye(Ie^Me),Ge=st,Ke=bt,Pe=qe,Me=ht,V=V+4}return ae?q(me.buffer):me.buffer},U.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},N}(),h=d,X=L("./src/errors.ts"),E=L("./src/utils/logger.js"),S=L("./src/events.js"),I=L("./src/utils/get-self-scope.js"),_=Object(I.getSelfScope)(),k=function(){function N(ee,K,V){var te=V===void 0?{}:V,ae=te.removePKCS7Padding,ie=ae===void 0?!0:ae;if(this.logEnabled=!0,this.observer=ee,this.config=K,this.removePKCS7Padding=ie,ie)try{var oe=_.crypto;oe&&(this.subtle=oe.subtle||oe.webkitSubtle)}catch{}this.disableWebCrypto=!this.subtle}var U=N.prototype;return U.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},U.decrypt=function(K,V,te,ae){var ie=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(E.logger.log("JS AES decrypt"),this.logEnabled=!1);var oe=this.decryptor;oe||(this.decryptor=oe=new h),oe.expandKey(V),ae(oe.decrypt(K,0,te,this.removePKCS7Padding))}else{this.logEnabled&&(E.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var ue=this.subtle;this.key!==V&&(this.key=V,this.fastAesKey=new A(ue,V)),this.fastAesKey.expandKey().then(function(be){var Ce=new F(ue,te);Ce.decrypt(K,be).catch(function(ke){ie.onWebCryptoError(ke,K,V,te,ae)}).then(function(ke){ae(ke)})}).catch(function(be){ie.onWebCryptoError(be,K,V,te,ae)})}},U.onWebCryptoError=function(K,V,te,ae,ie){this.config.enableSoftwareAES?(E.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(V,te,ae,ie)):(E.logger.error("decrypting error : "+K.message),this.observer.trigger(S.default.ERROR,{type:X.ErrorTypes.MEDIA_ERROR,details:X.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:K.message}))},U.destroy=function(){var K=this.decryptor;K&&(K.destroy(),this.decryptor=void 0)},N}();O.default=k},"./src/demux/demuxer-inline.js":function(C,O,L){L.r(O);var F=L("./src/events.js"),G=L("./src/errors.ts"),A=L("./src/crypt/decrypter.js"),q=L("./src/polyfills/number.js"),d=L("./src/utils/logger.js"),h=L("./src/utils/get-self-scope.js");function X(y,D,x,f){var g,m,T,b,w,M=navigator.userAgent.toLowerCase(),W=f,Y=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];if(g=((D[x+2]&192)>>>6)+1,m=(D[x+2]&60)>>>2,m>Y.length-1){y.trigger(F.default.ERROR,{type:G.ErrorTypes.MEDIA_ERROR,details:G.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+m});return}return b=(D[x+2]&1)<<2,b|=(D[x+3]&192)>>>6,d.logger.log("manifest codec:"+f+",ADTS data:type:"+g+",sampleingIndex:"+m+"["+Y[m]+"Hz],channelConfig:"+b),/firefox/i.test(M)?m>=6?(g=5,w=new Array(4),T=m-3):(g=2,w=new Array(2),T=m):M.indexOf("android")!==-1?(g=2,w=new Array(2),T=m):(g=5,w=new Array(4),f&&(f.indexOf("mp4a.40.29")!==-1||f.indexOf("mp4a.40.5")!==-1)||!f&&m>=6?T=m-3:((f&&f.indexOf("mp4a.40.2")!==-1&&(m>=6&&b===1||/vivaldi/i.test(M))||!f&&b===1)&&(g=2,w=new Array(2)),T=m)),w[0]=g<<3,w[0]|=(m&14)>>1,w[1]|=(m&1)<<7,w[1]|=b<<3,g===5&&(w[1]|=(T&14)>>1,w[2]=(T&1)<<7,w[2]|=8,w[3]=0),{config:w,samplerate:Y[m],channelCount:b,codec:"mp4a.40."+g,manifestCodec:W}}function E(y,D){return y[D]===255&&(y[D+1]&246)===240}function S(y,D){return y[D+1]&1?7:9}function I(y,D){return(y[D+3]&3)<<11|y[D+4]<<3|(y[D+5]&224)>>>5}function _(y,D){return!!(D+1<y.length&&E(y,D))}function k(y,D){if(_(y,D)){var x=S(y,D);if(D+x>=y.length)return!1;var f=I(y,D);if(f<=x)return!1;var g=D+f;if(g===y.length||g+1<y.length&&E(y,g))return!0}return!1}function N(y,D,x,f,g){if(!y.samplerate){var m=X(D,x,f,g);y.config=m.config,y.samplerate=m.samplerate,y.channelCount=m.channelCount,y.codec=m.codec,y.manifestCodec=m.manifestCodec,d.logger.log("parsed codec:"+y.codec+",rate:"+m.samplerate+",nb channel:"+m.channelCount)}}function U(y){return 1024*9e4/y}function ee(y,D,x,f,g){var m,T,b,w=y.length;if(m=S(y,D),T=I(y,D),T-=m,T>0&&D+m+T<=w)return b=x+f*g,{headerLength:m,frameLength:T,stamp:b}}function K(y,D,x,f,g){var m=U(y.samplerate),T=ee(D,x,f,g,m);if(T){var b=T.stamp,w=T.headerLength,M=T.frameLength,W={unit:D.subarray(x+w,x+w+M),pts:b,dts:b};return y.samples.push(W),{sample:W,length:M+w}}}var V=L("./src/demux/id3.js"),te=function(){function y(x,f,g){this.observer=x,this.config=g,this.remuxer=f}var D=y.prototype;return D.resetInitSegment=function(f,g,m,T){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:g,duration:T,inputTimeScale:9e4}},D.resetTimeStamp=function(){},y.probe=function(f){if(!f)return!1;for(var g=V.default.getID3Data(f,0)||[],m=g.length,T=f.length;m<T;m++)if(k(f,m))return d.logger.log("ADTS sync word found !"),!0;return!1},D.append=function(f,g,m,T){for(var b=this._audioTrack,w=V.default.getID3Data(f,0)||[],M=V.default.getTimeStamp(w),W=Object(q.isFiniteNumber)(M)?M*90:g*9e4,Y=0,j=W,J=f.length,$=w.length,ne=[{pts:j,dts:j,data:w}];$<J-1;)if(_(f,$)&&$+5<J){N(b,this.observer,f,$,b.manifestCodec);var Q=K(b,f,$,W,Y);if(Q)$+=Q.length,j=Q.sample.pts,Y++;else{d.logger.log("Unable to parse AAC frame");break}}else V.default.isHeader(f,$)?(w=V.default.getID3Data(f,$),ne.push({pts:j,dts:j,data:w}),$+=w.length):$++;this.remuxer.remux(b,{samples:[]},{samples:ne,inputTimeScale:9e4},{samples:[]},g,m,T)},D.destroy=function(){},y}(),ae=te,ie=L("./src/demux/mp4demuxer.js"),oe={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(D,x,f,g,m){if(!(f+24>x.length)){var T=this.parseHeader(x,f);if(T&&f+T.frameLength<=x.length){var b=T.samplesPerFrame*9e4/T.sampleRate,w=g+m*b,M={unit:x.subarray(f,f+T.frameLength),pts:w,dts:w};return D.config=[],D.channelCount=T.channelCount,D.samplerate=T.sampleRate,D.samples.push(M),{sample:M,length:T.frameLength}}}},parseHeader:function(D,x){var f=D[x+1]>>3&3,g=D[x+1]>>1&3,m=D[x+2]>>4&15,T=D[x+2]>>2&3,b=D[x+2]>>1&1;if(f!==1&&m!==0&&m!==15&&T!==3){var w=f===3?3-g:g===3?3:4,M=oe.BitratesMap[w*14+m-1]*1e3,W=f===3?0:f===2?1:2,Y=oe.SamplingRateMap[W*3+T],j=D[x+3]>>6===3?1:2,J=oe.SamplesCoefficients[f][g],$=oe.BytesInSlot[g],ne=J*8*$,Q=parseInt(J*M/Y+b,10)*$;return{sampleRate:Y,channelCount:j,frameLength:Q,samplesPerFrame:ne}}},isHeaderPattern:function(D,x){return D[x]===255&&(D[x+1]&224)===224&&(D[x+1]&6)!==0},isHeader:function(D,x){return!!(x+1<D.length&&this.isHeaderPattern(D,x))},probe:function(D,x){if(x+1<D.length&&this.isHeaderPattern(D,x)){var f=4,g=this.parseHeader(D,x),m=f;g&&g.frameLength&&(m=g.frameLength);var T=x+m;if(T===D.length||T+1<D.length&&this.isHeaderPattern(D,T))return!0}return!1}},ue=oe,be=function(){function y(x){this.data=x,this.bytesAvailable=x.byteLength,this.word=0,this.bitsAvailable=0}var D=y.prototype;return D.loadWord=function(){var f=this.data,g=this.bytesAvailable,m=f.byteLength-g,T=new Uint8Array(4),b=Math.min(4,g);if(b===0)throw new Error("no bytes available");T.set(f.subarray(m,m+b)),this.word=new DataView(T.buffer).getUint32(0),this.bitsAvailable=b*8,this.bytesAvailable-=b},D.skipBits=function(f){var g;this.bitsAvailable>f?(this.word<<=f,this.bitsAvailable-=f):(f-=this.bitsAvailable,g=f>>3,f-=g>>3,this.bytesAvailable-=g,this.loadWord(),this.word<<=f,this.bitsAvailable-=f)},D.readBits=function(f){var g=Math.min(this.bitsAvailable,f),m=this.word>>>32-g;return f>32&&d.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=g,this.bitsAvailable>0?this.word<<=g:this.bytesAvailable>0&&this.loadWord(),g=f-g,g>0&&this.bitsAvailable?m<<g|this.readBits(g):m},D.skipLZ=function(){var f;for(f=0;f<this.bitsAvailable;++f)if(this.word&2147483648>>>f)return this.word<<=f,this.bitsAvailable-=f,f;return this.loadWord(),f+this.skipLZ()},D.skipUEG=function(){this.skipBits(1+this.skipLZ())},D.skipEG=function(){this.skipBits(1+this.skipLZ())},D.readUEG=function(){var f=this.skipLZ();return this.readBits(f+1)-1},D.readEG=function(){var f=this.readUEG();return 1&f?1+f>>>1:-1*(f>>>1)},D.readBoolean=function(){return this.readBits(1)===1},D.readUByte=function(){return this.readBits(8)},D.readUShort=function(){return this.readBits(16)},D.readUInt=function(){return this.readBits(32)},D.skipScalingList=function(f){var g=8,m=8,T,b;for(T=0;T<f;T++)m!==0&&(b=this.readEG(),m=(g+b+256)%256),g=m===0?g:m},D.readSPS=function(){var f=0,g=0,m=0,T=0,b,w,M,W,Y,j,J,$=this.readUByte.bind(this),ne=this.readBits.bind(this),Q=this.readUEG.bind(this),ce=this.readBoolean.bind(this),fe=this.skipBits.bind(this),pe=this.skipEG.bind(this),Le=this.skipUEG.bind(this),xe=this.skipScalingList.bind(this);if($(),b=$(),ne(5),fe(3),$(),Le(),b===100||b===110||b===122||b===244||b===44||b===83||b===86||b===118||b===128){var Ne=Q();if(Ne===3&&fe(1),Le(),Le(),fe(1),ce())for(j=Ne!==3?8:12,J=0;J<j;J++)ce()&&(J<6?xe(16):xe(64))}Le();var Re=Q();if(Re===0)Q();else if(Re===1)for(fe(1),pe(),pe(),w=Q(),J=0;J<w;J++)pe();Le(),fe(1),M=Q(),W=Q(),Y=ne(1),Y===0&&fe(1),fe(1),ce()&&(f=Q(),g=Q(),m=Q(),T=Q());var Te=[1,1];if(ce()&&ce()){var we=$();switch(we){case 1:Te=[1,1];break;case 2:Te=[12,11];break;case 3:Te=[10,11];break;case 4:Te=[16,11];break;case 5:Te=[40,33];break;case 6:Te=[24,11];break;case 7:Te=[20,11];break;case 8:Te=[32,11];break;case 9:Te=[80,33];break;case 10:Te=[18,11];break;case 11:Te=[15,11];break;case 12:Te=[64,33];break;case 13:Te=[160,99];break;case 14:Te=[4,3];break;case 15:Te=[3,2];break;case 16:Te=[2,1];break;case 255:{Te=[$()<<8|$(),$()<<8|$()];break}}}return{width:Math.ceil((M+1)*16-f*2-g*2),height:(2-Y)*(W+1)*16-(Y?2:4)*(m+T),pixelRatio:Te}},D.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},y}(),Ce=be,ke=function(){function y(x,f,g,m){this.decryptdata=g,this.discardEPB=m,this.decrypter=new A.default(x,f,{removePKCS7Padding:!1})}var D=y.prototype;return D.decryptBuffer=function(f,g){this.decrypter.decrypt(f,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,g)},D.decryptAacSample=function(f,g,m,T){var b=f[g].unit,w=b.subarray(16,b.length-b.length%16),M=w.buffer.slice(w.byteOffset,w.byteOffset+w.length),W=this;this.decryptBuffer(M,function(Y){Y=new Uint8Array(Y),b.set(Y,16),T||W.decryptAacSamples(f,g+1,m)})},D.decryptAacSamples=function(f,g,m){for(;;g++){if(g>=f.length){m();return}if(!(f[g].unit.length<32)){var T=this.decrypter.isSync();if(this.decryptAacSample(f,g,m,T),!T)return}}},D.getAvcEncryptedData=function(f){for(var g=Math.floor((f.length-48)/160)*16+16,m=new Int8Array(g),T=0,b=32;b<=f.length-16;b+=160,T+=16)m.set(f.subarray(b,b+16),T);return m},D.getAvcDecryptedUnit=function(f,g){g=new Uint8Array(g);for(var m=0,T=32;T<=f.length-16;T+=160,m+=16)f.set(g.subarray(m,m+16),T);return f},D.decryptAvcSample=function(f,g,m,T,b,w){var M=this.discardEPB(b.data),W=this.getAvcEncryptedData(M),Y=this;this.decryptBuffer(W.buffer,function(j){b.data=Y.getAvcDecryptedUnit(M,j),w||Y.decryptAvcSamples(f,g,m+1,T)})},D.decryptAvcSamples=function(f,g,m,T){for(;;g++,m=0){if(g>=f.length){T();return}for(var b=f[g].units;!(m>=b.length);m++){var w=b[m];if(!(w.data.length<=48||w.type!==1&&w.type!==5)){var M=this.decrypter.isSync();if(this.decryptAvcSample(f,g,m,T,w,M),!M)return}}}},y}(),De=ke,ut={video:1,audio:2,id3:3,text:4},Fe=function(){function y(x,f,g,m){this.observer=x,this.config=g,this.typeSupported=m,this.remuxer=f,this.sampleAes=null,this.pmtUnknownTypes={}}var D=y.prototype;return D.setDecryptData=function(f){f!=null&&f.key!=null&&f.method==="SAMPLE-AES"?this.sampleAes=new De(this.observer,this.config,f,this.discardEPB):this.sampleAes=null},y.probe=function(f){var g=y._syncOffset(f);return g<0?!1:(g&&d.logger.warn("MPEG2-TS detected but first sync word found @ offset "+g+", junk ahead ?"),!0)},y._syncOffset=function(f){for(var g=Math.min(1e3,f.length-564),m=0;m<g;){if(f[m]===71&&f[m+188]===71&&f[m+2*188]===71)return m;m++}return-1},y.createTrack=function(f,g){return{container:f==="video"||f==="audio"?"video/mp2t":void 0,type:f,id:ut[f],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:f==="video"?0:void 0,isAAC:f==="audio"?!0:void 0,duration:f==="audio"?g:void 0}},D.resetInitSegment=function(f,g,m,T){this.pmtParsed=!1,this._pmtId=-1,this.pmtUnknownTypes={},this._avcTrack=y.createTrack("video",T),this._audioTrack=y.createTrack("audio",T),this._id3Track=y.createTrack("id3",T),this._txtTrack=y.createTrack("text",T),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=g,this.videoCodec=m,this._duration=T},D.resetTimeStamp=function(){},D.append=function(f,g,m,T){var b,w=f.length,M,W,Y,j,J,$=!1;this.pmtUnknownTypes={},this.contiguous=m;var ne=this.pmtParsed,Q=this._avcTrack,ce=this._audioTrack,fe=this._id3Track,pe=Q.pid,Le=ce.pid,xe=fe.pid,Ne=this._pmtId,Re=Q.pesData,Te=ce.pesData,we=fe.pesData,Oe=this._parsePAT,tt=this._parsePMT.bind(this),$e=this._parsePES,Ue=this._parseAVCPES.bind(this),at=this._parseAACPES.bind(this),Qe=this._parseMPEGPES.bind(this),ot=this._parseID3PES.bind(this),Xe=y._syncOffset(f);for(w-=(w+Xe)%188,b=Xe;b<w;b+=188)if(f[b]===71){if(M=!!(f[b+1]&64),W=((f[b+1]&31)<<8)+f[b+2],Y=(f[b+3]&48)>>4,Y>1){if(j=b+5+f[b+4],j===b+188)continue}else j=b+4;switch(W){case pe:M&&(Re&&(J=$e(Re))&&Ue(J,!1),Re={data:[],size:0}),Re&&(Re.data.push(f.subarray(j,b+188)),Re.size+=b+188-j);break;case Le:M&&(Te&&(J=$e(Te))&&(ce.isAAC?at(J):Qe(J)),Te={data:[],size:0}),Te&&(Te.data.push(f.subarray(j,b+188)),Te.size+=b+188-j);break;case xe:M&&(we&&(J=$e(we))&&ot(J),we={data:[],size:0}),we&&(we.data.push(f.subarray(j,b+188)),we.size+=b+188-j);break;case 0:M&&(j+=f[j]+1),Ne=this._pmtId=Oe(f,j);break;case Ne:M&&(j+=f[j]+1);var Be=tt(f,j,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,this.sampleAes!=null);pe=Be.avc,pe>0&&(Q.pid=pe),Le=Be.audio,Le>0&&(ce.pid=Le,ce.isAAC=Be.isAAC),xe=Be.id3,xe>0&&(fe.pid=xe),$&&!ne&&(d.logger.log("reparse from beginning"),$=!1,b=Xe-188),ne=this.pmtParsed=!0;break;case 17:case 8191:break;default:$=!0;break}}else this.observer.trigger(F.default.ERROR,{type:G.ErrorTypes.MEDIA_ERROR,details:G.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});Re&&(J=$e(Re))?(Ue(J,!0),Q.pesData=null):Q.pesData=Re,Te&&(J=$e(Te))?(ce.isAAC?at(J):Qe(J),ce.pesData=null):(Te&&Te.size&&d.logger.log("last AAC PES packet truncated,might overlap between fragments"),ce.pesData=Te),we&&(J=$e(we))?(ot(J),fe.pesData=null):fe.pesData=we,this.sampleAes==null?this.remuxer.remux(ce,Q,fe,this._txtTrack,g,m,T):this.decryptAndRemux(ce,Q,fe,this._txtTrack,g,m,T)},D.decryptAndRemux=function(f,g,m,T,b,w,M){if(f.samples&&f.isAAC){var W=this;this.sampleAes.decryptAacSamples(f.samples,0,function(){W.decryptAndRemuxAvc(f,g,m,T,b,w,M)})}else this.decryptAndRemuxAvc(f,g,m,T,b,w,M)},D.decryptAndRemuxAvc=function(f,g,m,T,b,w,M){if(g.samples){var W=this;this.sampleAes.decryptAvcSamples(g.samples,0,0,function(){W.remuxer.remux(f,g,m,T,b,w,M)})}else this.remuxer.remux(f,g,m,T,b,w,M)},D.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},D._parsePAT=function(f,g){return(f[g+10]&31)<<8|f[g+11]},D._trackUnknownPmt=function(f,g,m){var T=this.pmtUnknownTypes[f]||0;return T===0&&(this.pmtUnknownTypes[f]=0,g.call(d.logger,m)),this.pmtUnknownTypes[f]++,T},D._parsePMT=function(f,g,m,T){var b,w,M,W,Y={audio:-1,avc:-1,id3:-1,isAAC:!0};for(b=(f[g+1]&15)<<8|f[g+2],w=g+3+b-4,M=(f[g+10]&15)<<8|f[g+11],g+=12+M;g<w;){switch(W=(f[g+1]&31)<<8|f[g+2],f[g]){case 207:if(!T){this._trackUnknownPmt(f[g],d.logger.warn,"ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:Y.audio===-1&&(Y.audio=W);break;case 21:Y.id3===-1&&(Y.id3=W);break;case 219:if(!T){this._trackUnknownPmt(f[g],d.logger.warn,"H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:Y.avc===-1&&(Y.avc=W);break;case 3:case 4:m?Y.audio===-1&&(Y.audio=W,Y.isAAC=!1):this._trackUnknownPmt(f[g],d.logger.warn,"MPEG audio found, not supported in this browser");break;case 36:this._trackUnknownPmt(f[g],d.logger.warn,"Unsupported HEVC stream type found");break;default:this._trackUnknownPmt(f[g],d.logger.log,"Unknown stream type:"+f[g]);break}g+=((f[g+3]&15)<<8|f[g+4])+5}return Y},D._parsePES=function(f){var g=0,m,T,b,w,M,W,Y,j,J,$=f.data;if(!f||f.size===0)return null;for(;$[0].length<19&&$.length>1;){var ne=new Uint8Array($[0].length+$[1].length);ne.set($[0]),ne.set($[1],$[0].length),$[0]=ne,$.splice(1,1)}if(m=$[0],b=(m[0]<<16)+(m[1]<<8)+m[2],b===1){if(w=(m[4]<<8)+m[5],w&&w>f.size-6||(T=m[7],T&192&&(Y=(m[9]&14)*536870912+(m[10]&255)*4194304+(m[11]&254)*16384+(m[12]&255)*128+(m[13]&254)/2,T&64?(j=(m[14]&14)*536870912+(m[15]&255)*4194304+(m[16]&254)*16384+(m[17]&255)*128+(m[18]&254)/2,Y-j>60*9e4&&(d.logger.warn(Math.round((Y-j)/9e4)+"s delta between PTS and DTS, align them"),Y=j)):j=Y),M=m[8],J=M+9,f.size<=J))return null;f.size-=J,W=new Uint8Array(f.size);for(var Q=0,ce=$.length;Q<ce;Q++){m=$[Q];var fe=m.byteLength;if(J)if(J>fe){J-=fe;continue}else m=m.subarray(J),fe-=J,J=0;W.set(m,g),g+=fe}return w&&(w-=M+3),{data:W,pts:Y,dts:j,len:w}}else return null},D.pushAccesUnit=function(f,g){if(f.units.length&&f.frame){var m=g.samples,T=m.length;if(isNaN(f.pts))if(T){var b=m[T-1];f.pts=b.pts,f.dts=b.dts}else{g.dropped++;return}!this.config.forceKeyFrameOnDiscontinuity||f.key===!0||g.sps&&(T||this.contiguous)?(f.id=T,m.push(f)):g.dropped++}f.debug.length&&d.logger.log(f.pts+"/"+f.dts+":"+f.debug)},D._parseAVCPES=function(f,g){var m=this,T=this._avcTrack,b=this._parseAVCNALu(f.data),w,M=this.avcSample,W,Y=!1,j,J=this.pushAccesUnit.bind(this),$=function(Q,ce,fe,pe){return{key:Q,pts:ce,dts:fe,units:[],debug:pe}};f.data=null,M&&b.length&&!T.audFound&&(J(M,T),M=this.avcSample=$(!1,f.pts,f.dts,"")),b.forEach(function(ne){switch(ne.type){case 1:W=!0,M||(M=m.avcSample=$(!0,f.pts,f.dts,"")),M.frame=!0;var Q=ne.data;if(Y&&Q.length>4){var ce=new Ce(Q).readSliceType();(ce===2||ce===4||ce===7||ce===9)&&(M.key=!0)}break;case 5:W=!0,M||(M=m.avcSample=$(!0,f.pts,f.dts,"")),M.key=!0,M.frame=!0;break;case 6:W=!0,w=new Ce(m.discardEPB(ne.data)),w.readUByte();for(var fe=0,pe=0,Le=!1,xe=0;!Le&&w.bytesAvailable>1;){fe=0;do xe=w.readUByte(),fe+=xe;while(xe===255);pe=0;do xe=w.readUByte(),pe+=xe;while(xe===255);if(fe===4&&w.bytesAvailable!==0){Le=!0;var Ne=w.readUByte();if(Ne===181){var Re=w.readUShort();if(Re===49){var Te=w.readUInt();if(Te===1195456820){var we=w.readUByte();if(we===3){var Oe=w.readUByte(),tt=w.readUByte(),$e=31&Oe,Ue=[Oe,tt];for(j=0;j<$e;j++)Ue.push(w.readUByte()),Ue.push(w.readUByte()),Ue.push(w.readUByte());m._insertSampleInOrder(m._txtTrack.samples,{type:3,pts:f.pts,bytes:Ue})}}}}}else if(fe===5&&w.bytesAvailable!==0){if(Le=!0,pe>16){var at=[];for(j=0;j<16;j++)at.push(w.readUByte().toString(16)),(j===3||j===5||j===7||j===9)&&at.push("-");var Qe=pe-16,ot=new Uint8Array(Qe);for(j=0;j<Qe;j++)ot[j]=w.readUByte();m._insertSampleInOrder(m._txtTrack.samples,{pts:f.pts,payloadType:fe,uuid:at.join(""),userDataBytes:ot,userData:Object(V.utf8ArrayToStr)(ot.buffer)})}}else if(pe<w.bytesAvailable)for(j=0;j<pe;j++)w.readUByte()}break;case 7:if(W=!0,Y=!0,!T.sps){w=new Ce(ne.data);var Xe=w.readSPS();T.width=Xe.width,T.height=Xe.height,T.pixelRatio=Xe.pixelRatio,T.sps=[ne.data],T.duration=m._duration;var Be=ne.data.subarray(1,4),pt="avc1.";for(j=0;j<3;j++){var mt=Be[j].toString(16);mt.length<2&&(mt="0"+mt),pt+=mt}T.codec=pt}break;case 8:W=!0,T.pps||(T.pps=[ne.data]);break;case 9:W=!1,T.audFound=!0,M&&J(M,T),M=m.avcSample=$(!1,f.pts,f.dts,"");break;case 12:W=!1;break;default:W=!1,M&&(M.debug+="unknown NAL "+ne.type+" ");break}if(M&&W){var ft=M.units;ft.push(ne)}}),g&&M&&(J(M,T),this.avcSample=null)},D._insertSampleInOrder=function(f,g){var m=f.length;if(m>0){if(g.pts>=f[m-1].pts)f.push(g);else for(var T=m-1;T>=0;T--)if(g.pts<f[T].pts){f.splice(T,0,g);break}}else f.push(g)},D._getLastNalUnit=function(){var f=this.avcSample,g;if(!f||f.units.length===0){var m=this._avcTrack,T=m.samples;f=T[T.length-1]}if(f){var b=f.units;g=b[b.length-1]}return g},D._parseAVCNALu=function(f){var g=0,m=f.byteLength,T,b,w=this._avcTrack,M=w.naluState||0,W=M,Y=[],j,J,$=-1,ne;for(M===-1&&($=0,ne=f[0]&31,M=0,g=1);g<m;){if(T=f[g++],!M){M=T?0:1;continue}if(M===1){M=T?0:2;continue}if(!T)M=3;else if(T===1){if($>=0)j={data:f.subarray($,g-M-1),type:ne},Y.push(j);else{var Q=this._getLastNalUnit();if(Q&&(W&&g<=4-W&&Q.state&&(Q.data=Q.data.subarray(0,Q.data.byteLength-W)),b=g-M-1,b>0)){var ce=new Uint8Array(Q.data.byteLength+b);ce.set(Q.data,0),ce.set(f.subarray(0,b),Q.data.byteLength),Q.data=ce}}g<m?(J=f[g]&31,$=g,ne=J,M=0):M=-1}else M=0}if($>=0&&M>=0&&(j={data:f.subarray($,m),type:ne,state:M},Y.push(j)),Y.length===0){var fe=this._getLastNalUnit();if(fe){var pe=new Uint8Array(fe.data.byteLength+f.byteLength);pe.set(fe.data,0),pe.set(f,fe.data.byteLength),fe.data=pe}}return w.naluState=M,Y},D.discardEPB=function(f){for(var g=f.byteLength,m=[],T=1,b,w;T<g-2;)f[T]===0&&f[T+1]===0&&f[T+2]===3?(m.push(T+2),T+=2):T++;if(m.length===0)return f;b=g-m.length,w=new Uint8Array(b);var M=0;for(T=0;T<b;M++,T++)M===m[0]&&(M++,m.shift()),w[T]=f[M];return w},D._parseAACPES=function(f){var g=this._audioTrack,m=f.data,T=f.pts,b=0,w=this.aacOverFlow,M=this.aacLastPTS,W,Y,j,J,$;if(w){var ne=new Uint8Array(w.byteLength+m.byteLength);ne.set(w,0),ne.set(m,w.byteLength),m=ne}for(j=b,$=m.length;j<$-1&&!_(m,j);j++);if(j){var Q,ce;if(j<$-1?(Q="AAC PES did not start with ADTS header,offset:"+j,ce=!1):(Q="no ADTS header found in AAC PES",ce=!0),d.logger.warn("parsing error:"+Q),this.observer.trigger(F.default.ERROR,{type:G.ErrorTypes.MEDIA_ERROR,details:G.ErrorDetails.FRAG_PARSING_ERROR,fatal:ce,reason:Q}),ce)return}if(N(g,this.observer,m,j,this.audioCodec),Y=0,W=U(g.samplerate),w&&M){var fe=M+W;Math.abs(fe-T)>1&&(d.logger.log("AAC: align PTS for overlapping frames by "+Math.round((fe-T)/90)),T=fe)}for(;j<$;)if(_(m,j)){if(j+5<$){var pe=K(g,m,j,T,Y);if(pe){j+=pe.length,J=pe.sample.pts,Y++;continue}}break}else j++;j<$?w=m.subarray(j,$):w=null,this.aacOverFlow=w,this.aacLastPTS=J},D._parseMPEGPES=function(f){for(var g=f.data,m=g.length,T=0,b=0,w=f.pts;b<m;)if(ue.isHeader(g,b)){var M=ue.appendFrame(this._audioTrack,g,b,w,T);if(M)b+=M.length,T++;else break}else b++},D._parseID3PES=function(f){this._id3Track.samples.push(f)},y}(),Ge=Fe,Ke=function(){function y(x,f,g){this.observer=x,this.config=g,this.remuxer=f}var D=y.prototype;return D.resetInitSegment=function(f,g,m,T){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:g,duration:T,inputTimeScale:9e4}},D.resetTimeStamp=function(){},y.probe=function(f){var g,m,T=V.default.getID3Data(f,0);if(T&&V.default.getTimeStamp(T)!==void 0){for(g=T.length,m=Math.min(f.length-1,g+100);g<m;g++)if(ue.probe(f,g))return d.logger.log("MPEG Audio sync word found !"),!0}return!1},D.append=function(f,g,m,T){for(var b=V.default.getID3Data(f,0)||[],w=V.default.getTimeStamp(b),M=w!==void 0?90*w:g*9e4,W=b.length,Y=f.length,j=0,J=0,$=this._audioTrack,ne=[{pts:M,dts:M,data:b}];W<Y;)if(ue.isHeader(f,W)){var Q=ue.appendFrame($,f,W,M,j);if(Q)W+=Q.length,J=Q.sample.pts,j++;else break}else V.default.isHeader(f,W)?(b=V.default.getID3Data(f,W),ne.push({pts:J,dts:J,data:b}),W+=b.length):W++;this.remuxer.remux($,{samples:[]},{samples:ne,inputTimeScale:9e4},{samples:[]},g,m,T)},D.destroy=function(){},y}(),Pe=Ke,Me=function(){function y(){}return y.getSilentFrame=function(x,f){switch(x){case"mp4a.40.2":if(f===1)return new Uint8Array([0,200,0,128,35,128]);if(f===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(f===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(f===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(f===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(f===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(f===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(f===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(f===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}return null},y}(),je=Me,me=Math.pow(2,32)-1,Je=function(){function y(){}return y.init=function(){y.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var x;for(x in y.types)y.types.hasOwnProperty(x)&&(y.types[x]=[x.charCodeAt(0),x.charCodeAt(1),x.charCodeAt(2),x.charCodeAt(3)]);var f=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),g=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);y.HDLR_TYPES={video:f,audio:g};var m=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),T=new Uint8Array([0,0,0,0,0,0,0,0]);y.STTS=y.STSC=y.STCO=T,y.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),y.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),y.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),y.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var b=new Uint8Array([105,115,111,109]),w=new Uint8Array([97,118,99,49]),M=new Uint8Array([0,0,0,1]);y.FTYP=y.box(y.types.ftyp,b,M,b,w),y.DINF=y.box(y.types.dinf,y.box(y.types.dref,m))},y.box=function(x){for(var f=Array.prototype.slice.call(arguments,1),g=8,m=f.length,T=m,b;m--;)g+=f[m].byteLength;for(b=new Uint8Array(g),b[0]=g>>24&255,b[1]=g>>16&255,b[2]=g>>8&255,b[3]=g&255,b.set(x,4),m=0,g=8;m<T;m++)b.set(f[m],g),g+=f[m].byteLength;return b},y.hdlr=function(x){return y.box(y.types.hdlr,y.HDLR_TYPES[x])},y.mdat=function(x){return y.box(y.types.mdat,x)},y.mdhd=function(x,f){f*=x;var g=Math.floor(f/(me+1)),m=Math.floor(f%(me+1));return y.box(y.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,x>>24&255,x>>16&255,x>>8&255,x&255,g>>24,g>>16&255,g>>8&255,g&255,m>>24,m>>16&255,m>>8&255,m&255,85,196,0,0]))},y.mdia=function(x){return y.box(y.types.mdia,y.mdhd(x.timescale,x.duration),y.hdlr(x.type),y.minf(x))},y.mfhd=function(x){return y.box(y.types.mfhd,new Uint8Array([0,0,0,0,x>>24,x>>16&255,x>>8&255,x&255]))},y.minf=function(x){return x.type==="audio"?y.box(y.types.minf,y.box(y.types.smhd,y.SMHD),y.DINF,y.stbl(x)):y.box(y.types.minf,y.box(y.types.vmhd,y.VMHD),y.DINF,y.stbl(x))},y.moof=function(x,f,g){return y.box(y.types.moof,y.mfhd(x),y.traf(g,f))},y.moov=function(x){for(var f=x.length,g=[];f--;)g[f]=y.trak(x[f]);return y.box.apply(null,[y.types.moov,y.mvhd(x[0].timescale,x[0].duration)].concat(g).concat(y.mvex(x)))},y.mvex=function(x){for(var f=x.length,g=[];f--;)g[f]=y.trex(x[f]);return y.box.apply(null,[y.types.mvex].concat(g))},y.mvhd=function(x,f){f*=x;var g=Math.floor(f/(me+1)),m=Math.floor(f%(me+1)),T=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,x>>24&255,x>>16&255,x>>8&255,x&255,g>>24,g>>16&255,g>>8&255,g&255,m>>24,m>>16&255,m>>8&255,m&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return y.box(y.types.mvhd,T)},y.sdtp=function(x){var f=x.samples||[],g=new Uint8Array(4+f.length),m,T;for(T=0;T<f.length;T++)m=f[T].flags,g[T+4]=m.dependsOn<<4|m.isDependedOn<<2|m.hasRedundancy;return y.box(y.types.sdtp,g)},y.stbl=function(x){return y.box(y.types.stbl,y.stsd(x),y.box(y.types.stts,y.STTS),y.box(y.types.stsc,y.STSC),y.box(y.types.stsz,y.STSZ),y.box(y.types.stco,y.STCO))},y.avc1=function(x){var f=[],g=[],m,T,b;for(m=0;m<x.sps.length;m++)T=x.sps[m],b=T.byteLength,f.push(b>>>8&255),f.push(b&255),f=f.concat(Array.prototype.slice.call(T));for(m=0;m<x.pps.length;m++)T=x.pps[m],b=T.byteLength,g.push(b>>>8&255),g.push(b&255),g=g.concat(Array.prototype.slice.call(T));var w=y.box(y.types.avcC,new Uint8Array([1,f[3],f[4],f[5],255,224|x.sps.length].concat(f).concat([x.pps.length]).concat(g))),M=x.width,W=x.height,Y=x.pixelRatio[0],j=x.pixelRatio[1];return y.box(y.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,M>>8&255,M&255,W>>8&255,W&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),w,y.box(y.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),y.box(y.types.pasp,new Uint8Array([Y>>24,Y>>16&255,Y>>8&255,Y&255,j>>24,j>>16&255,j>>8&255,j&255])))},y.esds=function(x){var f=x.config.length;return new Uint8Array([0,0,0,0,3,23+f,0,1,0,4,15+f,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([f]).concat(x.config).concat([6,1,2]))},y.mp4a=function(x){var f=x.samplerate;return y.box(y.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,x.channelCount,0,16,0,0,0,0,f>>8&255,f&255,0,0]),y.box(y.types.esds,y.esds(x)))},y.mp3=function(x){var f=x.samplerate;return y.box(y.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,x.channelCount,0,16,0,0,0,0,f>>8&255,f&255,0,0]))},y.stsd=function(x){return x.type==="audio"?!x.isAAC&&x.codec==="mp3"?y.box(y.types.stsd,y.STSD,y.mp3(x)):y.box(y.types.stsd,y.STSD,y.mp4a(x)):y.box(y.types.stsd,y.STSD,y.avc1(x))},y.tkhd=function(x){var f=x.id,g=x.duration*x.timescale,m=x.width,T=x.height,b=Math.floor(g/(me+1)),w=Math.floor(g%(me+1));return y.box(y.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,f>>24&255,f>>16&255,f>>8&255,f&255,0,0,0,0,b>>24,b>>16&255,b>>8&255,b&255,w>>24,w>>16&255,w>>8&255,w&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,m>>8&255,m&255,0,0,T>>8&255,T&255,0,0]))},y.traf=function(x,f){var g=y.sdtp(x),m=x.id,T=Math.floor(f/(me+1)),b=Math.floor(f%(me+1));return y.box(y.types.traf,y.box(y.types.tfhd,new Uint8Array([0,0,0,0,m>>24,m>>16&255,m>>8&255,m&255])),y.box(y.types.tfdt,new Uint8Array([1,0,0,0,T>>24,T>>16&255,T>>8&255,T&255,b>>24,b>>16&255,b>>8&255,b&255])),y.trun(x,g.length+16+20+8+16+8+8),g)},y.trak=function(x){return x.duration=x.duration||4294967295,y.box(y.types.trak,y.tkhd(x),y.mdia(x))},y.trex=function(x){var f=x.id;return y.box(y.types.trex,new Uint8Array([0,0,0,0,f>>24,f>>16&255,f>>8&255,f&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},y.trun=function(x,f){var g=x.samples||[],m=g.length,T=12+16*m,b=new Uint8Array(T),w,M,W,Y,j,J;for(f+=8+T,b.set([0,0,15,1,m>>>24&255,m>>>16&255,m>>>8&255,m&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255],0),w=0;w<m;w++)M=g[w],W=M.duration,Y=M.size,j=M.flags,J=M.cts,b.set([W>>>24&255,W>>>16&255,W>>>8&255,W&255,Y>>>24&255,Y>>>16&255,Y>>>8&255,Y&255,j.isLeading<<2|j.dependsOn,j.isDependedOn<<6|j.hasRedundancy<<4|j.paddingValue<<1|j.isNonSync,j.degradPrio&61440,j.degradPrio&15,J>>>24&255,J>>>16&255,J>>>8&255,J&255],12+16*w);return y.box(y.types.trun,b)},y.initSegment=function(x){y.types||y.init();var f=y.moov(x),g;return g=new Uint8Array(y.FTYP.byteLength+f.byteLength),g.set(y.FTYP),g.set(f,y.FTYP.byteLength),g},y}(),Ie=Je,vt=9e4;function dt(y,D,x,f){x===void 0&&(x=1),f===void 0&&(f=!1);var g=y*D*x;return f?Math.round(g):g}function Ae(y,D){return D===void 0&&(D=!1),dt(y,1e3,1/vt,D)}function Ve(y,D){return D===void 0&&(D=1),dt(y,vt,1/D)}var et=Ve(10),nt=Ve(.2),st=null,bt=function(){function y(x,f,g,m){if(this.observer=x,this.config=f,this.typeSupported=g,this.ISGenerated=!1,st===null){var T=navigator.userAgent.match(/Chrome\/(\d+)/i);st=T?parseInt(T[1]):0}}var D=y.prototype;return D.destroy=function(){},D.resetTimeStamp=function(f){this._initPTS=this._initDTS=f},D.resetInitSegment=function(){this.ISGenerated=!1},D.getVideoStartPts=function(f){var g=!1,m=f.reduce(function(T,b){var w=b.pts-T;return w<-4294967296?(g=!0,qe(T,b.pts)):w>0?T:b.pts},f[0].pts);return g&&d.logger.debug("PTS rollover detected"),m},D.remux=function(f,g,m,T,b,w,M){if(this.ISGenerated||this.generateIS(f,g,b),this.ISGenerated){var W=f.samples.length,Y=g.samples.length,j=b,J=b;if(W&&Y){var $=this.getVideoStartPts(g.samples),ne=qe(f.samples[0].pts,$)-$,Q=ne/g.inputTimeScale;j+=Math.max(0,Q),J+=Math.max(0,-Q)}if(W){f.timescale||(d.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(f,g,b));var ce=this.remuxAudio(f,j,w,M);if(Y){var fe;ce&&(fe=ce.endPTS-ce.startPTS),g.timescale||(d.logger.warn("regenerate InitSegment as video detected"),this.generateIS(f,g,b)),this.remuxVideo(g,J,w,fe)}}else if(Y){var pe=this.remuxVideo(g,J,w,0,M);pe&&f.codec&&this.remuxEmptyAudio(f,j,w,pe)}}m.samples.length&&this.remuxID3(m,b),T.samples.length&&this.remuxText(T,b),this.observer.trigger(F.default.FRAG_PARSED)},D.generateIS=function(f,g,m){var T=this.observer,b=f.samples,w=g.samples,M=this.typeSupported,W="audio/mp4",Y={},j={tracks:Y},J=this._initPTS===void 0,$,ne;if(J&&($=ne=1/0),f.config&&b.length&&(f.timescale=f.samplerate,d.logger.log("audio sampling rate : "+f.samplerate),f.isAAC||(M.mpeg?(W="audio/mpeg",f.codec=""):M.mp3&&(f.codec="mp3")),Y.audio={container:W,codec:f.codec,initSegment:!f.isAAC&&M.mpeg?new Uint8Array:Ie.initSegment([f]),metadata:{channelCount:f.channelCount}},J&&($=ne=b[0].pts-Math.round(f.inputTimeScale*m))),g.sps&&g.pps&&w.length){var Q=g.inputTimeScale;if(g.timescale=Q,Y.video={container:"video/mp4",codec:g.codec,initSegment:Ie.initSegment([g]),metadata:{width:g.width,height:g.height}},J){var ce=this.getVideoStartPts(w),fe=Math.round(Q*m);ne=Math.min(ne,qe(w[0].dts,ce)-fe),$=Math.min($,ce-fe),this.observer.trigger(F.default.INIT_PTS_FOUND,{initPTS:$})}}else J&&Y.audio&&this.observer.trigger(F.default.INIT_PTS_FOUND,{initPTS:$});Object.keys(Y).length?(T.trigger(F.default.FRAG_PARSING_INIT_SEGMENT,j),this.ISGenerated=!0,J&&(this._initPTS=$,this._initDTS=ne)):T.trigger(F.default.ERROR,{type:G.ErrorTypes.MEDIA_ERROR,details:G.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},D.remuxVideo=function(f,g,m,T){var b=f.timescale,w=f.samples,M=[],W=w.length,Y=this._initPTS,j=8,J,$,ne,Q,ce,fe=Number.POSITIVE_INFINITY,pe=Number.NEGATIVE_INFINITY,Le=0,xe=!1,Ne=this.nextAvcDts;if(W!==0){if(!m){var Re=g*b,Te=w[0].pts-qe(w[0].dts,w[0].pts);Ne=Re-Te}for(var we=0;we<W;we++){var Oe=w[we];Oe.pts=qe(Oe.pts-Y,Ne),Oe.dts=qe(Oe.dts-Y,Ne),Oe.dts>Oe.pts&&(Le=Math.max(Math.min(Le,Oe.pts-Oe.dts),-1*nt)),Oe.dts<w[we>0?we-1:we].dts&&(xe=!0)}xe&&w.sort(function(jt,Qt){var vr=jt.dts-Qt.dts,pr=jt.pts-Qt.pts;return vr||pr||jt.id-Qt.id}),Q=w[0].dts,ce=w[W-1].dts;var tt=Math.round((ce-Q)/(W-1));if(Le<0){if(Le<tt*-2){d.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Ae(-tt,!0)+" ms");for(var $e=Le,Ue=0;Ue<W;Ue++)w[Ue].dts=$e=Math.max($e,w[Ue].pts-tt),w[Ue].pts=Math.max($e,w[Ue].pts)}else{d.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Ae(Le,!0)+" ms to overcome this issue");for(var at=0;at<W;at++)w[at].dts=w[at].dts+Le}Q=w[0].dts,ce=w[W-1].dts}if(m){var Qe=Q-Ne,ot=Qe>tt,Xe=Qe<-1;if(ot||Xe){ot?d.logger.warn("AVC: "+Ae(Qe,!0)+" ms ("+Qe+"dts) hole between fragments detected, filling it"):d.logger.warn("AVC: "+Ae(-Qe,!0)+" ms ("+Qe+"dts) overlapping between fragments detected"),Q=Ne;var Be=w[0].pts-Qe;w[0].dts=Q,w[0].pts=Be,d.logger.log("Video: First PTS/DTS adjusted: "+Ae(Be,!0)+"/"+Ae(Q,!0)+", delta: "+Ae(Qe,!0)+" ms")}}st&&st<75&&(Q=Math.max(0,Q));for(var pt=0,mt=0,ft=0;ft<W;ft++){for(var rt=w[ft],gt=rt.units,xt=gt.length,St=0,Ct=0;Ct<xt;Ct++)St+=gt[Ct].data.length;mt+=St,pt+=xt,rt.length=St,rt.dts=Math.max(rt.dts,Q),rt.pts=Math.max(rt.pts,rt.dts,0),fe=Math.min(rt.pts,fe),pe=Math.max(rt.pts,pe)}ce=w[W-1].dts;var _t=mt+4*pt+8;try{$=new Uint8Array(_t)}catch{this.observer.trigger(F.default.ERROR,{type:G.ErrorTypes.MUX_ERROR,details:G.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:_t,reason:"fail allocating video mdat "+_t});return}var kt=new DataView($.buffer);kt.setUint32(0,_t),$.set(Ie.types.mdat,4);for(var B=0;B<W;B++){for(var lt=w[B],It=lt.units,Pt=0,yt=void 0,zt=0,hr=It.length;zt<hr;zt++){var ir=It[zt],nr=ir.data,qt=ir.data.byteLength;kt.setUint32(j,qt),j+=4,$.set(nr,j),j+=qt,Pt+=4+qt}if(B<W-1)J=w[B+1].dts-lt.dts;else{var ar=this.config,Mt=lt.dts-w[B>0?B-1:B].dts;if(ar.stretchShortVideoTrack){var gr=ar.maxBufferHole,$t=Math.floor(gr*b),Gt=(T?fe+T*b:this.nextAudioPts)-lt.pts;Gt>$t?(J=Gt-Mt,J<0&&(J=Mt),d.logger.log("It is approximately "+Ae(Gt,!1)+" ms to the next segment; using duration "+Ae(J,!1)+" ms for the last video frame.")):J=Mt}else J=Mt}yt=Math.round(lt.pts-lt.dts),M.push({size:Pt,duration:J,cts:yt,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:lt.key?2:1,isNonSync:lt.key?0:1}})}this.nextAvcDts=ce+J;var Nt=f.dropped;if(f.nbNalu=0,f.dropped=0,M.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var sr=M[0].flags;sr.dependsOn=2,sr.isNonSync=0}f.samples=M,ne=Ie.moof(f.sequenceNumber++,Q,f),f.samples=[];var or={data1:ne,data2:$,startPTS:fe/b,endPTS:(pe+J)/b,startDTS:Q/b,endDTS:this.nextAvcDts/b,type:"video",hasAudio:!1,hasVideo:!0,nb:M.length,dropped:Nt};return this.observer.trigger(F.default.FRAG_PARSING_DATA,or),or}},D.remuxAudio=function(f,g,m,T){var b=f.inputTimeScale,w=f.timescale,M=b/w,W=f.isAAC?1024:1152,Y=W*M,j=this._initPTS,J=!f.isAAC&&this.typeSupported.mpeg,$,ne,Q,ce,fe,pe,Le=J?0:8,xe=f.samples,Ne=[],Re=this.nextAudioPts;if(m|=xe.length&&Re&&(T&&Math.abs(g-Re/b)<.1||Math.abs(xe[0].pts-Re-j)<20*Y),xe.forEach(function(yt){yt.pts=yt.dts=qe(yt.pts-j,g*b)}),xe=xe.filter(function(yt){return yt.pts>=0}),xe.length!==0){if(m||(T?Re=Math.max(0,g*b):Re=xe[0].pts),f.isAAC)for(var Te=this.config.maxAudioFramesDrift,we=0,Oe=Re;we<xe.length;){var tt=xe[we],$e=tt.pts,Ue=$e-Oe;if(Ue<=-Te*Y)m||we>0?(d.logger.warn("Dropping 1 audio frame @ "+Ae(Oe,!0)/1e3+"s due to "+Ae(Ue,!0)+" ms overlap."),xe.splice(we,1)):(d.logger.warn("Audio frame @ "+Ae($e,!0)/1e3+"s overlaps nextAudioPts by "+Ae(Ue,!0)+" ms."),Oe=$e+Y,we++);else if(Ue>=Te*Y&&Ue<et&&Oe){var at=Math.round(Ue/Y);d.logger.warn("Injecting "+at+" audio frames @ "+Ae(Oe,!0)/1e3+"s due to "+Ae(Ue,!0)+" ms gap.");for(var Qe=0;Qe<at;Qe++){var ot=Math.max(Oe,0);ne=je.getSilentFrame(f.manifestCodec||f.codec,f.channelCount),ne||(d.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),ne=tt.unit.subarray()),xe.splice(we,0,{unit:ne,pts:ot,dts:ot}),Oe+=Y,we++}tt.pts=tt.dts=Oe,Oe+=Y,we++}else tt.pts=tt.dts=Oe,Oe+=Y,we++}for(var Xe=xe.length,Be=0;Xe--;)Be+=xe[Xe].unit.byteLength;for(var pt=0,mt=xe.length;pt<mt;pt++){var ft=xe[pt],rt=ft.unit,gt=ft.pts;if(pe!==void 0&&$)$.duration=Math.round((gt-pe)/M);else{var xt=gt-Re,St=0;if(m&&f.isAAC&&xt){if(xt>0&&xt<et)St=Math.round((gt-Re)/Y),d.logger.log(Ae(xt,!0)+" ms hole between AAC samples detected,filling it"),St>0&&(ne=je.getSilentFrame(f.manifestCodec||f.codec,f.channelCount),ne||(ne=rt.subarray()),Be+=St*ne.length);else if(xt<-12){d.logger.log("drop overlapping AAC sample, expected/parsed/delta: "+Ae(Re,!0)+" ms / "+Ae(gt,!0)+" ms / "+Ae(-xt,!0)+" ms"),Be-=rt.byteLength;continue}gt=Re}if(fe=gt,Be>0){Be+=Le;try{Q=new Uint8Array(Be)}catch{this.observer.trigger(F.default.ERROR,{type:G.ErrorTypes.MUX_ERROR,details:G.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Be,reason:"fail allocating audio mdat "+Be});return}if(!J){var Ct=new DataView(Q.buffer);Ct.setUint32(0,Be),Q.set(Ie.types.mdat,4)}}else return;for(var _t=0;_t<St;_t++)ne=je.getSilentFrame(f.manifestCodec||f.codec,f.channelCount),ne||(d.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),ne=rt.subarray()),Q.set(ne,Le),Le+=ne.byteLength,$={size:ne.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},Ne.push($)}Q.set(rt,Le);var kt=rt.byteLength;Le+=kt,$={size:kt,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},Ne.push($),pe=gt}var B=0;if(Xe=Ne.length,Xe>=2&&(B=Ne[Xe-2].duration,$.duration=B),Xe){this.nextAudioPts=Re=pe+M*B,f.samples=Ne,J?ce=new Uint8Array:ce=Ie.moof(f.sequenceNumber++,fe/M,f),f.samples=[];var lt=fe/b,It=Re/b,Pt={data1:ce,data2:Q,startPTS:lt,endPTS:It,startDTS:lt,endDTS:It,type:"audio",hasAudio:!0,hasVideo:!1,nb:Xe};return this.observer.trigger(F.default.FRAG_PARSING_DATA,Pt),Pt}return null}},D.remuxEmptyAudio=function(f,g,m,T){var b=f.inputTimeScale,w=f.samplerate?f.samplerate:b,M=b/w,W=this.nextAudioPts,Y=(W!==void 0?W:T.startDTS*b)+this._initDTS,j=T.endDTS*b+this._initDTS,J=1024,$=M*J,ne=Math.ceil((j-Y)/$),Q=je.getSilentFrame(f.manifestCodec||f.codec,f.channelCount);if(d.logger.warn("remux empty Audio"),!Q){d.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");return}for(var ce=[],fe=0;fe<ne;fe++){var pe=Y+fe*$;ce.push({unit:Q,pts:pe,dts:pe})}f.samples=ce,this.remuxAudio(f,g,m)},D.remuxID3=function(f,g){var m=f.samples.length;if(m){for(var T=f.inputTimeScale,b=this._initPTS,w=this._initDTS,M=0;M<m;M++){var W=f.samples[M];W.pts=qe(W.pts-b,g*T)/T,W.dts=qe(W.dts-w,g*T)/T}this.observer.trigger(F.default.FRAG_PARSING_METADATA,{samples:f.samples}),f.samples=[]}},D.remuxText=function(f,g){var m=f.samples.length,T=f.inputTimeScale,b=this._initPTS;if(m){for(var w=0;w<m;w++){var M=f.samples[w];M.pts=qe(M.pts-b,g*T)/T}f.samples.sort(function(W,Y){return W.pts-Y.pts}),this.observer.trigger(F.default.FRAG_PARSING_USERDATA,{samples:f.samples})}f.samples=[]},y}();function qe(y,D){var x;if(D===void 0)return y;for(D<y?x=-8589934592:x=8589934592;Math.abs(y-D)>4294967296;)y+=x;return y}var ht=bt,Ye=function(){function y(x){this.observer=x}var D=y.prototype;return D.destroy=function(){},D.resetTimeStamp=function(){},D.resetInitSegment=function(){},D.remux=function(f,g,m,T,b,w,M,W){var Y=this.observer,j="";f&&(j+="audio"),g&&(j+="video"),Y.trigger(F.default.FRAG_PARSING_DATA,{data1:W,startPTS:b,startDTS:b,type:j,hasAudio:!!f,hasVideo:!!g,nb:1,dropped:0}),Y.trigger(F.default.FRAG_PARSED)},y}(),Tt=Ye,ye=Object(h.getSelfScope)(),He;try{He=ye.performance.now.bind(ye.performance)}catch{d.logger.debug("Unable to use Performance API on this environment"),He=ye.Date.now}var Bt=function(){function y(x,f,g,m){this.observer=x,this.typeSupported=f,this.config=g,this.vendor=m}var D=y.prototype;return D.destroy=function(){var f=this.demuxer;f&&f.destroy()},D.push=function(f,g,m,T,b,w,M,W,Y,j,J,$){var ne=this;if(f.byteLength>0&&g!=null&&g.key!=null&&g.method==="AES-128"){var Q=this.decrypter;Q==null&&(Q=this.decrypter=new A.default(this.observer,this.config));var ce=He();Q.decrypt(f,g.key.buffer,g.iv.buffer,function(fe){var pe=He();ne.observer.trigger(F.default.FRAG_DECRYPTED,{stats:{tstart:ce,tdecrypt:pe}}),ne.pushDecrypted(new Uint8Array(fe),g,new Uint8Array(m),T,b,w,M,W,Y,j,J,$)})}else this.pushDecrypted(new Uint8Array(f),g,new Uint8Array(m),T,b,w,M,W,Y,j,J,$)},D.pushDecrypted=function(f,g,m,T,b,w,M,W,Y,j,J,$){var ne=this.demuxer,Q=this.remuxer;if(!ne||M||W){for(var ce=this.observer,fe=this.typeSupported,pe=this.config,Le=[{demux:Ge,remux:ht},{demux:ie.default,remux:Tt},{demux:ae,remux:ht},{demux:Pe,remux:ht}],xe,Ne=0,Re=Le.length;Ne<Re&&(xe=Le[Ne],!xe.demux.probe(f));Ne++);if(!xe){ce.trigger(F.default.ERROR,{type:G.ErrorTypes.MEDIA_ERROR,details:G.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});return}(!Q||!(Q instanceof xe.remux))&&(Q=new xe.remux(ce,pe,fe,this.vendor)),(!ne||!(ne instanceof xe.demux))&&(ne=new xe.demux(ce,Q,pe,fe),this.probe=xe.demux.probe),this.demuxer=ne,this.remuxer=Q}(M||W)&&(ne.resetInitSegment(m,T,b,j),Q.resetInitSegment()),M&&(ne.resetTimeStamp($),Q.resetTimeStamp($)),typeof ne.setDecryptData=="function"&&ne.setDecryptData(g),ne.append(f,w,Y,J)},y}();O.default=Bt},"./src/demux/demuxer-worker.js":function(C,O,L){L.r(O);var F=L("./src/demux/demuxer-inline.js"),G=L("./src/events.js"),A=L("./src/utils/logger.js"),q=L("./node_modules/eventemitter3/index.js"),d=function(X){var E=new q.EventEmitter;E.trigger=function(_){for(var k=arguments.length,N=new Array(k>1?k-1:0),U=1;U<k;U++)N[U-1]=arguments[U];E.emit.apply(E,[_,_].concat(N))},E.off=function(_){for(var k=arguments.length,N=new Array(k>1?k-1:0),U=1;U<k;U++)N[U-1]=arguments[U];E.removeListener.apply(E,[_].concat(N))};var S=function(_,k){X.postMessage({event:_,data:k})};X.addEventListener("message",function(I){var _=I.data;switch(_.cmd){case"init":var k=JSON.parse(_.config);X.demuxer=new F.default(E,_.typeSupported,k,_.vendor),Object(A.enableLogs)(k.debug),S("init",null);break;case"demux":X.demuxer.push(_.data,_.decryptdata,_.initSegment,_.audioCodec,_.videoCodec,_.timeOffset,_.discontinuity,_.trackSwitch,_.contiguous,_.duration,_.accurateTimeOffset,_.defaultInitPTS);break}}),E.on(G.default.FRAG_DECRYPTED,S),E.on(G.default.FRAG_PARSING_INIT_SEGMENT,S),E.on(G.default.FRAG_PARSED,S),E.on(G.default.ERROR,S),E.on(G.default.FRAG_PARSING_METADATA,S),E.on(G.default.FRAG_PARSING_USERDATA,S),E.on(G.default.INIT_PTS_FOUND,S),E.on(G.default.FRAG_PARSING_DATA,function(I,_){var k=[],N={event:I,data:_};_.data1&&(N.data1=_.data1.buffer,k.push(_.data1.buffer),delete _.data1),_.data2&&(N.data2=_.data2.buffer,k.push(_.data2.buffer),delete _.data2),X.postMessage(N,k)})};O.default=d},"./src/demux/id3.js":function(C,O,L){L.r(O),L.d(O,"utf8ArrayToStr",function(){return d});var F=L("./src/utils/get-self-scope.js"),G=function(){function h(){}return h.isHeader=function(E,S){return S+10<=E.length&&E[S]===73&&E[S+1]===68&&E[S+2]===51&&E[S+3]<255&&E[S+4]<255&&E[S+6]<128&&E[S+7]<128&&E[S+8]<128&&E[S+9]<128},h.isFooter=function(E,S){return S+10<=E.length&&E[S]===51&&E[S+1]===68&&E[S+2]===73&&E[S+3]<255&&E[S+4]<255&&E[S+6]<128&&E[S+7]<128&&E[S+8]<128&&E[S+9]<128},h.getID3Data=function(E,S){for(var I=S,_=0;h.isHeader(E,S);){_+=10;var k=h._readSize(E,S+6);_+=k,h.isFooter(E,S+10)&&(_+=10),S+=_}if(_>0)return E.subarray(I,I+_)},h._readSize=function(E,S){var I=0;return I=(E[S]&127)<<21,I|=(E[S+1]&127)<<14,I|=(E[S+2]&127)<<7,I|=E[S+3]&127,I},h.getTimeStamp=function(E){for(var S=h.getID3Frames(E),I=0;I<S.length;I++){var _=S[I];if(h.isTimeStampFrame(_))return h._readTimeStamp(_)}},h.isTimeStampFrame=function(E){return E&&E.key==="PRIV"&&E.info==="com.apple.streaming.transportStreamTimestamp"},h._getFrameData=function(E){var S=String.fromCharCode(E[0],E[1],E[2],E[3]),I=h._readSize(E,4),_=10;return{type:S,size:I,data:E.subarray(_,_+I)}},h.getID3Frames=function(E){for(var S=0,I=[];h.isHeader(E,S);){var _=h._readSize(E,S+6);S+=10;for(var k=S+_;S+8<k;){var N=h._getFrameData(E.subarray(S)),U=h._decodeFrame(N);U&&I.push(U),S+=N.size+10}h.isFooter(E,S)&&(S+=10)}return I},h._decodeFrame=function(E){return E.type==="PRIV"?h._decodePrivFrame(E):E.type[0]==="W"?h._decodeURLFrame(E):h._decodeTextFrame(E)},h._readTimeStamp=function(E){if(E.data.byteLength===8){var S=new Uint8Array(E.data),I=S[3]&1,_=(S[4]<<23)+(S[5]<<15)+(S[6]<<7)+S[7];return _/=45,I&&(_+=4772185884e-2),Math.round(_)}},h._decodePrivFrame=function(E){if(!(E.size<2)){var S=h._utf8ArrayToStr(E.data,!0),I=new Uint8Array(E.data.subarray(S.length+1));return{key:E.type,info:S,data:I.buffer}}},h._decodeTextFrame=function(E){if(!(E.size<2))if(E.type==="TXXX"){var S=1,I=h._utf8ArrayToStr(E.data.subarray(S),!0);S+=I.length+1;var _=h._utf8ArrayToStr(E.data.subarray(S));return{key:E.type,info:I,data:_}}else{var k=h._utf8ArrayToStr(E.data.subarray(1));return{key:E.type,data:k}}},h._decodeURLFrame=function(E){if(E.type==="WXXX"){if(E.size<2)return;var S=1,I=h._utf8ArrayToStr(E.data.subarray(S),!0);S+=I.length+1;var _=h._utf8ArrayToStr(E.data.subarray(S));return{key:E.type,info:I,data:_}}else{var k=h._utf8ArrayToStr(E.data);return{key:E.type,data:k}}},h._utf8ArrayToStr=function(E,S){S===void 0&&(S=!1);var I=q();if(I){var _=I.decode(E);if(S){var k=_.indexOf("\0");return k!==-1?_.substring(0,k):_}return _.replace(/\0/g,"")}for(var N=E.length,U,ee,K,V="",te=0;te<N;){if(U=E[te++],U===0&&S)return V;if(U===0||U===3)continue;switch(U>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:V+=String.fromCharCode(U);break;case 12:case 13:ee=E[te++],V+=String.fromCharCode((U&31)<<6|ee&63);break;case 14:ee=E[te++],K=E[te++],V+=String.fromCharCode((U&15)<<12|(ee&63)<<6|(K&63)<<0);break}}return V},h}(),A;function q(){var h=Object(F.getSelfScope)();return!A&&typeof h.TextDecoder<"u"&&(A=new h.TextDecoder("utf-8")),A}var d=G._utf8ArrayToStr;O.default=G},"./src/demux/mp4demuxer.js":function(C,O,L){L.r(O);var F=L("./src/utils/logger.js"),G=L("./src/events.js"),A=Math.pow(2,32)-1,q=function(){function d(X,E){this.observer=X,this.remuxer=E}var h=d.prototype;return h.resetTimeStamp=function(E){this.initPTS=E},h.resetInitSegment=function(E,S,I,_){if(E&&E.byteLength){var k=this.initData=d.parseInitSegment(E);S==null&&(S="mp4a.40.5"),I==null&&(I="avc1.42e01e");var N={};k.audio&&k.video?N.audiovideo={container:"video/mp4",codec:S+","+I,initSegment:_?E:null}:(k.audio&&(N.audio={container:"audio/mp4",codec:S,initSegment:_?E:null}),k.video&&(N.video={container:"video/mp4",codec:I,initSegment:_?E:null})),this.observer.trigger(G.default.FRAG_PARSING_INIT_SEGMENT,{tracks:N})}else S&&(this.audioCodec=S),I&&(this.videoCodec=I)},d.probe=function(E){return d.findBox({data:E,start:0,end:Math.min(E.length,16384)},["moof"]).length>0},d.bin2str=function(E){return String.fromCharCode.apply(null,E)},d.readUint16=function(E,S){E.data&&(S+=E.start,E=E.data);var I=E[S]<<8|E[S+1];return I<0?65536+I:I},d.readUint32=function(E,S){E.data&&(S+=E.start,E=E.data);var I=E[S]<<24|E[S+1]<<16|E[S+2]<<8|E[S+3];return I<0?4294967296+I:I},d.writeUint32=function(E,S,I){E.data&&(S+=E.start,E=E.data),E[S]=I>>24,E[S+1]=I>>16&255,E[S+2]=I>>8&255,E[S+3]=I&255},d.findBox=function(E,S){var I=[],_,k,N,U,ee,K,V;if(E.data?(K=E.start,U=E.end,E=E.data):(K=0,U=E.byteLength),!S.length)return null;for(_=K;_<U;)k=d.readUint32(E,_),N=d.bin2str(E.subarray(_+4,_+8)),V=k>1?_+k:U,N===S[0]&&(S.length===1?I.push({data:E,start:_+8,end:V}):(ee=d.findBox({data:E,start:_+8,end:V},S.slice(1)),ee.length&&(I=I.concat(ee)))),_=V;return I},d.parseSegmentIndex=function(E){var S=d.findBox(E,["moov"])[0],I=S?S.end:null,_=0,k=d.findBox(E,["sidx"]),N;if(!k||!k[0])return null;N=[],k=k[0];var U=k.data[0];_=U===0?8:16;var ee=d.readUint32(k,_);_+=4;var K=0,V=0;U===0?_+=8:_+=16,_+=2;var te=k.end+V,ae=d.readUint16(k,_);_+=2;for(var ie=0;ie<ae;ie++){var oe=_,ue=d.readUint32(k,oe);oe+=4;var be=ue&2147483647,Ce=(ue&2147483648)>>>31;if(Ce===1){console.warn("SIDX has hierarchical references (not supported)");return}var ke=d.readUint32(k,oe);oe+=4,N.push({referenceSize:be,subsegmentDuration:ke,info:{duration:ke/ee,start:te,end:te+be-1}}),te+=be,oe+=4,_=oe}return{earliestPresentationTime:K,timescale:ee,version:U,referencesCount:ae,references:N,moovEndOffset:I}},d.parseInitSegment=function(E){var S=[],I=d.findBox(E,["moov","trak"]);return I.forEach(function(_){var k=d.findBox(_,["tkhd"])[0];if(k){var N=k.data[k.start],U=N===0?12:20,ee=d.readUint32(k,U),K=d.findBox(_,["mdia","mdhd"])[0];if(K){N=K.data[K.start],U=N===0?12:20;var V=d.readUint32(K,U),te=d.findBox(_,["mdia","hdlr"])[0];if(te){var ae=d.bin2str(te.data.subarray(te.start+8,te.start+12)),ie={soun:"audio",vide:"video"}[ae];if(ie){var oe=d.findBox(_,["mdia","minf","stbl","stsd"]);if(oe.length){oe=oe[0];var ue=d.bin2str(oe.data.subarray(oe.start+12,oe.start+16));F.logger.log("MP4Demuxer:"+ie+":"+ue+" found")}S[ee]={timescale:V,type:ie},S[ie]={timescale:V,id:ee}}}}}}),S},d.getStartDTS=function(E,S){var I,_,k;return I=d.findBox(S,["moof","traf"]),_=[].concat.apply([],I.map(function(N){return d.findBox(N,["tfhd"]).map(function(U){var ee,K,V;return ee=d.readUint32(U,4),K=E[ee].timescale||9e4,V=d.findBox(N,["tfdt"]).map(function(te){var ae,ie;return ae=te.data[te.start],ie=d.readUint32(te,4),ae===1&&(ie*=Math.pow(2,32),ie+=d.readUint32(te,8)),ie})[0],V/K})})),k=Math.min.apply(null,_),isFinite(k)?k:0},d.offsetStartDTS=function(E,S,I){d.findBox(S,["moof","traf"]).map(function(_){return d.findBox(_,["tfhd"]).map(function(k){var N=d.readUint32(k,4),U=E[N].timescale||9e4;d.findBox(_,["tfdt"]).map(function(ee){var K=ee.data[ee.start],V=d.readUint32(ee,4);if(K===0)d.writeUint32(ee,4,V-I*U);else{V*=Math.pow(2,32),V+=d.readUint32(ee,8),V-=I*U,V=Math.max(V,0);var te=Math.floor(V/(A+1)),ae=Math.floor(V%(A+1));d.writeUint32(ee,4,te),d.writeUint32(ee,8,ae)}})})})},h.append=function(E,S,I,_){var k=this.initData;k||(this.resetInitSegment(E,this.audioCodec,this.videoCodec,!1),k=this.initData);var N,U=this.initPTS;if(U===void 0){var ee=d.getStartDTS(k,E);this.initPTS=U=ee-S,this.observer.trigger(G.default.INIT_PTS_FOUND,{initPTS:U})}d.offsetStartDTS(k,E,U),N=d.getStartDTS(k,E),this.remuxer.remux(k.audio,k.video,null,null,N,I,_,E)},h.destroy=function(){},d}();O.default=q},"./src/errors.ts":function(C,O,L){L.r(O),L.d(O,"ErrorTypes",function(){return F}),L.d(O,"ErrorDetails",function(){return G});var F;(function(A){A.NETWORK_ERROR="networkError",A.MEDIA_ERROR="mediaError",A.KEY_SYSTEM_ERROR="keySystemError",A.MUX_ERROR="muxError",A.OTHER_ERROR="otherError"})(F||(F={}));var G;(function(A){A.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",A.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",A.KEY_SYSTEM_NO_SESSION="keySystemNoSession",A.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",A.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",A.MANIFEST_LOAD_ERROR="manifestLoadError",A.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",A.MANIFEST_PARSING_ERROR="manifestParsingError",A.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",A.LEVEL_EMPTY_ERROR="levelEmptyError",A.LEVEL_LOAD_ERROR="levelLoadError",A.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",A.LEVEL_SWITCH_ERROR="levelSwitchError",A.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",A.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",A.FRAG_LOAD_ERROR="fragLoadError",A.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",A.FRAG_DECRYPT_ERROR="fragDecryptError",A.FRAG_PARSING_ERROR="fragParsingError",A.REMUX_ALLOC_ERROR="remuxAllocError",A.KEY_LOAD_ERROR="keyLoadError",A.KEY_LOAD_TIMEOUT="keyLoadTimeOut",A.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",A.BUFFER_APPEND_ERROR="bufferAppendError",A.BUFFER_APPENDING_ERROR="bufferAppendingError",A.BUFFER_STALLED_ERROR="bufferStalledError",A.BUFFER_FULL_ERROR="bufferFullError",A.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",A.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",A.INTERNAL_EXCEPTION="internalException"})(G||(G={}))},"./src/events.js":function(C,O,L){L.r(O);var F={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVELS_UPDATED:"hlsLevelsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",CUES_PARSED:"hlsCuesParsed",NON_NATIVE_TEXT_TRACKS_FOUND:"hlsNonNativeTextTracksFound",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition",LIVE_BACK_BUFFER_REACHED:"hlsLiveBackBufferReached"};O.default=F},"./src/hls.ts":function(C,O,L){L.r(O),L.d(O,"default",function(){return oi});var F={};L.r(F),L.d(F,"newCue",function(){return Zi});var G=L("./node_modules/url-toolkit/src/url-toolkit.js"),A=L("./src/errors.ts"),q=L("./src/polyfills/number.js"),d=L("./src/events.js"),h=L("./src/utils/logger.js"),X={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},E=function(){function o(i){this.hls=void 0,this.handledEvents=void 0,this.useGenericHandler=void 0,this.hls=i,this.onEvent=this.onEvent.bind(this);for(var r=arguments.length,e=new Array(r>1?r-1:0),t=1;t<r;t++)e[t-1]=arguments[t];this.handledEvents=e,this.useGenericHandler=!0,this.registerListeners()}var a=o.prototype;return a.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},a.onHandlerDestroying=function(){},a.onHandlerDestroyed=function(){},a.isEventHandler=function(){return typeof this.handledEvents=="object"&&this.handledEvents.length&&typeof this.onEvent=="function"},a.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(r){if(X[r])throw new Error("Forbidden event-name: "+r);this.hls.on(r,this.onEvent)},this)},a.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(r){this.hls.off(r,this.onEvent)},this)},a.onEvent=function(r,e){this.onEventGeneric(r,e)},a.onEventGeneric=function(r,e){var t=function(s,l){var u="on"+s.replace("hls","");if(typeof this[u]!="function")throw new Error("Event "+s+" has no generic handler in this "+this.constructor.name+" class (tried "+u+")");return this[u].bind(this,l)};try{t.call(this,r,e).call()}catch(n){h.logger.error("An internal error happened while handling event "+r+'. Error message: "'+n.message+'". Here is a stacktrace:',n),this.hls.trigger(d.default.ERROR,{type:A.ErrorTypes.OTHER_ERROR,details:A.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:r,err:n})}},o}(),S=E,I;(function(o){o.MANIFEST="manifest",o.LEVEL="level",o.AUDIO_TRACK="audioTrack",o.SUBTITLE_TRACK="subtitleTrack"})(I||(I={}));var _;(function(o){o.MAIN="main",o.AUDIO="audio",o.SUBTITLE="subtitle"})(_||(_={}));var k=L("./src/demux/mp4demuxer.js");function N(o,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function U(o,a,i){return a&&N(o.prototype,a),i&&N(o,i),o}var ee=function(){function o(a,i){this._uri=null,this.baseuri=void 0,this.reluri=void 0,this.method=null,this.key=null,this.iv=null,this.baseuri=a,this.reluri=i}return U(o,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=Object(G.buildAbsoluteURL)(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),o}();function K(o,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function V(o,a,i){return a&&K(o.prototype,a),i&&K(o,i),o}var te;(function(o){o.AUDIO="audio",o.VIDEO="video"})(te||(te={}));var ae=function(){function o(){var i;this._url=null,this._byteRange=null,this._decryptdata=null,this._elementaryStreams=(i={},i[te.AUDIO]=!1,i[te.VIDEO]=!1,i),this.deltaPTS=0,this.rawProgramDateTime=null,this.programDateTime=null,this.title=null,this.tagList=[],this.cc=void 0,this.type=void 0,this.relurl=void 0,this.baseurl=void 0,this.duration=void 0,this.start=void 0,this.sn=0,this.urlId=0,this.level=0,this.levelkey=void 0,this.loader=void 0}var a=o.prototype;return a.setByteRange=function(r,e){var t=r.split("@",2),n=[];t.length===1?n[0]=e?e.byteRangeEndOffset:0:n[0]=parseInt(t[1]),n[1]=parseInt(t[0])+n[0],this._byteRange=n},a.addElementaryStream=function(r){this._elementaryStreams[r]=!0},a.hasElementaryStream=function(r){return this._elementaryStreams[r]===!0},a.createInitializationVector=function(r){for(var e=new Uint8Array(16),t=12;t<16;t++)e[t]=r>>8*(15-t)&255;return e},a.setDecryptDataFromLevelKey=function(r,e){var t=r;return r!=null&&r.method&&r.uri&&!r.iv&&(t=new ee(r.baseuri,r.reluri),t.method=r.method,t.iv=this.createInitializationVector(e)),t},V(o,[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=Object(G.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(r){this._url=r}},{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var r=this.sn;typeof r!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&h.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),r=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,r)}return this._decryptdata}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(q.isFiniteNumber)(this.programDateTime))return null;var r=Object(q.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+r*1e3}},{key:"encrypted",get:function(){return!!(this.decryptdata&&this.decryptdata.uri!==null&&this.decryptdata.key===null)}}]),o}();function ie(o,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function oe(o,a,i){return a&&ie(o.prototype,a),i&&ie(o,i),o}var ue=function(){function o(a){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=a,this.version=null}return oe(o,[{key:"hasProgramDateTime",get:function(){return!!(this.fragments[0]&&Object(q.isFiniteNumber)(this.fragments[0].programDateTime))}}]),o}(),be=/^(\d+)x(\d+)$/,Ce=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,ke=function(){function o(i){typeof i=="string"&&(i=o.parseAttrList(i));for(var r in i)i.hasOwnProperty(r)&&(this[r]=i[r])}var a=o.prototype;return a.decimalInteger=function(r){var e=parseInt(this[r],10);return e>Number.MAX_SAFE_INTEGER?1/0:e},a.hexadecimalInteger=function(r){if(this[r]){var e=(this[r]||"0x").slice(2);e=(e.length&1?"0":"")+e;for(var t=new Uint8Array(e.length/2),n=0;n<e.length/2;n++)t[n]=parseInt(e.slice(n*2,n*2+2),16);return t}else return null},a.hexadecimalIntegerAsNumber=function(r){var e=parseInt(this[r],16);return e>Number.MAX_SAFE_INTEGER?1/0:e},a.decimalFloatingPoint=function(r){return parseFloat(this[r])},a.enumeratedString=function(r){return this[r]},a.decimalResolution=function(r){var e=be.exec(this[r]);if(e!==null)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}},o.parseAttrList=function(r){var e,t={};for(Ce.lastIndex=0;(e=Ce.exec(r))!==null;){var n=e[2],s='"';n.indexOf(s)===0&&n.lastIndexOf(s)===n.length-1&&(n=n.slice(1,-1)),t[e[1]]=n}return t},o}(),De=ke,ut={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};function Fe(o,a){var i=ut[a];return!!i&&i[o.slice(0,4)]===!0}function Ge(o,a){return MediaSource.isTypeSupported((a||"video")+'/mp4;codecs="'+o+'"')}var Ke=/(?:#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)|#EXT-X-SESSION-DATA:([^\n\r]*)[\r\n]+)/g,Pe=/#EXT-X-MEDIA:(.*)/g,Me=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),je=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,me=/\.(mp4|m4s|m4v|m4a)$/i,Je=function(){function o(){}return o.findGroup=function(i,r){for(var e=0;e<i.length;e++){var t=i[e];if(t.id===r)return t}},o.convertAVC1ToAVCOTI=function(i){var r=i.split("."),e;return r.length>2?(e=r.shift()+".",e+=parseInt(r.shift()).toString(16),e+=("000"+parseInt(r.shift()).toString(16)).substr(-4)):e=i,e},o.resolve=function(i,r){return G.buildAbsoluteURL(r,i,{alwaysNormalize:!0})},o.parseMasterPlaylist=function(i,r){var e=[],t={},n=!1;Ke.lastIndex=0;function s(R,P){["video","audio"].forEach(function(z){var re=R.filter(function(le){return Fe(le,z)});if(re.length){var de=re.filter(function(le){return le.lastIndexOf("avc1",0)===0||le.lastIndexOf("mp4a",0)===0});P[z+"Codec"]=de.length>0?de[0]:re[0],R=R.filter(function(le){return re.indexOf(le)===-1})}}),P.unknownCodecs=R}for(var l;(l=Ke.exec(i))!=null;)if(l[1]){var u={},c=u.attrs=new De(l[1]);u.url=o.resolve(l[2],r);var v=c.decimalResolution("RESOLUTION");v&&(u.width=v.width,u.height=v.height),u.bitrate=c.decimalInteger("AVERAGE-BANDWIDTH")||c.decimalInteger("BANDWIDTH"),u.name=c.NAME,s([].concat((c.CODECS||"").split(/[ ,]+/)),u),u.videoCodec&&u.videoCodec.indexOf("avc1")!==-1&&(u.videoCodec=o.convertAVC1ToAVCOTI(u.videoCodec)),e.push(u)}else if(l[3]){var p=new De(l[3]);p["DATA-ID"]&&(n=!0,t[p["DATA-ID"]]=p)}return{levels:e,sessionData:n?t:null}},o.parseMasterPlaylistMedia=function(i,r,e,t){t===void 0&&(t=[]);var n,s=[],l=0;for(Pe.lastIndex=0;(n=Pe.exec(i))!==null;){var u=new De(n[1]);if(u.TYPE===e){var c={attrs:u,id:l++,groupId:u["GROUP-ID"],instreamId:u["INSTREAM-ID"],name:u.NAME||u.LANGUAGE,type:e,default:u.DEFAULT==="YES",autoselect:u.AUTOSELECT==="YES",forced:u.FORCED==="YES",lang:u.LANGUAGE};if(u.URI&&(c.url=o.resolve(u.URI,r)),t.length){var v=o.findGroup(t,c.groupId);c.audioCodec=v?v.codec:t[0].codec}s.push(c)}}return s},o.parseLevelPlaylist=function(i,r,e,t,n){var s=0,l=0,u=new ue(r),c=0,v=null,p=new ae,R,P,z,re=null;for(Me.lastIndex=0;(R=Me.exec(i))!==null;){var de=R[1];if(de){p.duration=parseFloat(de);var le=(" "+R[2]).slice(1);p.title=le||null,p.tagList.push(le?["INF",de,le]:["INF",de])}else if(R[3]){if(Object(q.isFiniteNumber)(p.duration)){var ge=s++;p.type=t,p.start=l,z&&(p.levelkey=z),p.sn=ge,p.level=e,p.cc=c,p.urlId=n,p.baseurl=r,p.relurl=(" "+R[3]).slice(1),vt(p,v),u.fragments.push(p),v=p,l+=p.duration,p=new ae}}else if(R[4]){var ve=(" "+R[4]).slice(1);v?p.setByteRange(ve,v):p.setByteRange(ve)}else if(R[5])p.rawProgramDateTime=(" "+R[5]).slice(1),p.tagList.push(["PROGRAM-DATE-TIME",p.rawProgramDateTime]),re===null&&(re=u.fragments.length);else{if(R=R[0].match(je),!R){h.logger.warn("No matches on slow regex match for level playlist!");continue}for(P=1;P<R.length&&!(typeof R[P]<"u");P++);var _e=(" "+R[P+1]).slice(1),We=(" "+R[P+2]).slice(1);switch(R[P]){case"#":p.tagList.push(We?[_e,We]:[_e]);break;case"PLAYLIST-TYPE":u.type=_e.toUpperCase();break;case"MEDIA-SEQUENCE":s=u.startSN=parseInt(_e);break;case"TARGETDURATION":u.targetduration=parseFloat(_e);break;case"VERSION":u.version=parseInt(_e);break;case"EXTM3U":break;case"ENDLIST":u.live=!1;break;case"DIS":c++,p.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":c=parseInt(_e);break;case"KEY":{var ct=_e,it=new De(ct),Lt=it.enumeratedString("METHOD"),he=it.URI,Ee=it.hexadecimalInteger("IV"),ze=it.KEYFORMAT||"identity";if(ze==="com.apple.streamingkeydelivery"){h.logger.warn("Keyformat com.apple.streamingkeydelivery is not supported");continue}Lt&&(z=new ee(r,he),he&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(Lt)>=0&&(z.method=Lt,z.key=null,z.iv=Ee));break}case"START":{var Wt=new De(_e),Vt=Wt.decimalFloatingPoint("TIME-OFFSET");Object(q.isFiniteNumber)(Vt)&&(u.startTimeOffset=Vt);break}case"MAP":{var Jt=new De(_e);p.relurl=Jt.URI,Jt.BYTERANGE&&p.setByteRange(Jt.BYTERANGE),p.baseurl=r,p.level=e,p.type=t,p.sn="initSegment",u.initSegment=p,p=new ae,p.rawProgramDateTime=u.initSegment.rawProgramDateTime;break}default:h.logger.warn("line parsed but not handled: "+R);break}}}return p=v,p&&!p.relurl&&(u.fragments.pop(),l-=p.duration),u.totalduration=l,u.averagetargetduration=l/u.fragments.length,u.endSN=s-1,u.startCC=u.fragments[0]?u.fragments[0].cc:0,u.endCC=c,!u.initSegment&&u.fragments.length&&u.fragments.every(function(dr){return me.test(dr.relurl)})&&(h.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),p=new ae,p.relurl=u.fragments[0].relurl,p.baseurl=r,p.level=e,p.type=t,p.sn="initSegment",u.initSegment=p,u.needSidxRanges=!0),re&&Ie(u.fragments,re),u},o}();function Ie(o,a){for(var i=o[a],r=a-1;r>=0;r--){var e=o[r];e.programDateTime=i.programDateTime-e.duration*1e3,i=e}}function vt(o,a){o.rawProgramDateTime?o.programDateTime=Date.parse(o.rawProgramDateTime):a!=null&&a.programDateTime&&(o.programDateTime=a.endProgramDateTime),Object(q.isFiniteNumber)(o.programDateTime)||(o.programDateTime=null,o.rawProgramDateTime=null)}function dt(o,a){o.prototype=Object.create(a.prototype),o.prototype.constructor=o,o.__proto__=a}var Ae=window,Ve=Ae.performance,et=function(o){dt(a,o);function a(r){var e;return e=o.call(this,r,d.default.MANIFEST_LOADING,d.default.LEVEL_LOADING,d.default.AUDIO_TRACK_LOADING,d.default.SUBTITLE_TRACK_LOADING)||this,e.loaders={},e}a.canHaveQualityLevels=function(e){return e!==I.AUDIO_TRACK&&e!==I.SUBTITLE_TRACK},a.mapContextToLevelType=function(e){var t=e.type;switch(t){case I.AUDIO_TRACK:return _.AUDIO;case I.SUBTITLE_TRACK:return _.SUBTITLE;default:return _.MAIN}},a.getResponseUrl=function(e,t){var n=e.url;return(n===void 0||n.indexOf("data:")===0)&&(n=t.url),n};var i=a.prototype;return i.createInternalLoader=function(e){var t=this.hls.config,n=t.pLoader,s=t.loader,l=n||s,u=new l(t);return e.loader=u,this.loaders[e.type]=u,u},i.getInternalLoader=function(e){return this.loaders[e.type]},i.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},i.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},i.destroy=function(){this.destroyInternalLoaders(),o.prototype.destroy.call(this)},i.onManifestLoading=function(e){this.load({url:e.url,type:I.MANIFEST,level:0,id:null,responseType:"text"})},i.onLevelLoading=function(e){this.load({url:e.url,type:I.LEVEL,level:e.level,id:e.id,responseType:"text"})},i.onAudioTrackLoading=function(e){this.load({url:e.url,type:I.AUDIO_TRACK,level:null,id:e.id,responseType:"text"})},i.onSubtitleTrackLoading=function(e){this.load({url:e.url,type:I.SUBTITLE_TRACK,level:null,id:e.id,responseType:"text"})},i.load=function(e){var t=this.hls.config;h.logger.debug("Loading playlist of type "+e.type+", level: "+e.level+", id: "+e.id);var n=this.getInternalLoader(e);if(n){var s=n.context;if(s&&s.url===e.url)return h.logger.trace("playlist request ongoing"),!1;h.logger.warn("aborting previous loader for type: "+e.type),n.abort()}var l,u,c,v;switch(e.type){case I.MANIFEST:l=t.manifestLoadingMaxRetry,u=t.manifestLoadingTimeOut,c=t.manifestLoadingRetryDelay,v=t.manifestLoadingMaxRetryTimeout;break;case I.LEVEL:l=0,v=0,c=0,u=t.levelLoadingTimeOut;break;default:l=t.levelLoadingMaxRetry,u=t.levelLoadingTimeOut,c=t.levelLoadingRetryDelay,v=t.levelLoadingMaxRetryTimeout;break}n=this.createInternalLoader(e);var p={timeout:u,maxRetry:l,retryDelay:c,maxRetryDelay:v},R={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return h.logger.debug("Calling internal loader delegate for URL: "+e.url),n.load(e,p,R),!0},i.loadsuccess=function(e,t,n,s){if(s===void 0&&(s=null),n.isSidxRequest){this._handleSidxRequest(e,n),this._handlePlaylistLoaded(e,t,n,s);return}if(this.resetInternalLoader(n.type),typeof e.data!="string")throw new Error('expected responseType of "text" for PlaylistLoader');var l=e.data;if(t.tload=Ve.now(),l.indexOf("#EXTM3U")!==0){this._handleManifestParsingError(e,n,"no EXTM3U delimiter",s);return}l.indexOf("#EXTINF:")>0||l.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(e,t,n,s):this._handleMasterPlaylist(e,t,n,s)},i.loaderror=function(e,t,n){n===void 0&&(n=null),this._handleNetworkError(t,n,!1,e)},i.loadtimeout=function(e,t,n){n===void 0&&(n=null),this._handleNetworkError(t,n,!0)},i._handleMasterPlaylist=function(e,t,n,s){var l=this.hls,u=e.data,c=a.getResponseUrl(e,n),v=Je.parseMasterPlaylist(u,c),p=v.levels,R=v.sessionData;if(!p.length){this._handleManifestParsingError(e,n,"no level found in manifest",s);return}var P=p.map(function(ge){return{id:ge.attrs.AUDIO,codec:ge.audioCodec}}),z=Je.parseMasterPlaylistMedia(u,c,"AUDIO",P),re=Je.parseMasterPlaylistMedia(u,c,"SUBTITLES"),de=Je.parseMasterPlaylistMedia(u,c,"CLOSED-CAPTIONS");if(z.length){var le=!1;z.forEach(function(ge){ge.url||(le=!0)}),le===!1&&p[0].audioCodec&&!p[0].attrs.AUDIO&&(h.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),z.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:{},url:""}))}l.trigger(d.default.MANIFEST_LOADED,{levels:p,audioTracks:z,subtitles:re,captions:de,url:c,stats:t,networkDetails:s,sessionData:R})},i._handleTrackOrLevelPlaylist=function(e,t,n,s){var l=this.hls,u=n.id,c=n.level,v=n.type,p=a.getResponseUrl(e,n),R=Object(q.isFiniteNumber)(u)?u:0,P=Object(q.isFiniteNumber)(c)?c:R,z=a.mapContextToLevelType(n),re=Je.parseLevelPlaylist(e.data,p,P,z,R);if(re.tload=t.tload,!re.fragments.length){l.trigger(d.default.ERROR,{type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:p,reason:"no fragments found in level",level:typeof n.level=="number"?n.level:void 0});return}if(v===I.MANIFEST){var de={url:p,details:re};l.trigger(d.default.MANIFEST_LOADED,{levels:[de],audioTracks:[],url:p,stats:t,networkDetails:s,sessionData:null})}if(t.tparsed=Ve.now(),re.needSidxRanges){var le=re.initSegment.url;this.load({url:le,isSidxRequest:!0,type:v,level:c,levelDetails:re,id:u,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"});return}n.levelDetails=re,this._handlePlaylistLoaded(e,t,n,s)},i._handleSidxRequest=function(e,t){if(typeof e.data=="string")throw new Error("sidx request must be made with responseType of array buffer");var n=k.default.parseSegmentIndex(new Uint8Array(e.data));if(n){var s=n.references,l=t.levelDetails;s.forEach(function(u,c){var v=u.info;if(l){var p=l.fragments[c];p.byteRange.length===0&&p.setByteRange(String(1+v.end-v.start)+"@"+String(v.start))}}),l&&l.initSegment.setByteRange(String(n.moovEndOffset)+"@0")}},i._handleManifestParsingError=function(e,t,n,s){this.hls.trigger(d.default.ERROR,{type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:e.url,reason:n,networkDetails:s})},i._handleNetworkError=function(e,t,n,s){n===void 0&&(n=!1),s===void 0&&(s=null),h.logger.info("A network error occured while loading a "+e.type+"-type playlist");var l,u,c=this.getInternalLoader(e);switch(e.type){case I.MANIFEST:l=n?A.ErrorDetails.MANIFEST_LOAD_TIMEOUT:A.ErrorDetails.MANIFEST_LOAD_ERROR,u=!0;break;case I.LEVEL:l=n?A.ErrorDetails.LEVEL_LOAD_TIMEOUT:A.ErrorDetails.LEVEL_LOAD_ERROR,u=!1;break;case I.AUDIO_TRACK:l=n?A.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:A.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,u=!1;break;default:u=!1}c&&(c.abort(),this.resetInternalLoader(e.type));var v={type:A.ErrorTypes.NETWORK_ERROR,details:l,fatal:u,url:e.url,loader:c,context:e,networkDetails:t};s&&(v.response=s),this.hls.trigger(d.default.ERROR,v)},i._handlePlaylistLoaded=function(e,t,n,s){var l=n.type,u=n.level,c=n.id,v=n.levelDetails;if(!v||!v.targetduration){this._handleManifestParsingError(e,n,"invalid target duration",s);return}var p=a.canHaveQualityLevels(n.type);if(p)this.hls.trigger(d.default.LEVEL_LOADED,{details:v,level:u||0,id:c||0,stats:t,networkDetails:s});else switch(l){case I.AUDIO_TRACK:this.hls.trigger(d.default.AUDIO_TRACK_LOADED,{details:v,id:c,stats:t,networkDetails:s});break;case I.SUBTITLE_TRACK:this.hls.trigger(d.default.SUBTITLE_TRACK_LOADED,{details:v,id:c,stats:t,networkDetails:s});break}},a}(S),nt=et;function st(o,a){o.prototype=Object.create(a.prototype),o.prototype.constructor=o,o.__proto__=a}var bt=function(o){st(a,o);function a(r){var e;return e=o.call(this,r,d.default.FRAG_LOADING)||this,e.loaders={},e}var i=a.prototype;return i.destroy=function(){var e=this.loaders;for(var t in e){var n=e[t];n&&n.destroy()}this.loaders={},o.prototype.destroy.call(this)},i.onFragLoading=function(e){var t=e.frag,n=t.type,s=this.loaders,l=this.hls.config,u=l.fLoader,c=l.loader;t.loaded=0;var v=s[n];v&&(h.logger.warn("abort previous fragment loader for type: "+n),v.abort()),v=s[n]=t.loader=l.fLoader?new u(l):new c(l);var p,R,P;p={url:t.url,frag:t,responseType:"arraybuffer",progressData:!1};var z=t.byteRangeStartOffset,re=t.byteRangeEndOffset;Object(q.isFiniteNumber)(z)&&Object(q.isFiniteNumber)(re)&&(p.rangeStart=z,p.rangeEnd=re),R={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:l.fragLoadingMaxRetryTimeout},P={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},v.load(p,R,P)},i.loadsuccess=function(e,t,n,s){s===void 0&&(s=null);var l=e.data,u=n.frag;u.loader=void 0,this.loaders[u.type]=void 0,this.hls.trigger(d.default.FRAG_LOADED,{payload:l,frag:u,stats:t,networkDetails:s})},i.loaderror=function(e,t,n){n===void 0&&(n=null);var s=t.frag,l=s.loader;l&&l.abort(),this.loaders[s.type]=void 0,this.hls.trigger(d.default.ERROR,{type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e,networkDetails:n})},i.loadtimeout=function(e,t,n){n===void 0&&(n=null);var s=t.frag,l=s.loader;l&&l.abort(),this.loaders[s.type]=void 0,this.hls.trigger(d.default.ERROR,{type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag,networkDetails:n})},i.loadprogress=function(e,t,n,s){s===void 0&&(s=null);var l=t.frag;l.loaded=e.loaded,this.hls.trigger(d.default.FRAG_LOAD_PROGRESS,{frag:l,stats:e,networkDetails:s})},a}(S),qe=bt;function ht(o,a){o.prototype=Object.create(a.prototype),o.prototype.constructor=o,o.__proto__=a}var Ye=function(o){ht(a,o);function a(r){var e;return e=o.call(this,r,d.default.KEY_LOADING)||this,e.loaders={},e.decryptkey=null,e.decrypturl=null,e}var i=a.prototype;return i.destroy=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},o.prototype.destroy.call(this)},i.onKeyLoading=function(e){var t=e.frag,n=t.type,s=this.loaders[n];if(!t.decryptdata){h.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var l=t.decryptdata.uri;if(l!==this.decrypturl||this.decryptkey===null){var u=this.hls.config;if(s&&(h.logger.warn("abort previous key loader for type:"+n),s.abort()),!l){h.logger.warn("key uri is falsy");return}t.loader=this.loaders[n]=new u.loader(u),this.decrypturl=l,this.decryptkey=null;var c={url:l,frag:t,responseType:"arraybuffer"},v={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:u.fragLoadingRetryDelay,maxRetryDelay:u.fragLoadingMaxRetryTimeout},p={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};t.loader.load(c,v,p)}else this.decryptkey&&(t.decryptdata.key=this.decryptkey,this.hls.trigger(d.default.KEY_LOADED,{frag:t}))},i.loadsuccess=function(e,t,n){var s=n.frag;if(!s.decryptdata){h.logger.error("after key load, decryptdata unset");return}this.decryptkey=s.decryptdata.key=new Uint8Array(e.data),s.loader=void 0,delete this.loaders[s.type],this.hls.trigger(d.default.KEY_LOADED,{frag:s})},i.loaderror=function(e,t){var n=t.frag,s=n.loader;s&&s.abort(),delete this.loaders[n.type],this.hls.trigger(d.default.ERROR,{type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:n,response:e})},i.loadtimeout=function(e,t){var n=t.frag,s=n.loader;s&&s.abort(),delete this.loaders[n.type],this.hls.trigger(d.default.ERROR,{type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:n})},a}(S),Tt=Ye;function ye(o,a){o.prototype=Object.create(a.prototype),o.prototype.constructor=o,o.__proto__=a}var He={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"},Bt=function(o){ye(a,o);function a(r){var e;return e=o.call(this,r,d.default.BUFFER_APPENDED,d.default.FRAG_BUFFERED,d.default.FRAG_LOADED)||this,e.bufferPadding=.2,e.fragments=Object.create(null),e.timeRanges=Object.create(null),e.config=r.config,e}var i=a.prototype;return i.destroy=function(){this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.config=null,S.prototype.destroy.call(this),o.prototype.destroy.call(this)},i.getBufferedFrag=function(e,t){var n=this.fragments,s=Object.keys(n).filter(function(u){var c=n[u];if(c.body.type!==t||!c.buffered)return!1;var v=c.body;return v.startPTS<=e&&e<=v.endPTS});if(s.length===0)return null;var l=s.pop();return n[l].body},i.detectEvictedFragments=function(e,t){var n=this;Object.keys(this.fragments).forEach(function(s){var l=n.fragments[s];if(!(!l||!l.buffered)){var u=l.range[e];if(u)for(var c=u.time,v=0;v<c.length;v++){var p=c[v];if(!n.isTimeBuffered(p.startPTS,p.endPTS,t)){n.removeFragment(l.body);break}}}})},i.detectPartialFragments=function(e){var t=this,n=this.getFragmentKey(e),s=this.fragments[n];s&&(s.buffered=!0,Object.keys(this.timeRanges).forEach(function(l){if(e.hasElementaryStream(l)){var u=t.timeRanges[l];s.range[l]=t.getBufferedTimes(e.startPTS,e.endPTS,u)}}))},i.getBufferedTimes=function(e,t,n){for(var s=[],l,u,c=!1,v=0;v<n.length;v++)if(l=n.start(v)-this.bufferPadding,u=n.end(v)+this.bufferPadding,e>=l&&t<=u){s.push({startPTS:Math.max(e,n.start(v)),endPTS:Math.min(t,n.end(v))});break}else if(e<u&&t>l)s.push({startPTS:Math.max(e,n.start(v)),endPTS:Math.min(t,n.end(v))}),c=!0;else if(t<=l)break;return{time:s,partial:c}},i.getFragmentKey=function(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn},i.getPartialFragment=function(e){var t=this,n,s,l,u=null,c=0;return Object.keys(this.fragments).forEach(function(v){var p=t.fragments[v];t.isPartial(p)&&(s=p.body.startPTS-t.bufferPadding,l=p.body.endPTS+t.bufferPadding,e>=s&&e<=l&&(n=Math.min(e-s,l-e),c<=n&&(u=p.body,c=n)))}),u},i.getState=function(e){var t=this.getFragmentKey(e),n=this.fragments[t],s=He.NOT_LOADED;return n!==void 0&&(n.buffered?this.isPartial(n)===!0?s=He.PARTIAL:s=He.OK:s=He.APPENDING),s},i.isPartial=function(e){return e.buffered===!0&&(e.range.video!==void 0&&e.range.video.partial===!0||e.range.audio!==void 0&&e.range.audio.partial===!0)},i.isTimeBuffered=function(e,t,n){for(var s,l,u=0;u<n.length;u++){if(s=n.start(u)-this.bufferPadding,l=n.end(u)+this.bufferPadding,e>=s&&t<=l)return!0;if(t<=s)return!1}return!1},i.onFragLoaded=function(e){var t=e.frag;!Object(q.isFiniteNumber)(t.sn)||t.bitrateTest||(this.fragments[this.getFragmentKey(t)]={body:t,range:Object.create(null),buffered:!1})},i.onBufferAppended=function(e){var t=this;this.timeRanges=e.timeRanges,Object.keys(this.timeRanges).forEach(function(n){var s=t.timeRanges[n];t.detectEvictedFragments(n,s)})},i.onFragBuffered=function(e){this.detectPartialFragments(e.frag)},i.hasFragment=function(e){var t=this.getFragmentKey(e);return this.fragments[t]!==void 0},i.removeFragment=function(e){var t=this.getFragmentKey(e);delete this.fragments[t]},i.removeAllFragments=function(){this.fragments=Object.create(null)},a}(S),y={search:function(a,i){for(var r=0,e=a.length-1,t=null,n=null;r<=e;){t=(r+e)/2|0,n=a[t];var s=i(n);if(s>0)r=t+1;else if(s<0)e=t-1;else return n}return null}},D=y,x=function(){function o(){}return o.isBuffered=function(i,r){try{if(i){for(var e=i.buffered,t=0;t<e.length;t++)if(r>=e.start(t)&&r<=e.end(t))return!0}}catch{}return!1},o.bufferInfo=function(i,r,e){try{if(i){var t=i.buffered,n=[],s;for(s=0;s<t.length;s++)n.push({start:t.start(s),end:t.end(s)});return this.bufferedInfo(n,r,e)}}catch{}return{len:0,start:r,end:r,nextStart:void 0}},o.bufferedInfo=function(i,r,e){i.sort(function(re,de){var le=re.start-de.start;return le||de.end-re.end});var t=[];if(e)for(var n=0;n<i.length;n++){var s=t.length;if(s){var l=t[s-1].end;i[n].start-l<e?i[n].end>l&&(t[s-1].end=i[n].end):t.push(i[n])}else t.push(i[n])}else t=i;for(var u=0,c,v=r,p=r,R=0;R<t.length;R++){var P=t[R].start,z=t[R].end;if(r+e>=P&&r<z)v=P,p=z,u=p-r;else if(r+e<P){c=P;break}}return{len:u,start:v,end:p,nextStart:c}},o}(),f=L("./node_modules/eventemitter3/index.js"),g=L("./node_modules/webworkify-webpack/index.js"),m=L("./src/demux/demuxer-inline.js");function T(){return window.MediaSource||window.WebKitMediaSource}var b=L("./src/utils/get-self-scope.js");function w(o,a){o.prototype=Object.create(a.prototype),o.prototype.constructor=o,o.__proto__=a}var M=function(o){w(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i.trigger=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];this.emit.apply(this,[e,e].concat(n))},a}(f.EventEmitter),W=Object(b.getSelfScope)(),Y=T()||{isTypeSupported:function(){return!1}},j=function(){function o(i,r){var e=this;this.hls=i,this.id=r;var t=this.observer=new M,n=i.config,s=function(p,R){R=R||{},R.frag=e.frag,R.id=e.id,i.trigger(p,R)};t.on(d.default.FRAG_DECRYPTED,s),t.on(d.default.FRAG_PARSING_INIT_SEGMENT,s),t.on(d.default.FRAG_PARSING_DATA,s),t.on(d.default.FRAG_PARSED,s),t.on(d.default.ERROR,s),t.on(d.default.FRAG_PARSING_METADATA,s),t.on(d.default.FRAG_PARSING_USERDATA,s),t.on(d.default.INIT_PTS_FOUND,s);var l={mp4:Y.isTypeSupported("video/mp4"),mpeg:Y.isTypeSupported("audio/mpeg"),mp3:Y.isTypeSupported('audio/mp4; codecs="mp3"')},u=navigator.vendor;if(n.enableWorker&&typeof Worker<"u"){h.logger.log("demuxing in webworker");var c;try{c=this.w=g("./src/demux/demuxer-worker.js"),this.onwmsg=this.onWorkerMessage.bind(this),c.addEventListener("message",this.onwmsg),c.onerror=function(v){i.trigger(d.default.ERROR,{type:A.ErrorTypes.OTHER_ERROR,details:A.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:v.message+" ("+v.filename+":"+v.lineno+")"}})},c.postMessage({cmd:"init",typeSupported:l,vendor:u,id:r,config:JSON.stringify(n)})}catch(v){h.logger.warn("Error in worker:",v),h.logger.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),c&&W.URL.revokeObjectURL(c.objectURL),this.demuxer=new m.default(t,l,n,u),this.w=void 0}}else this.demuxer=new m.default(t,l,n,u)}var a=o.prototype;return a.destroy=function(){var r=this.w;if(r)r.removeEventListener("message",this.onwmsg),r.terminate(),this.w=null;else{var e=this.demuxer;e&&(e.destroy(),this.demuxer=null)}var t=this.observer;t&&(t.removeAllListeners(),this.observer=null)},a.push=function(r,e,t,n,s,l,u,c){var v=this.w,p=Object(q.isFiniteNumber)(s.startPTS)?s.startPTS:s.start,R=s.decryptdata,P=this.frag,z=!(P&&s.cc===P.cc),re=!(P&&s.level===P.level),de=P&&s.sn===P.sn+1,le=!re&&de;if(z&&h.logger.log(this.id+":discontinuity detected"),re&&h.logger.log(this.id+":switch detected"),this.frag=s,v)v.postMessage({cmd:"demux",data:r,decryptdata:R,initSegment:e,audioCodec:t,videoCodec:n,timeOffset:p,discontinuity:z,trackSwitch:re,contiguous:le,duration:l,accurateTimeOffset:u,defaultInitPTS:c},r instanceof ArrayBuffer?[r]:[]);else{var ge=this.demuxer;ge&&ge.push(r,R,e,t,n,p,z,re,le,l,u,c)}},a.onWorkerMessage=function(r){var e=r.data,t=this.hls;switch(e.event){case"init":W.URL.revokeObjectURL(this.w.objectURL);break;case d.default.FRAG_PARSING_DATA:e.data.data1=new Uint8Array(e.data1),e.data2&&(e.data.data2=new Uint8Array(e.data2));default:e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,t.trigger(e.event,e.data);break}},o}(),J=j;function $(o,a,i){switch(a){case"audio":o.audioGroupIds||(o.audioGroupIds=[]),o.audioGroupIds.push(i);break;case"text":o.textGroupIds||(o.textGroupIds=[]),o.textGroupIds.push(i);break}}function ne(o,a,i){var r=o[a],e=o[i],t=e.startPTS;if(Object(q.isFiniteNumber)(t))i>a?(r.duration=t-r.start,r.duration<0&&h.logger.warn("negative duration computed for frag "+r.sn+",level "+r.level+", there should be some duration drift between playlist and fragment!")):(e.duration=r.start-t,e.duration<0&&h.logger.warn("negative duration computed for frag "+e.sn+",level "+e.level+", there should be some duration drift between playlist and fragment!"));else if(i>a){var n=r.cc===e.cc;e.start=r.start+(n&&r.minEndPTS?r.minEndPTS-r.start:r.duration)}else e.start=Math.max(r.start-e.duration,0)}function Q(o,a,i,r,e,t){var n=i,s=r;if(Object(q.isFiniteNumber)(a.startPTS)){var l=Math.abs(a.startPTS-i);Object(q.isFiniteNumber)(a.deltaPTS)?a.deltaPTS=Math.max(l,a.deltaPTS):a.deltaPTS=l,n=Math.max(i,a.startPTS),i=Math.min(i,a.startPTS),s=Math.min(r,a.endPTS),r=Math.max(r,a.endPTS),e=Math.min(e,a.startDTS),t=Math.max(t,a.endDTS)}var u=i-a.start;a.start=a.startPTS=i,a.maxStartPTS=n,a.endPTS=r,a.minEndPTS=s,a.startDTS=e,a.endDTS=t,a.duration=r-i;var c=a.sn;if(!o||c<o.startSN||c>o.endSN)return 0;var v,p,R;for(v=c-o.startSN,p=o.fragments,p[v]=a,R=v;R>0;R--)ne(p,R,R-1);for(R=v;R<p.length-1;R++)ne(p,R,R+1);return o.PTSKnown=!0,u}function ce(o,a){a.initSegment&&o.initSegment&&(a.initSegment=o.initSegment);var i=0,r;if(pe(o,a,function(n,s){i=n.cc-s.cc,Object(q.isFiniteNumber)(n.startPTS)&&(s.start=s.startPTS=n.startPTS,s.endPTS=n.endPTS,s.duration=n.duration,s.backtracked=n.backtracked,s.dropped=n.dropped,r=s),a.PTSKnown=!0}),!!a.PTSKnown){if(i){h.logger.log("discontinuity sliding from playlist, take drift into account");for(var e=a.fragments,t=0;t<e.length;t++)e[t].cc+=i}r?Q(a,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS):Le(o,a),a.PTSKnown=o.PTSKnown}}function fe(o,a,i){i===void 0&&(i=0);var r=-1;pe(o,a,function(n,s,l){s.start=n.start,r=l});var e=a.fragments;if(r<0){e.forEach(function(n){n.start+=i});return}for(var t=r+1;t<e.length;t++)e[t].start=e[t-1].start+e[t-1].duration}function pe(o,a,i){if(!(!o||!a))for(var r=Math.max(o.startSN,a.startSN)-a.startSN,e=Math.min(o.endSN,a.endSN)-a.startSN,t=a.startSN-o.startSN,n=r;n<=e;n++){var s=o.fragments[t+n],l=a.fragments[n];if(!s||!l)break;i(s,l,n)}}function Le(o,a){var i=a.startSN-o.startSN,r=o.fragments,e=a.fragments;if(!(i<0||i>r.length))for(var t=0;t<e.length;t++)e[t].start+=r[i].start}function xe(o,a,i){var r=1e3*(a.averagetargetduration?a.averagetargetduration:a.targetduration),e=r/2;return o&&a.endSN===o.endSN&&(r=e),i&&(r=Math.max(e,r-(window.performance.now()-i))),Math.round(r)}var Ne={toString:function(a){for(var i="",r=a.length,e=0;e<r;e++)i+="["+a.start(e).toFixed(3)+","+a.end(e).toFixed(3)+"]";return i}},Re=Ne;function Te(o,a){for(var i=null,r=0;r<o.length;r+=1){var e=o[r];if(e&&e.cc===a){i=e;break}}return i}function we(o,a){return D.search(o,function(i){return i.cc<a?1:i.cc>a?-1:0})}function Oe(o,a,i){var r=!1;return a&&a.details&&i&&(i.endCC>i.startCC||o&&o.cc<i.startCC)&&(r=!0),r}function tt(o,a){var i=o.fragments,r=a.fragments;if(!r.length||!i.length){h.logger.log("No fragments to align");return}var e=Te(i,r[0].cc);if(!e||e&&!e.startPTS){h.logger.log("No frag in previous level to align on");return}return e}function $e(o,a){a.fragments.forEach(function(i){if(i){var r=i.start+o;i.start=i.startPTS=r,i.endPTS=r+i.duration}}),a.PTSKnown=!0}function Ue(o,a,i){at(o,i,a),!i.PTSKnown&&a&&Qe(i,a.details)}function at(o,a,i){if(Oe(o,i,a)){var r=tt(i.details,a);r&&(h.logger.log("Adjusting PTS using last level due to CC increase within current level"),$e(r.start,a))}}function Qe(o,a){if(a&&a.fragments.length){if(!o.hasProgramDateTime||!a.hasProgramDateTime)return;var i=a.fragments[0].programDateTime,r=o.fragments[0].programDateTime,e=(r-i)/1e3+a.fragments[0].start;Object(q.isFiniteNumber)(e)&&(h.logger.log("adjusting PTS using programDateTime delta, sliding:"+e.toFixed(3)),$e(e,o))}}function ot(o,a,i){if(a===null||!Array.isArray(o)||!o.length||!Object(q.isFiniteNumber)(a))return null;var r=o[0].programDateTime;if(a<(r||0))return null;var e=o[o.length-1].endProgramDateTime;if(a>=(e||0))return null;i=i||0;for(var t=0;t<o.length;++t){var n=o[t];if(pt(a,i,n))return n}return null}function Xe(o,a,i,r){i===void 0&&(i=0),r===void 0&&(r=0);var e=null;if(o?e=a[o.sn-a[0].sn+1]:i===0&&a[0].start===0&&(e=a[0]),e&&Be(i,r,e)===0)return e;var t=D.search(a,Be.bind(null,i,r));return t||e}function Be(o,a,i){o===void 0&&(o=0),a===void 0&&(a=0);var r=Math.min(a,i.duration+(i.deltaPTS?i.deltaPTS:0));return i.start+i.duration-r<=o?1:i.start-r>o&&i.start?-1:0}function pt(o,a,i){var r=Math.min(a,i.duration+(i.deltaPTS?i.deltaPTS:0))*1e3,e=i.endProgramDateTime||0;return e-r>o}var mt=250,ft=2,rt=.1,gt=.05,xt=function(){function o(i,r,e,t){this.config=i,this.media=r,this.fragmentTracker=e,this.hls=t,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1}var a=o.prototype;return a.poll=function(r){var e=this.config,t=this.media,n=this.stalled,s=t.currentTime,l=t.seeking,u=this.seeking&&!l,c=!this.seeking&&l;if(this.seeking=l,s!==r){if(this.moved=!0,n!==null){if(this.stallReported){var v=self.performance.now()-n;h.logger.warn("playback not stuck anymore @"+s+", after "+Math.round(v)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((c||u)&&(this.stalled=null),!(t.paused||t.ended||t.playbackRate===0||!t.buffered.length)){var p=x.bufferInfo(t,s,0),R=p.len>0,P=p.nextStart||0;if(!(!R&&!P)){if(l){var z=p.len>ft,re=!P||P-s>ft&&!this.fragmentTracker.getPartialFragment(s);if(z||re)return;this.moved=!1}if(!this.moved&&this.stalled){var de=Math.max(P,p.start||0)-s;if(de>0&&de<=ft){this._trySkipBufferHole(null);return}}var le=self.performance.now();if(n===null){this.stalled=le;return}var ge=le-n;!l&&ge>=mt&&this._reportStall(p.len);var ve=x.bufferInfo(t,s,e.maxBufferHole);this._tryFixBufferStall(ve,ge)}}},a._tryFixBufferStall=function(r,e){var t=this.config,n=this.fragmentTracker,s=this.media,l=s.currentTime,u=n.getPartialFragment(l);if(u){var c=this._trySkipBufferHole(u);if(c)return}r.len>t.maxBufferHole&&e>t.highBufferWatchdogPeriod*1e3&&(h.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},a._reportStall=function(r){var e=this.hls,t=this.media,n=this.stallReported;n||(this.stallReported=!0,h.logger.warn("Playback stalling at @"+t.currentTime+" due to low buffer (buffer="+r+")"),e.trigger(d.default.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:r}))},a._trySkipBufferHole=function(r){for(var e=this.config,t=this.hls,n=this.media,s=n.currentTime,l=0,u=0;u<n.buffered.length;u++){var c=n.buffered.start(u);if(s+e.maxBufferHole>=l&&s<c){var v=Math.max(c+gt,n.currentTime+rt);return h.logger.warn("skipping hole, adjusting currentTime from "+s+" to "+v),this.moved=!0,this.stalled=null,n.currentTime=v,r&&t.trigger(d.default.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+s+" to "+v,frag:r}),v}l=n.buffered.end(u)}return 0},a._tryNudgeBuffer=function(){var r=this.config,e=this.hls,t=this.media,n=t.currentTime,s=(this.nudgeRetry||0)+1;if(this.nudgeRetry=s,s<r.nudgeMaxRetry){var l=n+s*r.nudgeOffset;h.logger.warn("Nudging 'currentTime' from "+n+" to "+l),t.currentTime=l,e.trigger(d.default.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else h.logger.error("Playhead still not moving while enough data buffered @"+n+" after "+r.nudgeMaxRetry+" nudges"),e.trigger(d.default.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},o}();function St(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function Ct(o,a){o.prototype=Object.create(a.prototype),o.prototype.constructor=o,o.__proto__=a}var _t=function(o){Ct(a,o);function a(r){for(var e,t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];return e=o.call.apply(o,[this,r].concat(n))||this,e._boundTick=void 0,e._tickTimer=null,e._tickInterval=null,e._tickCallCount=0,e._boundTick=e.tick.bind(St(e)),e}var i=a.prototype;return i.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},i.hasInterval=function(){return!!this._tickInterval},i.hasNextTick=function(){return!!this._tickTimer},i.setInterval=function(e){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,e),!0)},i.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},i.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},i.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&(this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)),this._tickCallCount=0)},i.doTick=function(){},a}(S);function kt(o,a){o.prototype=Object.create(a.prototype),o.prototype.constructor=o,o.__proto__=a}var B={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},lt=function(o){kt(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i.doTick=function(){},i.startLoad=function(){},i.stopLoad=function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragmentTracker.removeFragment(e)),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=B.STOPPED},i._streamEnded=function(e,t){var n=this.fragCurrent,s=this.fragmentTracker;if(!t.live&&n&&!n.backtracked&&n.sn===t.endSN&&!e.nextStart){var l=s.getState(n);return l===He.PARTIAL||l===He.OK}return!1},i.onMediaSeeking=function(){var e=this.config,t=this.media,n=this.mediaBuffer,s=this.state,l=t?t.currentTime:null,u=x.bufferInfo(n||t,l,this.config.maxBufferHole);if(h.logger.log("media seeking to "+(Object(q.isFiniteNumber)(l)?l.toFixed(3):l)),s===B.FRAG_LOADING){var c=this.fragCurrent;if(u.len===0&&c){var v=e.maxFragLookUpTolerance,p=c.start-v,R=c.start+c.duration+v;l<p||l>R?(c.loader&&(h.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),c.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=B.IDLE):h.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else s===B.ENDED&&(u.len===0&&(this.fragPrevious=null,this.fragCurrent=null),this.state=B.IDLE);t&&(this.lastCurrentTime=l),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=l),this.tick()},i.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},i.onHandlerDestroying=function(){this.stopLoad(),o.prototype.onHandlerDestroying.call(this)},i.onHandlerDestroyed=function(){this.state=B.STOPPED,this.fragmentTracker=null},i.computeLivePosition=function(e,t){var n=this.config.liveSyncDuration!==void 0?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-n)},a}(_t);function It(o,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function Pt(o,a,i){return a&&It(o.prototype,a),i&&It(o,i),o}function yt(o,a){o.prototype=Object.create(a.prototype),o.prototype.constructor=o,o.__proto__=a}var zt=100,hr=function(o){yt(a,o);function a(r,e){var t;return t=o.call(this,r,d.default.MEDIA_ATTACHED,d.default.MEDIA_DETACHING,d.default.MANIFEST_LOADING,d.default.MANIFEST_PARSED,d.default.LEVEL_LOADED,d.default.LEVELS_UPDATED,d.default.KEY_LOADED,d.default.FRAG_LOADED,d.default.FRAG_LOAD_EMERGENCY_ABORTED,d.default.FRAG_PARSING_INIT_SEGMENT,d.default.FRAG_PARSING_DATA,d.default.FRAG_PARSED,d.default.ERROR,d.default.AUDIO_TRACK_SWITCHING,d.default.AUDIO_TRACK_SWITCHED,d.default.BUFFER_CREATED,d.default.BUFFER_APPENDED,d.default.BUFFER_FLUSHED)||this,t.fragmentTracker=e,t.config=r.config,t.audioCodecSwap=!1,t._state=B.STOPPED,t.stallReported=!1,t.gapController=null,t.altAudio=!1,t.audioOnly=!1,t.bitrateTest=!1,t}var i=a.prototype;return i.startLoad=function(e){if(this.levels){var t=this.lastCurrentTime,n=this.hls;if(this.stopLoad(),this.setInterval(zt),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var s=n.startLevel;s===-1&&(n.config.testBandwidth?(s=0,this.bitrateTest=!0):s=n.nextAutoLevel),this.level=n.nextLoadLevel=s,this.loadedmetadata=!1}t>0&&e===-1&&(h.logger.log("override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=B.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this.forceStartLoad=!0,this.state=B.STOPPED},i.stopLoad=function(){this.forceStartLoad=!1,o.prototype.stopLoad.call(this)},i.doTick=function(){switch(this.state){case B.BUFFER_FLUSHING:this.fragLoadError=0;break;case B.IDLE:this._doTickIdle();break;case B.WAITING_LEVEL:var e=this.levels[this.level];e&&e.details&&(this.state=B.IDLE);break;case B.FRAG_LOADING_WAITING_RETRY:var t=window.performance.now(),n=this.retryDate;(!n||t>=n||this.media&&this.media.seeking)&&(h.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=B.IDLE);break}this._checkBuffer(),this._checkFragmentChanged()},i._doTickIdle=function(){var e=this.hls,t=e.config,n=this.media;if(!(this.levelLastLoaded===void 0||!n&&(this.startFragRequested||!t.startFragPrefetch))){if(this.altAudio&&this.audioOnly){this.demuxer.frag=null;return}var s;this.loadedmetadata?s=n.currentTime:s=this.nextLoadPosition;var l=e.nextLoadLevel,u=this.levels[l];if(u){var c=u.bitrate,v;c?v=Math.max(8*t.maxBufferSize/c,t.maxBufferLength):v=t.maxBufferLength,v=Math.min(v,t.maxMaxBufferLength);var p=s<t.maxBufferHole?Math.max(ft,t.maxBufferHole):t.maxBufferHole,R=x.bufferInfo(this.mediaBuffer?this.mediaBuffer:n,s,p),P=R.len;if(!(P>=v)){h.logger.trace("buffer length of "+P.toFixed(3)+" is below max of "+v.toFixed(3)+". checking for more payload ..."),this.level=e.nextLoadLevel=l;var z=u.details;if(!z||z.live&&this.levelLastLoaded!==l){this.state=B.WAITING_LEVEL;return}if(this._streamEnded(R,z)){var re={};this.altAudio&&(re.type="video"),this.hls.trigger(d.default.BUFFER_EOS,re),this.state=B.ENDED;return}this._fetchPayloadOrEos(s,R,z)}}}},i._fetchPayloadOrEos=function(e,t,n){var s=this.fragPrevious;this.level;var l=n.fragments,u=l.length;if(u!==0){var c=l[0].start,v=l[u-1].start+l[u-1].duration,p=t.end,R;if(n.initSegment&&!n.initSegment.data)R=n.initSegment;else if(n.live){var P=this.config.initialLiveManifestSize;if(u<P){h.logger.warn("Can not start playback of a level, reason: not enough fragments "+u+" < "+P);return}if(R=this._ensureFragmentAtLivePoint(n,p,c,v,s,l),R===null)return}else p<c&&(R=l[0]);R||(R=this._findFragment(c,s,u,l,p,v,n)),R&&(R.encrypted?this._loadKey(R,n):this._loadFragment(R,n,e,p))}},i._ensureFragmentAtLivePoint=function(e,t,n,s,l,u){var c=this.hls.config,v=this.media,p,R=1/0;if(c.liveMaxLatencyDuration!==void 0?R=c.liveMaxLatencyDuration:Object(q.isFiniteNumber)(c.liveMaxLatencyDurationCount)&&(R=c.liveMaxLatencyDurationCount*e.targetduration),t<Math.max(n-c.maxFragLookUpTolerance,s-R)){var P=this.liveSyncPosition=this.computeLivePosition(n,e);t=P,v&&!v.paused&&v.readyState&&v.duration>P&&P>v.currentTime&&(h.logger.log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+P.toFixed(3)),v.currentTime=P),this.nextLoadPosition=P}if(e.PTSKnown&&t>s&&v&&v.readyState)return null;if(this.startFragRequested&&!e.PTSKnown&&l)if(e.hasProgramDateTime)h.logger.log("live playlist, switching playlist, load frag with same PDT: "+l.programDateTime),p=ot(u,l.endProgramDateTime,c.maxFragLookUpTolerance);else{var z=l.sn+1;if(z>=e.startSN&&z<=e.endSN){var re=u[z-e.startSN];l.cc===re.cc&&(p=re,h.logger.log("live playlist, switching playlist, load frag with next SN: "+p.sn))}p||(p=D.search(u,function(de){return l.cc-de.cc}),p&&h.logger.log("live playlist, switching playlist, load frag with same CC: "+p.sn))}return p},i._findFragment=function(e,t,n,s,l,u,c){var v=this.hls.config,p;if(l<u){var R=l>u-v.maxFragLookUpTolerance?0:v.maxFragLookUpTolerance;p=Xe(t,s,l,R)}else p=s[n-1];if(p){var P=p.sn-c.startSN,z=t&&p.level===t.level,re=s[P-1],de=s[P+1];if(t&&p.sn===t.sn)if(z&&!p.backtracked)if(p.sn<c.endSN){var le=t.deltaPTS;le&&le>v.maxBufferHole&&t.dropped&&P?(p=re,h.logger.warn("Previous fragment was dropped with large PTS gap between audio and video. Maybe fragment is not starting with a keyframe? Loading previous one to try to overcome this")):(p=de,this.fragmentTracker.getState(p)!==He.OK&&h.logger.log("Re-loading fragment with SN: "+p.sn))}else p=null;else p.backtracked&&(de&&de.backtracked?(h.logger.warn("Already backtracked from fragment "+de.sn+", will not backtrack to fragment "+p.sn+". Loading fragment "+de.sn),p=de):(h.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),p.dropped=0,re?(p=re,p.backtracked=!0):P&&(p=null)))}return p},i._loadKey=function(e,t){h.logger.log("Loading key for "+e.sn+" of ["+t.startSN+"-"+t.endSN+"], level "+this.level),this.state=B.KEY_LOADING,this.hls.trigger(d.default.KEY_LOADING,{frag:e})},i._loadFragment=function(e,t,n,s){var l=this.fragmentTracker.getState(e);this.fragCurrent=e,e.sn!=="initSegment"&&(this.startFragRequested=!0),Object(q.isFiniteNumber)(e.sn)&&!e.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),e.backtracked||l===He.NOT_LOADED||l===He.PARTIAL?(e.autoLevel=this.hls.autoLevelEnabled,e.bitrateTest=this.bitrateTest,h.logger.log("Loading "+e.sn+" of ["+t.startSN+"-"+t.endSN+"], level "+this.level+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+parseFloat(n.toFixed(3))+", bufferEnd: "+parseFloat(s.toFixed(3))),this.hls.trigger(d.default.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new J(this.hls,"main")),this.state=B.FRAG_LOADING):l===He.APPENDING&&this._reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e)},i.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,_.MAIN)},i.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.endPTS+.5):null},i._checkFragmentChanged=function(){var e,t,n=this.media;if(n&&n.readyState&&n.seeking===!1&&(t=n.currentTime,t>this.lastCurrentTime&&(this.lastCurrentTime=t),x.isBuffered(n,t)?e=this.getBufferedFrag(t):x.isBuffered(n,t+.1)&&(e=this.getBufferedFrag(t+.1)),e)){var s=e;if(s!==this.fragPlaying){this.hls.trigger(d.default.FRAG_CHANGED,{frag:s});var l=s.level;(!this.fragPlaying||this.fragPlaying.level!==l)&&this.hls.trigger(d.default.LEVEL_SWITCHED,{level:l}),this.fragPlaying=s}}},i.immediateLevelSwitch=function(){if(h.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var e=this.media,t;e?(t=e.paused,t||e.pause()):t=!0,this.previouslyPaused=t}var n=this.fragCurrent;n&&n.loader&&n.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},i.immediateLevelSwitchEnd=function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,e.currentTime>0&&x.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())},i.nextLevelSwitch=function(){var e=this.media;if(e&&e.readyState){var t,n=this.getBufferedFrag(e.currentTime);if(n&&n.startPTS>1&&this.flushMainBuffer(0,n.startPTS-1),e.paused)t=0;else{var s=this.hls.nextLoadLevel,l=this.levels[s],u=this.fragLastKbps;u&&this.fragCurrent?t=this.fragCurrent.duration*l.bitrate/(1e3*u)+1:t=0}var c=this.getBufferedFrag(e.currentTime+t);if(c){var v=this.followingBufferedFrag(c);if(v){var p=this.fragCurrent;p&&p.loader&&p.loader.abort(),this.fragCurrent=null;var R=Math.max(c.endPTS,v.maxStartPTS+Math.min(this.config.maxFragLookUpTolerance,v.duration));this.flushMainBuffer(R,Number.POSITIVE_INFINITY)}}}},i.flushMainBuffer=function(e,t){this.state=B.BUFFER_FLUSHING;var n={startOffset:e,endOffset:t};this.altAudio&&(n.type="video"),this.hls.trigger(d.default.BUFFER_FLUSHING,n)},i.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);var n=this.config;this.levels&&n.autoStartLoad&&this.hls.startLoad(n.startPosition),this.gapController=new xt(n,t,this.fragmentTracker,this.hls)},i.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(h.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach(function(n){n.details&&n.details.fragments.forEach(function(s){s.backtracked=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.fragmentTracker.removeAllFragments(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},i.onMediaSeeked=function(){var e=this.media,t=e?e.currentTime:void 0;Object(q.isFiniteNumber)(t)&&h.logger.log("media seeked to "+t.toFixed(3)),this.tick()},i.onManifestLoading=function(){h.logger.log("trigger BUFFER_RESET"),this.hls.trigger(d.default.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},i.onManifestParsed=function(e){var t=!1,n=!1,s;e.levels.forEach(function(u){s=u.audioCodec,s&&(s.indexOf("mp4a.40.2")!==-1&&(t=!0),s.indexOf("mp4a.40.5")!==-1&&(n=!0))}),this.audioCodecSwitch=t&&n,this.audioCodecSwitch&&h.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.altAudio=e.altAudio,this.levels=e.levels,this.startFragRequested=!1;var l=this.config;(l.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(l.startPosition)},i.onLevelLoaded=function(e){var t=e.details,n=e.level,s=this.levels[this.levelLastLoaded],l=this.levels[n],u=t.totalduration,c=0;if(h.logger.log("level "+n+" loaded ["+t.startSN+","+t.endSN+"],duration:"+u),t.live||l.details&&l.details.live){var v=l.details;v&&t.fragments.length>0?(ce(v,t),c=t.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(c,v),t.PTSKnown&&Object(q.isFiniteNumber)(c)?h.logger.log("live playlist sliding:"+c.toFixed(3)):(h.logger.log("live playlist - outdated PTS, unknown sliding"),Ue(this.fragPrevious,s,t))):(h.logger.log("live playlist - first load, unknown sliding"),t.PTSKnown=!1,Ue(this.fragPrevious,s,t))}else t.PTSKnown=!1;if(l.details=t,this.levelLastLoaded=n,this.hls.trigger(d.default.LEVEL_UPDATED,{details:t,level:n}),this.startFragRequested===!1){if(this.startPosition===-1||this.lastCurrentTime===-1){var p=t.startTimeOffset;Object(q.isFiniteNumber)(p)?(p<0&&(h.logger.log("negative start time offset "+p+", count from end of last fragment"),p=c+u+p),h.logger.log("start time offset found in playlist, adjust startPosition to "+p),this.startPosition=p):t.live?(this.startPosition=this.computeLivePosition(c,t),h.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===B.WAITING_LEVEL&&(this.state=B.IDLE),this.tick()},i.onKeyLoaded=function(){this.state===B.KEY_LOADING&&(this.state=B.IDLE,this.tick())},i.onFragLoaded=function(e){var t=this.fragCurrent,n=this.hls,s=this.levels,l=this.media,u=e.frag;if(this.state===B.FRAG_LOADING&&t&&u.type==="main"&&u.level===t.level&&u.sn===t.sn){var c=e.stats,v=s[t.level],p=v.details;if(this.bitrateTest=!1,this.stats=c,h.logger.log("Loaded "+t.sn+" of ["+p.startSN+" ,"+p.endSN+"],level "+t.level),u.bitrateTest&&n.nextLoadLevel)this.state=B.IDLE,this.startFragRequested=!1,c.tparsed=c.tbuffered=window.performance.now(),n.trigger(d.default.FRAG_BUFFERED,{stats:c,frag:t,id:"main"}),this.tick();else if(u.sn==="initSegment")this.state=B.IDLE,c.tparsed=c.tbuffered=window.performance.now(),p.initSegment.data=e.payload,n.trigger(d.default.FRAG_BUFFERED,{stats:c,frag:t,id:"main"}),this.tick();else{h.logger.log("Parsing "+t.sn+" of ["+p.startSN+" ,"+p.endSN+"],level "+t.level+", cc "+t.cc),this.state=B.PARSING,this.pendingBuffering=!0,this.appended=!1,u.bitrateTest&&(u.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:u}));var R=!(l&&l.seeking)&&(p.PTSKnown||!p.live),P=p.initSegment?p.initSegment.data:[],z=this._getAudioCodec(v),re=this.demuxer=this.demuxer||new J(this.hls,"main");re.push(e.payload,P,z,v.videoCodec,t,p.totalduration,R)}}this.fragLoadError=0},i.onFragParsingInitSegment=function(e){var t=this.fragCurrent,n=e.frag;if(t&&e.id==="main"&&n.sn===t.sn&&n.level===t.level&&this.state===B.PARSING){var s=e.tracks,l,u;if(this.audioOnly=s.audio&&!s.video,this.altAudio&&!this.audioOnly&&delete s.audio,u=s.audio,u){var c=this.levels[this.level].audioCodec,v=navigator.userAgent.toLowerCase();c&&this.audioCodecSwap&&(h.logger.log("swapping playlist audio codec"),c.indexOf("mp4a.40.5")!==-1?c="mp4a.40.2":c="mp4a.40.5"),this.audioCodecSwitch&&u.metadata.channelCount!==1&&v.indexOf("firefox")===-1&&(c="mp4a.40.5"),v.indexOf("android")!==-1&&u.container!=="audio/mpeg"&&(c="mp4a.40.2",h.logger.log("Android: force audio codec to "+c)),u.levelCodec=c,u.id=e.id}u=s.video,u&&(u.levelCodec=this.levels[this.level].videoCodec,u.id=e.id),this.hls.trigger(d.default.BUFFER_CODECS,s);for(l in s){u=s[l],h.logger.log("main track:"+l+",container:"+u.container+",codecs[level/parsed]=["+u.levelCodec+"/"+u.codec+"]");var p=u.initSegment;p&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(d.default.BUFFER_APPENDING,{type:l,data:p,parent:"main",content:"initSegment"}))}this.tick()}},i.onFragParsingData=function(e){var t=this,n=this.fragCurrent,s=e.frag;if(n&&e.id==="main"&&s.sn===n.sn&&s.level===n.level&&!(e.type==="audio"&&this.altAudio)&&this.state===B.PARSING){var l=this.levels[this.level],u=n;if(Object(q.isFiniteNumber)(e.endPTS)||(e.endPTS=e.startPTS+n.duration,e.endDTS=e.startDTS+n.duration),e.hasAudio===!0&&u.addElementaryStream(te.AUDIO),e.hasVideo===!0&&u.addElementaryStream(te.VIDEO),h.logger.log("Parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0)),e.type==="video")if(u.dropped=e.dropped,u.dropped)if(u.backtracked)h.logger.warn("Already backtracked on this fragment, appending with the gap",u.sn);else{var c=l.details;if(c&&u.sn===c.startSN)h.logger.warn("missing video frame(s) on first frag, appending with gap",u.sn);else{h.logger.warn("missing video frame(s), backtracking fragment",u.sn),this.fragmentTracker.removeFragment(u),u.backtracked=!0,this.nextLoadPosition=e.startPTS,this.state=B.IDLE,this.fragPrevious=u,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.tick();return}}else u.backtracked=!1;var v=Q(l.details,u,e.startPTS,e.endPTS,e.startDTS,e.endDTS),p=this.hls;p.trigger(d.default.LEVEL_PTS_UPDATED,{details:l.details,level:this.level,drift:v,type:e.type,start:e.startPTS,end:e.endPTS}),[e.data1,e.data2].forEach(function(R){R&&R.length&&t.state===B.PARSING&&(t.appended=!0,t.pendingBuffering=!0,p.trigger(d.default.BUFFER_APPENDING,{type:e.type,data:R,parent:"main",content:"data"}))}),this.tick()}},i.onFragParsed=function(e){var t=this.fragCurrent,n=e.frag;t&&e.id==="main"&&n.sn===t.sn&&n.level===t.level&&this.state===B.PARSING&&(this.stats.tparsed=window.performance.now(),this.state=B.PARSED,this._checkAppendedParsed())},i.onAudioTrackSwitching=function(e){var t=this.altAudio,n=!!e.url,s=e.id;if(!n){if(this.mediaBuffer!==this.media){h.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var l=this.fragCurrent;l.loader&&(h.logger.log("switching to main audio track, cancel main fragment load"),l.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=B.IDLE}var u=this.hls;t&&u.trigger(d.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),u.trigger(d.default.AUDIO_TRACK_SWITCHED,{id:s})}},i.onAudioTrackSwitched=function(e){var t=e.id,n=!!this.hls.audioTracks[t].url;if(n){var s=this.videoBuffer;s&&this.mediaBuffer!==s&&(h.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=n,this.tick()},i.onBufferCreated=function(e){var t=e.tracks,n,s,l=!1;for(var u in t){var c=t[u];c.id==="main"?(s=u,n=c,u==="video"&&(this.videoBuffer=t[u].buffer)):l=!0}l&&n?(h.logger.log("alternate track found, use "+s+".buffered to schedule main fragment loading"),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media},i.onBufferAppended=function(e){if(e.parent==="main"){var t=this.state;(t===B.PARSING||t===B.PARSED)&&(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},i._checkAppendedParsed=function(){if(this.state===B.PARSED&&(!this.appended||!this.pendingBuffering)){var e=this.fragCurrent;if(e){var t=this.mediaBuffer?this.mediaBuffer:this.media;h.logger.log("main buffered : "+Re.toString(t.buffered)),this.fragPrevious=e;var n=this.stats;n.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*n.total/(n.tbuffered-n.tfirst)),this.hls.trigger(d.default.FRAG_BUFFERED,{stats:n,frag:e,id:"main"}),this.state=B.IDLE}(this.loadedmetadata||this.startPosition<=0)&&this.tick()}},i.onError=function(e){var t=e.frag||this.fragCurrent;if(!(t&&t.type!=="main")){var n=!!this.media&&x.isBuffered(this.media,this.media.currentTime)&&x.isBuffered(this.media,this.media.currentTime+.5);switch(e.details){case A.ErrorDetails.FRAG_LOAD_ERROR:case A.ErrorDetails.FRAG_LOAD_TIMEOUT:case A.ErrorDetails.KEY_LOAD_ERROR:case A.ErrorDetails.KEY_LOAD_TIMEOUT:if(!e.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var s=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);h.logger.warn("mediaController: frag loading failed, retry in "+s+" ms"),this.retryDate=window.performance.now()+s,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=B.FRAG_LOADING_WAITING_RETRY}else h.logger.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=B.ERROR;break;case A.ErrorDetails.LEVEL_LOAD_ERROR:case A.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==B.ERROR&&(e.fatal?(this.state=B.ERROR,h.logger.warn("streamController: "+e.details+",switch to "+this.state+" state ...")):!e.levelRetry&&this.state===B.WAITING_LEVEL&&(this.state=B.IDLE));break;case A.ErrorDetails.BUFFER_FULL_ERROR:e.parent==="main"&&(this.state===B.PARSING||this.state===B.PARSED)&&(n?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=B.IDLE):(h.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)));break}}},i._reduceMaxBufferLength=function(e){var t=this.config;return t.maxMaxBufferLength>=e?(t.maxMaxBufferLength/=2,h.logger.warn("main:reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0):!1},i._checkBuffer=function(){var e=this.media;if(!(!e||e.readyState===0)){var t=this.mediaBuffer?this.mediaBuffer:e,n=t.buffered;!this.loadedmetadata&&n.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,n)}},i.onFragLoadEmergencyAborted=function(){this.state=B.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},i.onBufferFlushed=function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;if(e){var t=this.audioOnly?te.AUDIO:te.VIDEO;this.fragmentTracker.detectEvictedFragments(t,e.buffered)}this.state=B.IDLE,this.fragPrevious=null},i.onLevelsUpdated=function(e){this.levels=e.levels},i.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},i._seekToStartPos=function(){var e=this.media,t=e.currentTime,n=this.startPosition;if(t!==n&&n>=0){if(e.seeking){h.logger.log("could not seek to "+n+", already seeking at "+t);return}var s=e.buffered.length?e.buffered.start(0):0,l=s-n;l>0&&l<this.config.maxBufferHole&&(h.logger.log("adjusting start position by "+l+" to match buffer start"),n+=l,this.startPosition=n),h.logger.log("seek to target start position "+n+" from current time "+t+". ready state "+e.readyState),e.currentTime=n}},i._getAudioCodec=function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&(h.logger.log("swapping playlist audio codec"),t&&(t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5")),t},Pt(a,[{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,h.logger.log("main stream-controller: "+t+"->"+e),this.hls.trigger(d.default.STREAM_STATE_TRANSITION,{previousState:t,nextState:e})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var e=this.media;if(e){var t=this.getBufferedFrag(e.currentTime);if(t)return t.level}return-1}},{key:"nextBufferedFrag",get:function(){var e=this.media;return e?this.followingBufferedFrag(this.getBufferedFrag(e.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e}}]),a}(lt),ir=hr;function nr(o,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function qt(o,a,i){return a&&nr(o.prototype,a),i&&nr(o,i),o}function ar(o,a){o.prototype=Object.create(a.prototype),o.prototype.constructor=o,o.__proto__=a}var Mt,gr=function(o){ar(a,o);function a(r){var e;return e=o.call(this,r,d.default.MANIFEST_LOADED,d.default.LEVEL_LOADED,d.default.AUDIO_TRACK_SWITCHED,d.default.FRAG_LOADED,d.default.ERROR)||this,e.canload=!1,e.currentLevelIndex=null,e.manualLevelIndex=-1,e.timer=null,Mt=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),e}var i=a.prototype;return i.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},i.clearTimer=function(){this.timer!==null&&(clearTimeout(this.timer),this.timer=null)},i.startLoad=function(){var e=this._levels;this.canload=!0,this.levelRetryCount=0,e&&e.forEach(function(t){t.loadError=0;var n=t.details;n&&n.live&&(t.details=void 0)}),this.timer!==null&&this.loadLevel()},i.stopLoad=function(){this.canload=!1},i.onManifestLoaded=function(e){var t=[],n=[],s,l={},u=null,c=!1,v=!1;if(e.levels.forEach(function(P){var z=P.attrs;P.loadError=0,P.fragmentError=!1,c=c||!!P.videoCodec,v=v||!!P.audioCodec,Mt&&P.audioCodec&&P.audioCodec.indexOf("mp4a.40.34")!==-1&&(P.audioCodec=void 0),u=l[P.bitrate],u?u.url.push(P.url):(P.url=[P.url],P.urlId=0,l[P.bitrate]=P,t.push(P)),z&&(z.AUDIO&&$(u||P,"audio",z.AUDIO),z.SUBTITLES&&$(u||P,"text",z.SUBTITLES))}),c&&v&&(t=t.filter(function(P){var z=P.videoCodec;return!!z})),t=t.filter(function(P){var z=P.audioCodec,re=P.videoCodec;return(!z||Ge(z,"audio"))&&(!re||Ge(re,"video"))}),e.audioTracks&&(n=e.audioTracks.filter(function(P){return!P.audioCodec||Ge(P.audioCodec,"audio")}),n.forEach(function(P,z){P.id=z})),t.length>0){s=t[0].bitrate,t.sort(function(P,z){return P.bitrate-z.bitrate}),this._levels=t;for(var p=0;p<t.length;p++)if(t[p].bitrate===s){this._firstLevel=p,h.logger.log("manifest loaded,"+t.length+" level(s) found, first bitrate:"+s);break}var R=v&&!c;this.hls.trigger(d.default.MANIFEST_PARSED,{levels:t,audioTracks:n,firstLevel:this._firstLevel,stats:e.stats,audio:v,video:c,altAudio:!R&&n.some(function(P){return!!P.url})})}else this.hls.trigger(d.default.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},i.setLevelInternal=function(e){var t=this._levels,n=this.hls;if(e>=0&&e<t.length){if(this.clearTimer(),this.currentLevelIndex!==e){h.logger.log("switching to level "+e),this.currentLevelIndex=e;var s=t[e];s.level=e,n.trigger(d.default.LEVEL_SWITCHING,s)}var l=t[e],u=l.details;if(!u||u.live){var c=l.urlId;n.trigger(d.default.LEVEL_LOADING,{url:l.url[c],level:e,id:c})}}else n.trigger(d.default.ERROR,{type:A.ErrorTypes.OTHER_ERROR,details:A.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})},i.onError=function(e){if(e.fatal){e.type===A.ErrorTypes.NETWORK_ERROR&&this.clearTimer();return}var t=!1,n=!1,s;switch(e.details){case A.ErrorDetails.FRAG_LOAD_ERROR:case A.ErrorDetails.FRAG_LOAD_TIMEOUT:case A.ErrorDetails.KEY_LOAD_ERROR:case A.ErrorDetails.KEY_LOAD_TIMEOUT:s=e.frag.level,n=!0;break;case A.ErrorDetails.LEVEL_LOAD_ERROR:case A.ErrorDetails.LEVEL_LOAD_TIMEOUT:s=e.context.level,t=!0;break;case A.ErrorDetails.REMUX_ALLOC_ERROR:s=e.level,t=!0;break}s!==void 0&&this.recoverLevel(e,s,t,n)},i.recoverLevel=function(e,t,n,s){var l=this,u=this.hls.config,c=e.details,v=this._levels[t],p,R,P;if(v.loadError++,v.fragmentError=s,n)if(this.levelRetryCount+1<=u.levelLoadingMaxRetry)R=Math.min(Math.pow(2,this.levelRetryCount)*u.levelLoadingRetryDelay,u.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return l.loadLevel()},R),e.levelRetry=!0,this.levelRetryCount++,h.logger.warn("level controller, "+c+", retry in "+R+" ms, current retry count is "+this.levelRetryCount);else{h.logger.error("level controller, cannot recover from "+c+" error"),this.currentLevelIndex=null,this.clearTimer(),e.fatal=!0;return}(n||s)&&(p=v.url.length,p>1&&v.loadError<p?(v.urlId=(v.urlId+1)%p,v.details=void 0,h.logger.warn("level controller, "+c+" for level "+t+": switching to redundant URL-id "+v.urlId)):this.manualLevelIndex===-1?(P=t===0?this._levels.length-1:t-1,h.logger.warn("level controller, "+c+": switch to "+P),this.hls.nextAutoLevel=this.currentLevelIndex=P):s&&(h.logger.warn("level controller, "+c+": reload a fragment"),this.currentLevelIndex=null))},i.onFragLoaded=function(e){var t=e.frag;if(t!==void 0&&t.type==="main"){var n=this._levels[t.level];n!==void 0&&(n.fragmentError=!1,n.loadError=0,this.levelRetryCount=0)}},i.onLevelLoaded=function(e){var t=this,n=e.level,s=e.details;if(n===this.currentLevelIndex){var l=this._levels[n];if(l.fragmentError||(l.loadError=0,this.levelRetryCount=0),s.live){var u=xe(l.details,s,e.stats.trequest);h.logger.log("live playlist, reload in "+Math.round(u)+" ms"),this.timer=setTimeout(function(){return t.loadLevel()},u)}else this.clearTimer()}},i.onAudioTrackSwitched=function(e){var t=this.hls.audioTracks[e.id].groupId,n=this.hls.levels[this.currentLevelIndex];if(n&&n.audioGroupIds){for(var s=-1,l=0;l<n.audioGroupIds.length;l++)if(n.audioGroupIds[l]===t){s=l;break}s!==n.urlId&&(n.urlId=s,this.startLoad())}},i.loadLevel=function(){if(h.logger.debug("call to loadLevel"),this.currentLevelIndex!==null&&this.canload){var e=this._levels[this.currentLevelIndex];if(typeof e=="object"&&e.url.length>0){var t=this.currentLevelIndex,n=e.urlId,s=e.url[n];h.logger.log("Attempt loading level index "+t+" with URL-id "+n),this.hls.trigger(d.default.LEVEL_LOADING,{url:s,level:t,id:n})}}},i.removeLevel=function(e,t){var n=this.levels.filter(function(s,l){return l!==e?!0:s.url.length>1&&t!==void 0?(s.url=s.url.filter(function(u,c){return c!==t}),s.urlId=0,!0):!1}).map(function(s,l){var u=s.details;return u&&u.fragments&&u.fragments.forEach(function(c){c.level=l}),s});this._levels=n,this.hls.trigger(d.default.LEVELS_UPDATED,{levels:n})},qt(a,[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;t&&(e=Math.min(e,t.length-1),(this.currentLevelIndex!==e||!t[e].details)&&this.setLevelInternal(e))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var e=this.hls.config.startLevel;return e!==void 0?e:this._firstLevel}else return this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}}]),a}(S),$t=L("./src/demux/id3.js");function Gt(o,a){var i;try{i=new Event("addtrack")}catch{i=document.createEvent("Event"),i.initEvent("addtrack",!1,!1)}i.track=o,a.dispatchEvent(i)}function Nt(o){if(o!=null&&o.cues)for(;o.cues.length>0;)o.removeCue(o.cues[0])}function sr(o,a){if(a<o[0].endTime)return o[0];if(a>o[o.length-1].endTime)return o[o.length-1];for(var i=0,r=o.length-1;i<=r;){var e=Math.floor((r+i)/2);if(a<o[e].endTime)r=e-1;else if(a>o[e].endTime)i=e+1;else return o[e]}return o[i].endTime-a<a-o[r].endTime?o[i]:o[r]}function or(o,a){o.prototype=Object.create(a.prototype),o.prototype.constructor=o,o.__proto__=a}var jt=.25,Qt=function(o){or(a,o);function a(r){var e;return e=o.call(this,r,d.default.MEDIA_ATTACHED,d.default.MEDIA_DETACHING,d.default.FRAG_PARSING_METADATA,d.default.LIVE_BACK_BUFFER_REACHED)||this,e.id3Track=void 0,e.media=void 0,e}var i=a.prototype;return i.destroy=function(){S.prototype.destroy.call(this)},i.onMediaAttached=function(e){this.media=e.media,this.media},i.onMediaDetaching=function(){Nt(this.id3Track),this.id3Track=void 0,this.media=void 0},i.getID3Track=function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.kind==="metadata"&&n.label==="id3")return Gt(n,this.media),n}return this.media.addTextTrack("metadata","id3")},i.onFragParsingMetadata=function(e){var t=e.frag,n=e.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var s=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,l=0;l<n.length;l++){var u=$t.default.getID3Frames(n[l].data);if(u){var c=Math.max(n[l].pts,0),v=l<n.length-1?n[l+1].pts:t.endPTS;v||(v=t.start+t.duration);var p=v-c;p<=0&&(v=c+jt);for(var R=0;R<u.length;R++){var P=u[R];if(!$t.default.isTimeStampFrame(P)){var z=new s(c,v,"");z.value=P,this.id3Track.addCue(z)}}}}},i.onLiveBackBufferReached=function(e){var t=e.bufferEnd,n=this.id3Track;if(!(!n||!n.cues||!n.cues.length)){var s=sr(n.cues,t);if(s)for(;n.cues[0]!==s;)n.removeCue(n.cues[0])}},a}(S),vr=Qt;function pr(){var o=T();if(!o)return!1;var a=self.SourceBuffer||self.WebKitSourceBuffer,i=o&&typeof o.isTypeSupported=="function"&&o.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),r=!a||a.prototype&&typeof a.prototype.appendBuffer=="function"&&typeof a.prototype.remove=="function";return!!i&&!!r}var vi=function(){function o(i){this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.alpha_=i?Math.exp(Math.log(.5)/i):0,this.estimate_=0,this.totalWeight_=0}var a=o.prototype;return a.sample=function(r,e){var t=Math.pow(this.alpha_,r);this.estimate_=e*(1-t)+t*this.estimate_,this.totalWeight_+=r},a.getTotalWeight=function(){return this.totalWeight_},a.getEstimate=function(){if(this.alpha_){var r=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/r}else return this.estimate_},o}(),Or=vi,pi=function(){function o(i,r,e,t){this.hls=void 0,this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.hls=i,this.defaultEstimate_=t,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Or(r),this.fast_=new Or(e)}var a=o.prototype;return a.sample=function(r,e){r=Math.max(r,this.minDelayMs_);var t=8*e,n=r/1e3,s=t/n;this.fast_.sample(n,s),this.slow_.sample(n,s)},a.canEstimate=function(){var r=this.fast_;return r&&r.getTotalWeight()>=this.minWeight_},a.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},a.destroy=function(){},o}(),mi=pi;function Fr(o,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function xi(o,a,i){return a&&Fr(o.prototype,a),i&&Fr(o,i),o}function yi(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function Ei(o,a){o.prototype=Object.create(a.prototype),o.prototype.constructor=o,o.__proto__=a}var Ti=window,Si=Ti.performance,_i=function(o){Ei(a,o);function a(r){var e;return e=o.call(this,r,d.default.FRAG_LOADING,d.default.FRAG_LOADED,d.default.FRAG_BUFFERED,d.default.ERROR)||this,e.lastLoadedFragLevel=0,e._nextAutoLevel=-1,e.hls=r,e.timer=null,e._bwEstimator=null,e.onCheck=e._abandonRulesCheck.bind(yi(e)),e}var i=a.prototype;return i.destroy=function(){this.clearTimer(),S.prototype.destroy.call(this)},i.onFragLoading=function(e){var t=e.frag;if(t.type==="main"&&(this.timer||(this.fragCurrent=t,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var n=this.hls,s=n.config,l=t.level,u=n.levels[l].details.live,c,v;u?(c=s.abrEwmaFastLive,v=s.abrEwmaSlowLive):(c=s.abrEwmaFastVoD,v=s.abrEwmaSlowVoD),this._bwEstimator=new mi(n,v,c,s.abrEwmaDefaultEstimate)}},i._abandonRulesCheck=function(){var e=this.hls,t=e.media,n=this.fragCurrent;if(n){var s=n.loader;if(!s||s.stats&&s.stats.aborted){h.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),this._nextAutoLevel=-1;return}var l=s.stats;if(t&&l&&(!t.paused&&t.playbackRate!==0||!t.readyState)&&n.autoLevel&&n.level){var u=Si.now()-l.trequest,c=Math.abs(t.playbackRate);if(u>500*n.duration/c){var v=e.levels,p=Math.max(1,l.bw?l.bw/8:l.loaded*1e3/u),R=v[n.level];if(!R)return;var P=R.realBitrate?Math.max(R.realBitrate,R.bitrate):R.bitrate,z=l.total?l.total:Math.max(l.loaded,Math.round(n.duration*P/8)),re=t.currentTime,de=(z-l.loaded)/p,le=(x.bufferInfo(t,re,e.config.maxBufferHole).end-re)/c;if(le<2*n.duration/c&&de>le){var ge=e.minAutoLevel,ve,_e;for(_e=n.level-1;_e>ge;_e--){var We=v[_e].realBitrate?Math.max(v[_e].realBitrate,v[_e].bitrate):v[_e].bitrate,ct=n.duration*We/(8*.8*p);if(ct<le)break}ve<de&&(h.logger.warn("loading too slow, abort fragment loading and switch to level "+_e+":fragLoadedDelay["+_e+"]<fragLoadedDelay["+(n.level-1)+"];bufferStarvationDelay:"+ve.toFixed(1)+"<"+de.toFixed(1)+":"+le.toFixed(1)),e.nextLoadLevel=_e,this._bwEstimator.sample(u,l.loaded),s.abort(),this.clearTimer(),e.trigger(d.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,stats:l}))}}}}},i.onFragLoaded=function(e){var t=e.frag;if(t.type==="main"&&Object(q.isFiniteNumber)(t.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var n=this.hls.levels[t.level],s=(n.loaded?n.loaded.bytes:0)+e.stats.loaded,l=(n.loaded?n.loaded.duration:0)+e.frag.duration;n.loaded={bytes:s,duration:l},n.realBitrate=Math.round(8*s/l)}if(e.frag.bitrateTest){var u=e.stats;u.tparsed=u.tbuffered=u.tload,this.onFragBuffered(e)}}},i.onFragBuffered=function(e){var t=e.stats,n=e.frag;if(t.aborted!==!0&&n.type==="main"&&Object(q.isFiniteNumber)(n.sn)&&(!n.bitrateTest||t.tload===t.tbuffered)){var s=t.tparsed-t.trequest;h.logger.log("latency/loading/parsing/append/kbps:"+Math.round(t.tfirst-t.trequest)+"/"+Math.round(t.tload-t.tfirst)+"/"+Math.round(t.tparsed-t.tload)+"/"+Math.round(t.tbuffered-t.tparsed)+"/"+Math.round(8*t.loaded/(t.tbuffered-t.trequest))),this._bwEstimator.sample(s,t.loaded),t.bwEstimate=this._bwEstimator.getEstimate(),n.bitrateTest?this.bitrateTestDelay=s/1e3:this.bitrateTestDelay=0}},i.onError=function(e){switch(e.details){case A.ErrorDetails.FRAG_LOAD_ERROR:case A.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break}},i.clearTimer=function(){clearInterval(this.timer),this.timer=null},i._findBestLevel=function(e,t,n,s,l,u,c,v,p){for(var R=l;R>=s;R--){var P=p[R];if(P){var z=P.details,re=z?z.totalduration/z.fragments.length:t,de=z?z.live:!1,le=void 0;R<=e?le=c*n:le=v*n;var ge=p[R].realBitrate?Math.max(p[R].realBitrate,p[R].bitrate):p[R].bitrate,ve=ge*re/le;if(h.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+R+"/"+Math.round(le)+"/"+ge+"/"+re+"/"+u+"/"+ve),le>ge&&(!ve||de&&!this.bitrateTestDelay||ve<u))return R}}return-1},xi(a,[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this._bwEstimator;if(e!==-1&&(!t||!t.canEstimate()))return e;var n=this._nextABRAutoLevel;return e!==-1&&(n=Math.min(e,n)),n},set:function(e){this._nextAutoLevel=e}},{key:"_nextABRAutoLevel",get:function(){var e=this.hls,t=e.maxAutoLevel,n=e.levels,s=e.config,l=e.minAutoLevel,u=e.media,c=this.lastLoadedFragLevel,v=this.fragCurrent?this.fragCurrent.duration:0,p=u?u.currentTime:0,R=u&&u.playbackRate!==0?Math.abs(u.playbackRate):1,P=this._bwEstimator?this._bwEstimator.getEstimate():s.abrEwmaDefaultEstimate,z=(x.bufferInfo(u,p,s.maxBufferHole).end-p)/R,re=this._findBestLevel(c,v,P,l,t,z,s.abrBandWidthFactor,s.abrBandWidthUpFactor,n);if(re>=0)return re;h.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var de=v?Math.min(v,s.maxStarvationDelay):s.maxStarvationDelay,le=s.abrBandWidthFactor,ge=s.abrBandWidthUpFactor;if(z===0){var ve=this.bitrateTestDelay;if(ve){var _e=v?Math.min(v,s.maxLoadingDelay):s.maxLoadingDelay;de=_e-ve,h.logger.trace("bitrate test took "+Math.round(1e3*ve)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*de)+" ms"),le=ge=1}}return re=this._findBestLevel(c,v,P,l,t,z+de,le,ge,n),Math.max(re,0)}}]),a}(S),Ai=_i;function bi(o,a){o.prototype=Object.create(a.prototype),o.prototype.constructor=o,o.__proto__=a}var Cr=T(),Ri=function(o){bi(a,o);function a(r){var e;return e=o.call(this,r,d.default.MEDIA_ATTACHING,d.default.MEDIA_DETACHING,d.default.MANIFEST_PARSED,d.default.BUFFER_RESET,d.default.BUFFER_APPENDING,d.default.BUFFER_CODECS,d.default.BUFFER_EOS,d.default.BUFFER_FLUSHING,d.default.LEVEL_PTS_UPDATED,d.default.LEVEL_UPDATED)||this,e._msDuration=null,e._levelDuration=null,e._levelTargetDuration=10,e._live=null,e._objectUrl=null,e._needsFlush=!1,e._needsEos=!1,e.config=void 0,e.audioTimestampOffset=void 0,e.bufferCodecEventsExpected=0,e._bufferCodecEventsTotal=0,e.media=null,e.mediaSource=null,e.segments=[],e.parent=void 0,e.appending=!1,e.appended=0,e.appendError=0,e.flushBufferCounter=0,e.tracks={},e.pendingTracks={},e.sourceBuffer={},e.flushRange=[],e._onMediaSourceOpen=function(){h.logger.log("media source opened"),e.hls.trigger(d.default.MEDIA_ATTACHED,{media:e.media});var t=e.mediaSource;t&&t.removeEventListener("sourceopen",e._onMediaSourceOpen),e.checkPendingTracks()},e._onMediaSourceClose=function(){h.logger.log("media source closed")},e._onMediaSourceEnded=function(){h.logger.log("media source ended")},e._onSBUpdateEnd=function(){if(e.audioTimestampOffset&&e.sourceBuffer.audio){var t=e.sourceBuffer.audio;h.logger.warn("change mpeg audio timestamp offset from "+t.timestampOffset+" to "+e.audioTimestampOffset),t.timestampOffset=e.audioTimestampOffset,delete e.audioTimestampOffset}e._needsFlush&&e.doFlush(),e._needsEos&&e.checkEos(),e.appending=!1;var n=e.parent,s=e.segments.reduce(function(p,R){return R.parent===n?p+1:p},0),l={},u=e.sourceBuffer;for(var c in u){var v=u[c];if(!v)throw Error("handling source buffer update end error: source buffer for "+c+" uninitilized and unable to update buffered TimeRanges.");l[c]=v.buffered}e.hls.trigger(d.default.BUFFER_APPENDED,{parent:n,pending:s,timeRanges:l}),e._needsFlush||e.doAppending(),e.updateMediaElementDuration(),s===0&&e.flushLiveBackBuffer()},e._onSBUpdateError=function(t){h.logger.error("sourceBuffer error:",t),e.hls.trigger(d.default.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},e.config=r.config,e}var i=a.prototype;return i.destroy=function(){S.prototype.destroy.call(this)},i.onLevelPtsUpdated=function(e){var t=e.type,n=this.tracks.audio;if(t==="audio"&&n&&n.container==="audio/mpeg"){var s=this.sourceBuffer.audio;if(!s)throw Error("Level PTS Updated and source buffer for audio uninitalized");var l=Math.abs(s.timestampOffset-e.start);if(l>.1){var u=s.updating;try{s.abort()}catch(c){h.logger.warn("can not abort audio buffer: "+c)}u?this.audioTimestampOffset=e.start:(h.logger.warn("change mpeg audio timestamp offset from "+s.timestampOffset+" to "+e.start),s.timestampOffset=e.start)}}},i.onManifestParsed=function(e){var t=2;(e.audio&&!e.video||!e.altAudio)&&(t=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=t,h.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},i.onMediaAttaching=function(e){var t=this.media=e.media;if(t&&Cr){var n=this.mediaSource=new Cr;n.addEventListener("sourceopen",this._onMediaSourceOpen),n.addEventListener("sourceended",this._onMediaSourceEnded),n.addEventListener("sourceclose",this._onMediaSourceClose),t.src=window.URL.createObjectURL(n),this._objectUrl=t.src}},i.onMediaDetaching=function(){h.logger.log("media source detaching");var e=this.mediaSource;if(e){if(e.readyState==="open")try{e.endOfStream()}catch(t){h.logger.warn("onMediaDetaching:"+t.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),this.media&&(this._objectUrl&&window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):h.logger.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.hls.trigger(d.default.MEDIA_DETACHED)},i.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.pendingTracks,n=Object.keys(t).length;(n&&!e||n===2)&&(this.createSourceBuffers(t),this.pendingTracks={},this.doAppending())},i.onBufferReset=function(){var e=this.sourceBuffer;for(var t in e){var n=e[t];try{n&&(this.mediaSource&&this.mediaSource.removeSourceBuffer(n),n.removeEventListener("updateend",this._onSBUpdateEnd),n.removeEventListener("error",this._onSBUpdateError))}catch{}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},i.onBufferCodecs=function(e){var t=this;Object.keys(this.sourceBuffer).length||(Object.keys(e).forEach(function(n){t.pendingTracks[n]=e[n]}),this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},i.createSourceBuffers=function(e){var t=this.sourceBuffer,n=this.mediaSource;if(!n)throw Error("createSourceBuffers called when mediaSource was null");for(var s in e)if(!t[s]){var l=e[s];if(!l)throw Error("source buffer exists for track "+s+", however track does not");var u=l.levelCodec||l.codec,c=l.container+";codecs="+u;h.logger.log("creating sourceBuffer("+c+")");try{var v=t[s]=n.addSourceBuffer(c);v.addEventListener("updateend",this._onSBUpdateEnd),v.addEventListener("error",this._onSBUpdateError),this.tracks[s]={buffer:v,codec:u,id:l.id,container:l.container,levelCodec:l.levelCodec}}catch(p){h.logger.error("error while trying to add sourceBuffer:"+p.message),this.hls.trigger(d.default.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:p,mimeType:c})}}this.hls.trigger(d.default.BUFFER_CREATED,{tracks:this.tracks})},i.onBufferAppending=function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())},i.onBufferEos=function(e){for(var t in this.sourceBuffer)if(!e.type||e.type===t){var n=this.sourceBuffer[t];n&&!n.ended&&(n.ended=!0,h.logger.log(t+" sourceBuffer now EOS"))}this.checkEos()},i.checkEos=function(){var e=this.sourceBuffer,t=this.mediaSource;if(!t||t.readyState!=="open"){this._needsEos=!1;return}for(var n in e){var s=e[n];if(s){if(!s.ended)return;if(s.updating){this._needsEos=!0;return}}}h.logger.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch{h.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1},i.onBufferFlushing=function(e){e.type?this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}):(this.flushRange.push({start:e.startOffset,end:e.endOffset,type:"video"}),this.flushRange.push({start:e.startOffset,end:e.endOffset,type:"audio"})),this.flushBufferCounter=0,this.doFlush()},i.flushLiveBackBuffer=function(){if(this._live){var e=this.config.liveBackBufferLength;if(!(!isFinite(e)||e<0)){if(!this.media){h.logger.error("flushLiveBackBuffer called without attaching media");return}for(var t=this.media.currentTime,n=this.sourceBuffer,s=Object.keys(n),l=t-Math.max(e,this._levelTargetDuration),u=s.length-1;u>=0;u--){var c=s[u],v=n[c];if(v){var p=v.buffered;p.length>0&&l>p.start(0)&&this.removeBufferRange(c,v,0,l)&&this.hls.trigger(d.default.LIVE_BACK_BUFFER_REACHED,{bufferEnd:l})}}}}},i.onLevelUpdated=function(e){var t=e.details;t.fragments.length>0&&(this._levelDuration=t.totalduration+t.fragments[0].start,this._levelTargetDuration=t.averagetargetduration||t.targetduration||10,this._live=t.live,this.updateMediaElementDuration())},i.updateMediaElementDuration=function(){var e=this.config,t;if(!(this._levelDuration===null||!this.media||!this.mediaSource||!this.sourceBuffer||this.media.readyState===0||this.mediaSource.readyState!=="open")){for(var n in this.sourceBuffer){var s=this.sourceBuffer[n];if(s&&s.updating===!0)return}t=this.media.duration,this._msDuration===null&&(this._msDuration=this.mediaSource.duration),this._live===!0&&e.liveDurationInfinity===!0?(h.logger.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>t||!Object(q.isFiniteNumber)(t))&&(h.logger.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},i.doFlush=function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(this.flushBuffer(e.start,e.end,e.type))this.flushRange.shift(),this.flushBufferCounter=0;else{this._needsFlush=!0;return}}if(this.flushRange.length===0){this._needsFlush=!1;var t=0,n=this.sourceBuffer;try{for(var s in n){var l=n[s];l&&(t+=l.buffered.length)}}catch{h.logger.error("error while accessing sourceBuffer.buffered")}this.appended=t,this.hls.trigger(d.default.BUFFER_FLUSHED)}},i.doAppending=function(){var e=this.config,t=this.hls,n=this.segments,s=this.sourceBuffer;if(Object.keys(s).length){if(!this.media||this.media.error){this.segments=[],h.logger.error("trying to append although a media error occured, flush segment and abort");return}if(!this.appending){var l=n.shift();if(l)try{var u=s[l.type];if(!u){this._onSBUpdateEnd();return}if(u.updating){n.unshift(l);return}u.ended=!1,this.parent=l.parent,u.appendBuffer(l.data),this.appendError=0,this.appended++,this.appending=!0}catch(v){h.logger.error("error while trying to append buffer:"+v.message),n.unshift(l);var c={type:A.ErrorTypes.MEDIA_ERROR,parent:l.parent,details:"",fatal:!1};v.code===22?(this.segments=[],c.details=A.ErrorDetails.BUFFER_FULL_ERROR):(this.appendError++,c.details=A.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>e.appendErrorMaxRetry&&(h.logger.log("fail "+e.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],c.fatal=!0)),t.trigger(d.default.ERROR,c)}}}},i.flushBuffer=function(e,t,n){var s=this.sourceBuffer;if(!Object.keys(s).length)return!0;var l="null";if(this.media&&(l=this.media.currentTime.toFixed(3)),h.logger.log("flushBuffer,pos/start/end: "+l+"/"+e+"/"+t),this.flushBufferCounter>=this.appended)return h.logger.warn("abort flushing too many retries"),!0;var u=s[n];if(u){if(u.ended=!1,u.updating)return h.logger.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(n,u,e,t))return this.flushBufferCounter++,!1}return h.logger.log("buffer flushed"),!0},i.removeBufferRange=function(e,t,n,s){try{for(var l=0;l<t.buffered.length;l++){var u=t.buffered.start(l),c=t.buffered.end(l),v=Math.max(u,n),p=Math.min(c,s);if(Math.min(p,c)-v>.5){var R="null";return this.media&&(R=this.media.currentTime.toString()),h.logger.log("sb remove "+e+" ["+v+","+p+"], of ["+u+","+c+"], pos:"+R),t.remove(v,p),!0}}}catch(P){h.logger.warn("removeBufferRange failed",P)}return!1},a}(S),Li=Ri;function kr(o,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function wi(o,a,i){return a&&kr(o.prototype,a),i&&kr(o,i),o}function Di(o,a){o.prototype=Object.create(a.prototype),o.prototype.constructor=o,o.__proto__=a}var Ii=function(o){Di(a,o);function a(r){var e;return e=o.call(this,r,d.default.FPS_DROP_LEVEL_CAPPING,d.default.MEDIA_ATTACHING,d.default.MANIFEST_PARSED,d.default.LEVELS_UPDATED,d.default.BUFFER_CODECS,d.default.MEDIA_DETACHING)||this,e.autoLevelCapping=Number.POSITIVE_INFINITY,e.firstLevel=null,e.levels=[],e.media=null,e.restrictedLevels=[],e.timer=null,e.clientRect=null,e}var i=a.prototype;return i.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this.clientRect=null,this.stopCapping())},i.onFpsDropLevelCapping=function(e){a.isLevelAllowed(e.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(e.droppedLevel)},i.onMediaAttaching=function(e){this.media=e.media instanceof window.HTMLVideoElement?e.media:null},i.onManifestParsed=function(e){var t=this.hls;this.restrictedLevels=[],this.levels=e.levels,this.firstLevel=e.firstLevel,t.config.capLevelToPlayerSize&&e.video&&this.startCapping()},i.onBufferCodecs=function(e){var t=this.hls;t.config.capLevelToPlayerSize&&e.video&&this.startCapping()},i.onLevelsUpdated=function(e){this.levels=e.levels},i.onMediaDetaching=function(){this.stopCapping()},i.detectPlayerSize=function(){if(this.media){var e=this.levels?this.levels.length:0;if(e){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},i.getMaxLevel=function(e){var t=this;if(!this.levels)return-1;var n=this.levels.filter(function(s,l){return a.isLevelAllowed(l,t.restrictedLevels)&&l<=e});return this.clientRect=null,a.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)},i.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},i.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},i.getDimensions=function(){if(this.clientRect)return this.clientRect;var e=this.media,t={width:0,height:0};if(e){var n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,!t.width&&!t.height&&(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t},a.isLevelAllowed=function(e,t){return t===void 0&&(t=[]),t.indexOf(e)===-1},a.getMaxLevelByMediaSize=function(e,t,n){if(!e||e&&!e.length)return-1;for(var s=function(p,R){return R?p.width!==R.width||p.height!==R.height:!0},l=e.length-1,u=0;u<e.length;u+=1){var c=e[u];if((c.width>=t||c.height>=n)&&s(c,e[u+1])){l=u;break}}return l},wi(a,[{key:"mediaWidth",get:function(){return this.getDimensions().width*a.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*a.contentScaleFactor}}],[{key:"contentScaleFactor",get:function(){var e=1;try{e=window.devicePixelRatio}catch{}return e}}]),a}(S),Oi=Ii;function Fi(o,a){o.prototype=Object.create(a.prototype),o.prototype.constructor=o,o.__proto__=a}var Ci=window,ki=Ci.performance,Pi=function(o){Fi(a,o);function a(r){return o.call(this,r,d.default.MEDIA_ATTACHING)||this}var i=a.prototype;return i.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},i.onMediaAttaching=function(e){var t=this.hls.config;if(t.capLevelOnFPSDrop){var n=this.video=e.media instanceof window.HTMLVideoElement?e.media:null;typeof n.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod)}},i.checkFPS=function(e,t,n){var s=ki.now();if(t){if(this.lastTime){var l=s-this.lastTime,u=n-this.lastDroppedFrames,c=t-this.lastDecodedFrames,v=1e3*u/l,p=this.hls;if(p.trigger(d.default.FPS_DROP,{currentDropped:u,currentDecoded:c,totalDroppedFrames:n}),v>0&&u>p.config.fpsDroppedMonitoringThreshold*c){var R=p.currentLevel;h.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+R),R>0&&(p.autoLevelCapping===-1||p.autoLevelCapping>=R)&&(R=R-1,p.trigger(d.default.FPS_DROP_LEVEL_CAPPING,{level:R,droppedLevel:p.currentLevel}),p.autoLevelCapping=R,p.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=n,this.lastDecodedFrames=t}},i.checkFPSInterval=function(){var e=this.video;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},a}(S),Mi=Pi,Ni=function(){function o(i){i&&i.xhrSetup&&(this.xhrSetup=i.xhrSetup)}var a=o.prototype;return a.destroy=function(){this.abort(),this.loader=null},a.abort=function(){var r=this.loader;r&&r.readyState!==4&&(this.stats.aborted=!0,r.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},a.load=function(r,e,t){this.context=r,this.config=e,this.callbacks=t,this.stats={trequest:window.performance.now(),retry:0},this.retryDelay=e.retryDelay,this.loadInternal()},a.loadInternal=function(){var r,e=this.context;r=this.loader=new window.XMLHttpRequest;var t=this.stats;t.tfirst=0,t.loaded=0;var n=this.xhrSetup;try{if(n)try{n(r,e.url)}catch{r.open("GET",e.url,!0),n(r,e.url)}r.readyState||r.open("GET",e.url,!0)}catch(s){this.callbacks.onError({code:r.status,text:s.message},e,r);return}e.rangeEnd&&r.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),r.onreadystatechange=this.readystatechange.bind(this),r.onprogress=this.loadprogress.bind(this),r.responseType=e.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),r.send()},a.readystatechange=function(r){var e=r.currentTarget,t=e.readyState,n=this.stats,s=this.context,l=this.config;if(!n.aborted&&t>=2)if(window.clearTimeout(this.requestTimeout),n.tfirst===0&&(n.tfirst=Math.max(window.performance.now(),n.trequest)),t===4){var u=e.status;if(u>=200&&u<300){n.tload=Math.max(n.tfirst,window.performance.now());var c,v;s.responseType==="arraybuffer"?(c=e.response,v=c.byteLength):(c=e.responseText,v=c.length),n.loaded=n.total=v;var p={url:e.responseURL,data:c};this.callbacks.onSuccess(p,n,s,e)}else n.retry>=l.maxRetry||u>=400&&u<499?(h.logger.error(u+" while loading "+s.url),this.callbacks.onError({code:u,text:e.statusText},s,e)):(h.logger.warn(u+" while loading "+s.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,l.maxRetryDelay),n.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),l.timeout)},a.loadtimeout=function(){h.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},a.loadprogress=function(r){var e=r.currentTarget,t=this.stats;t.loaded=r.loaded,r.lengthComputable&&(t.total=r.total);var n=this.callbacks.onProgress;n&&n(t,this.context,null,e)},o}(),Ui=Ni;function Pr(o,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function Bi(o,a,i){return a&&Pr(o.prototype,a),i&&Pr(o,i),o}function Gi(o,a){o.prototype=Object.create(a.prototype),o.prototype.constructor=o,o.__proto__=a}var ji=function(o){Gi(a,o);function a(r){var e;return e=o.call(this,r,d.default.MANIFEST_LOADING,d.default.MANIFEST_PARSED,d.default.AUDIO_TRACK_LOADED,d.default.AUDIO_TRACK_SWITCHED,d.default.LEVEL_LOADED,d.default.ERROR)||this,e._trackId=-1,e._selectDefaultTrack=!0,e.tracks=[],e.trackIdBlacklist=Object.create(null),e.audioGroupId=null,e}var i=a.prototype;return i.onManifestLoading=function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},i.onManifestParsed=function(e){var t=this.tracks=e.audioTracks||[];this.hls.trigger(d.default.AUDIO_TRACKS_UPDATED,{audioTracks:t}),this._selectAudioGroup(this.hls.nextLoadLevel)},i.onAudioTrackLoaded=function(e){if(e.id>=this.tracks.length){h.logger.warn("Invalid audio track id:",e.id);return}if(h.logger.log("audioTrack "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.hasInterval()){var t=e.details.targetduration*1e3;this.setInterval(t)}!e.details.live&&this.hasInterval()&&this.clearInterval()},i.onAudioTrackSwitched=function(e){var t=this.tracks[e.id].groupId;t&&this.audioGroupId!==t&&(this.audioGroupId=t)},i.onLevelLoaded=function(e){this._selectAudioGroup(e.level)},i.onError=function(e){e.type===A.ErrorTypes.NETWORK_ERROR&&(e.fatal&&this.clearInterval(),e.details===A.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&(h.logger.warn("Network failure on audio-track id:",e.context.id),this._handleLoadError()))},i._setAudioTrack=function(e){if(this._trackId===e&&this.tracks[this._trackId].details){h.logger.debug("Same id as current audio-track passed, and track details available -> no-op");return}if(e<0||e>=this.tracks.length){h.logger.warn("Invalid id passed to audio-track controller");return}var t=this.tracks[e];h.logger.log("Now switching to audio-track index "+e),this.clearInterval(),this._trackId=e;var n=t.url,s=t.type,l=t.id;this.hls.trigger(d.default.AUDIO_TRACK_SWITCHING,{id:l,type:s,url:n}),this._loadTrackDetailsIfNeeded(t)},i.doTick=function(){this._updateTrack(this._trackId)},i._selectAudioGroup=function(e){var t=this.hls.levels[e];if(!(!t||!t.audioGroupIds)){var n=t.audioGroupIds[t.urlId];this.audioGroupId!==n&&(this.audioGroupId=n,this._selectInitialAudioTrack())}},i._selectInitialAudioTrack=function(){var e=this,t=this.tracks;if(t.length){var n=this.tracks[this._trackId],s=null;if(n&&(s=n.name),this._selectDefaultTrack){var l=t.filter(function(v){return v.default});l.length?t=l:h.logger.warn("No default audio tracks defined")}var u=!1,c=function(){t.forEach(function(p){u||(!e.audioGroupId||p.groupId===e.audioGroupId)&&(!s||s===p.name)&&(e._setAudioTrack(p.id),u=!0)})};c(),u||(s=null,c()),u||(h.logger.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(d.default.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}},i._needsTrackLoading=function(e){var t=e.details,n=e.url;return!t||t.live?!!n:!1},i._loadTrackDetailsIfNeeded=function(e){if(this._needsTrackLoading(e)){var t=e.url,n=e.id;h.logger.log("loading audio-track playlist for id: "+n),this.hls.trigger(d.default.AUDIO_TRACK_LOADING,{url:t,id:n})}},i._updateTrack=function(e){if(!(e<0||e>=this.tracks.length)){this.clearInterval(),this._trackId=e,h.logger.log("trying to update audio-track "+e);var t=this.tracks[e];this._loadTrackDetailsIfNeeded(t)}},i._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var e=this._trackId,t=this.tracks[e],n=t.name,s=t.language,l=t.groupId;h.logger.warn("Loading failed on audio track id: "+e+", group-id: "+l+', name/language: "'+n+'" / "'+s+'"');for(var u=e,c=0;c<this.tracks.length;c++)if(!this.trackIdBlacklist[c]){var v=this.tracks[c];if(v.name===n){u=c;break}}if(u===e){h.logger.warn('No fallback audio-track found for name/language: "'+n+'" / "'+s+'"');return}h.logger.log("Attempting audio-track fallback id:",u,"group-id:",this.tracks[u].groupId),this._setAudioTrack(u)},Bi(a,[{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this._trackId},set:function(e){this._setAudioTrack(e),this._selectDefaultTrack=!1}}]),a}(_t),Ki=ji;function Mr(o,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function Hi(o,a,i){return a&&Mr(o.prototype,a),i&&Mr(o,i),o}function Wi(o,a){o.prototype=Object.create(a.prototype),o.prototype.constructor=o,o.__proto__=a}var Vi=window,Zt=Vi.performance,Nr=100,Yi=function(o){Wi(a,o);function a(r,e){var t;return t=o.call(this,r,d.default.MEDIA_ATTACHED,d.default.MEDIA_DETACHING,d.default.AUDIO_TRACKS_UPDATED,d.default.AUDIO_TRACK_SWITCHING,d.default.AUDIO_TRACK_LOADED,d.default.KEY_LOADED,d.default.FRAG_LOADED,d.default.FRAG_PARSING_INIT_SEGMENT,d.default.FRAG_PARSING_DATA,d.default.FRAG_PARSED,d.default.ERROR,d.default.BUFFER_RESET,d.default.BUFFER_CREATED,d.default.BUFFER_APPENDED,d.default.BUFFER_FLUSHED,d.default.INIT_PTS_FOUND)||this,t.fragmentTracker=e,t.config=r.config,t.audioCodecSwap=!1,t._state=B.STOPPED,t.initPTS=[],t.waitingFragment=null,t.videoTrackCC=null,t.waitingVideoCC=null,t}var i=a.prototype;return i.onInitPtsFound=function(e){var t=e.id,n=e.frag.cc,s=e.initPTS;t==="main"&&(this.initPTS[n]=s,this.videoTrackCC=n,h.logger.log("InitPTS for cc: "+n+" found from main: "+s),this.state===B.WAITING_INIT_PTS&&this.tick())},i.startLoad=function(e){if(this.tracks){var t=this.lastCurrentTime;this.stopLoad(),this.setInterval(Nr),this.fragLoadError=0,t>0&&e===-1?(h.logger.log("audio:override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=B.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=B.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=e,this.state=B.STOPPED},i.doTick=function(){var e,t,n,s=this.hls,l=s.config;switch(this.state){case B.ERROR:case B.PAUSED:case B.BUFFER_FLUSHING:break;case B.STARTING:this.state=B.WAITING_TRACK,this.loadedmetadata=!1;break;case B.IDLE:var u=this.tracks;if(!u||!this.media&&(this.startFragRequested||!l.startFragPrefetch))break;if(this.loadedmetadata)e=this.media.currentTime;else if(e=this.nextLoadPosition,e===void 0)break;var c=this.mediaBuffer?this.mediaBuffer:this.media,v=this.videoBuffer?this.videoBuffer:this.media,p=e<l.maxBufferHole?Math.max(ft,l.maxBufferHole):l.maxBufferHole,R=x.bufferInfo(c,e,p),P=x.bufferInfo(v,e,p),z=R.len,re=R.end,de=this.fragPrevious,le=Math.min(l.maxBufferLength,l.maxMaxBufferLength),ge=Math.max(le,P.len),ve=this.audioSwitch,_e=this.trackId;if((z<ge||ve)&&_e<u.length){if(n=u[_e].details,typeof n>"u"){this.state=B.WAITING_TRACK;break}if(!ve&&this._streamEnded(R,n)){this.hls.trigger(d.default.BUFFER_EOS,{type:"audio"}),this.state=B.ENDED;return}var We=n.fragments,ct=We.length,it=We[0].start,Lt=We[ct-1].start+We[ct-1].duration,he;if(ve){if(n.live&&!n.PTSKnown)h.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),re=0;else if(re=e,n.PTSKnown&&e<it)if(R.end>it||R.nextStart)h.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=it+.05;else return}if(n.initSegment&&!n.initSegment.data)he=n.initSegment;else if(re<=it){if(he=We[0],this.videoTrackCC!==null&&he.cc!==this.videoTrackCC&&(he=we(We,this.videoTrackCC)),n.live&&he.loadIdx&&he.loadIdx===this.fragLoadIdx){var Ee=R.nextStart?R.nextStart:it;h.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(Ee+.05)),this.media.currentTime=Ee+.05;return}}else{var ze,Wt=l.maxFragLookUpTolerance,Vt=de?We[de.sn-We[0].sn+1]:void 0;re<Lt?(re>Lt-Wt&&(Wt=0),Vt&&!Be(re,Wt,Vt)?ze=Vt:ze=D.search(We,function(jn){return Be(re,Wt,jn)})):ze=We[ct-1],ze&&(he=ze,it=ze.start,de&&he.level===de.level&&he.sn===de.sn&&(he.sn<n.endSN?(he=We[he.sn+1-n.startSN],this.fragmentTracker.getState(he)!==He.OK&&h.logger.log("SN just loaded, load next one: "+he.sn)):he=null))}he&&(he.encrypted?(h.logger.log("Loading key for "+he.sn+" of ["+n.startSN+" ,"+n.endSN+"],track "+_e),this.state=B.KEY_LOADING,s.trigger(d.default.KEY_LOADING,{frag:he})):(this.fragCurrent=he,(ve||this.fragmentTracker.getState(he)===He.NOT_LOADED)&&(h.logger.log("Loading "+he.sn+", cc: "+he.cc+" of ["+n.startSN+" ,"+n.endSN+"],track "+_e+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+e+", bufferEnd: "+re.toFixed(3)),he.sn!=="initSegment"&&(this.startFragRequested=!0),Object(q.isFiniteNumber)(he.sn)&&(this.nextLoadPosition=he.start+he.duration),s.trigger(d.default.FRAG_LOADING,{frag:he}),this.state=B.FRAG_LOADING)))}break;case B.WAITING_TRACK:t=this.tracks[this.trackId],t&&t.details&&(this.state=B.IDLE);break;case B.FRAG_LOADING_WAITING_RETRY:var Jt=Zt.now(),dr=this.retryDate;c=this.media;var Bn=c&&c.seeking;(!dr||Jt>=dr||Bn)&&(h.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=B.IDLE);break;case B.WAITING_INIT_PTS:var er=this.waitingFragment;if(er){var _r=er.frag.cc;if(this.initPTS[_r]!==void 0)this.waitingFragment=null,this.state=B.FRAG_LOADING,this.onFragLoaded(er);else if(this.videoTrackCC!==this.waitingVideoCC)h.logger.log("Waiting fragment cc ("+_r+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var li=x.bufferInfo(this.mediaBuffer,this.media.currentTime,l.maxBufferHole),Gn=Be(li.end,l.maxFragLookUpTolerance,er.frag);Gn<0&&(h.logger.log("Waiting fragment cc ("+_r+") @ "+er.frag.start+" cancelled because another fragment at "+li.end+" is needed"),this.clearWaitingFragment())}}else this.state=B.IDLE;break}},i.clearWaitingFragment=function(){var e=this.waitingFragment;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingFragment=null,this.waitingVideoCC=null,this.state=B.IDLE)},i.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("ended",this.onvended);var n=this.config;this.tracks&&n.autoStartLoad&&this.startLoad(n.startPosition)},i.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(h.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},i.onAudioTracksUpdated=function(e){h.logger.log("audio tracks updated"),this.tracks=e.audioTracks},i.onAudioTrackSwitching=function(e){var t=!!e.url;this.trackId=e.id,this.fragCurrent=null,this.clearWaitingFragment(),this.state=B.PAUSED,t?this.setInterval(Nr):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=B.IDLE),this.tick()},i.onAudioTrackLoaded=function(e){var t=e.details,n=e.id,s=this.tracks[n],l=s.details,u=t.totalduration,c=0;if(h.logger.log("track "+n+" loaded ["+t.startSN+","+t.endSN+"],duration:"+u),t.live||l&&l.live?l&&t.fragments.length>0?(ce(l,t),c=t.fragments[0].start,t.PTSKnown?h.logger.log("live audio playlist sliding:"+c.toFixed(3)):h.logger.log("live audio playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,h.logger.log("live audio playlist - first load, unknown sliding")):t.PTSKnown=!1,s.details=t,!this.startFragRequested){if(this.startPosition===-1){var v=t.startTimeOffset;Object(q.isFiniteNumber)(v)?(h.logger.log("start time offset found in playlist, adjust startPosition to "+v),this.startPosition=v):t.live?(this.startPosition=this.computeLivePosition(c,t),h.logger.log("compute startPosition for audio-track to "+this.startPosition)):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===B.WAITING_TRACK&&(this.state=B.IDLE),this.tick()},i.onKeyLoaded=function(){this.state===B.KEY_LOADING&&(this.state=B.IDLE,this.tick())},i.onFragLoaded=function(e){var t=this.fragCurrent,n=e.frag;if(this.state===B.FRAG_LOADING&&t&&n.type==="audio"&&n.level===t.level&&n.sn===t.sn){var s=this.tracks[this.trackId],l=s.details,u=l.totalduration,c=t.level,v=t.sn,p=t.cc,R=this.config.defaultAudioCodec||s.audioCodec||"mp4a.40.2",P=this.stats=e.stats;if(v==="initSegment")this.state=B.IDLE,P.tparsed=P.tbuffered=Zt.now(),l.initSegment.data=e.payload,this.hls.trigger(d.default.FRAG_BUFFERED,{stats:P,frag:t,id:"audio"}),this.tick();else{this.state=B.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new J(this.hls,"audio"));var z=this.initPTS[p],re=l.initSegment?l.initSegment.data:[];if(z!==void 0){this.pendingBuffering=!0,h.logger.log("Demuxing "+v+" of ["+l.startSN+" ,"+l.endSN+"],track "+c);var de=!1;this.demuxer.push(e.payload,re,R,null,t,u,de,z)}else h.logger.log("Unknown video PTS for cc "+p+", waiting for video PTS before demuxing audio frag "+v+" of ["+l.startSN+" ,"+l.endSN+"],track "+c),this.waitingFragment=e,this.waitingVideoCC=this.videoTrackCC,this.state=B.WAITING_INIT_PTS}}this.fragLoadError=0},i.onFragParsingInitSegment=function(e){var t=this.fragCurrent,n=e.frag;if(t&&e.id==="audio"&&n.sn===t.sn&&n.level===t.level&&this.state===B.PARSING){var s=e.tracks,l;if(s.video&&delete s.video,l=s.audio,l){l.levelCodec=l.codec,l.id=e.id,this.hls.trigger(d.default.BUFFER_CODECS,s),h.logger.log("audio track:audio,container:"+l.container+",codecs[level/parsed]=["+l.levelCodec+"/"+l.codec+"]");var u=l.initSegment;if(u){var c={type:"audio",data:u,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[c]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(d.default.BUFFER_APPENDING,c))}this.tick()}}},i.onFragParsingData=function(e){var t=this,n=this.fragCurrent,s=e.frag;if(n&&e.id==="audio"&&e.type==="audio"&&s.sn===n.sn&&s.level===n.level&&this.state===B.PARSING){var l=this.trackId,u=this.tracks[l],c=this.hls;Object(q.isFiniteNumber)(e.endPTS)||(e.endPTS=e.startPTS+n.duration,e.endDTS=e.startDTS+n.duration),n.addElementaryStream(te.AUDIO),h.logger.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb),Q(u.details,n,e.startPTS,e.endPTS);var v=this.media,p=!1;if(this.audioSwitch)if(v&&v.readyState){var R=v.currentTime;h.logger.log("switching audio track : currentTime:"+R),R>=e.startPTS&&(h.logger.log("switching audio track : flushing all audio"),this.state=B.BUFFER_FLUSHING,c.trigger(d.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),p=!0,this.audioSwitch=!1,c.trigger(d.default.AUDIO_TRACK_SWITCHED,{id:l}))}else this.audioSwitch=!1,c.trigger(d.default.AUDIO_TRACK_SWITCHED,{id:l});var P=this.pendingData;if(!P){h.logger.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),c.trigger(d.default.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:null,fatal:!0});return}this.audioSwitch||([e.data1,e.data2].forEach(function(z){z&&z.length&&P.push({type:e.type,data:z,parent:"audio",content:"data"})}),!p&&P.length&&(P.forEach(function(z){t.state===B.PARSING&&(t.pendingBuffering=!0,t.hls.trigger(d.default.BUFFER_APPENDING,z))}),this.pendingData=[],this.appended=!0)),this.tick()}},i.onFragParsed=function(e){var t=this.fragCurrent,n=e.frag;t&&e.id==="audio"&&n.sn===t.sn&&n.level===t.level&&this.state===B.PARSING&&(this.stats.tparsed=Zt.now(),this.state=B.PARSED,this._checkAppendedParsed())},i.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},i.onBufferCreated=function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer)},i.onBufferAppended=function(e){if(e.parent==="audio"){var t=this.state;(t===B.PARSING||t===B.PARSED)&&(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},i._checkAppendedParsed=function(){if(this.state===B.PARSED&&(!this.appended||!this.pendingBuffering)){var e=this.fragCurrent,t=this.stats,n=this.hls;if(e){this.fragPrevious=e,t.tbuffered=Zt.now(),n.trigger(d.default.FRAG_BUFFERED,{stats:t,frag:e,id:"audio"});var s=this.mediaBuffer?this.mediaBuffer:this.media;s&&h.logger.log("audio buffered : "+Re.toString(s.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,n.trigger(d.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=B.IDLE}this.tick()}},i.onError=function(e){var t=e.frag;if(!(t&&t.type!=="audio"))switch(e.details){case A.ErrorDetails.FRAG_LOAD_ERROR:case A.ErrorDetails.FRAG_LOAD_TIMEOUT:var n=e.frag;if(n&&n.type!=="audio")break;if(!e.fatal){var s=this.fragLoadError;s?s++:s=1;var l=this.config;if(s<=l.fragLoadingMaxRetry){this.fragLoadError=s;var u=Math.min(Math.pow(2,s-1)*l.fragLoadingRetryDelay,l.fragLoadingMaxRetryTimeout);h.logger.warn("AudioStreamController: frag loading failed, retry in "+u+" ms"),this.retryDate=Zt.now()+u,this.state=B.FRAG_LOADING_WAITING_RETRY}else h.logger.error("AudioStreamController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=B.ERROR}break;case A.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case A.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case A.ErrorDetails.KEY_LOAD_ERROR:case A.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==B.ERROR&&(this.state=e.fatal?B.ERROR:B.IDLE,h.logger.warn("AudioStreamController: "+e.details+" while loading frag, now switching to "+this.state+" state ..."));break;case A.ErrorDetails.BUFFER_FULL_ERROR:if(e.parent==="audio"&&(this.state===B.PARSING||this.state===B.PARSED)){var c=this.mediaBuffer,v=this.media.currentTime,p=c&&x.isBuffered(c,v)&&x.isBuffered(c,v+.5);if(p){var R=this.config;R.maxMaxBufferLength>=R.maxBufferLength&&(R.maxMaxBufferLength/=2,h.logger.warn("AudioStreamController: reduce max buffer length to "+R.maxMaxBufferLength+"s")),this.state=B.IDLE}else h.logger.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=B.BUFFER_FLUSHING,this.hls.trigger(d.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}break}},i.onBufferFlushed=function(){var e=this,t=this.pendingData;t&&t.length?(h.logger.log("AudioStreamController: appending pending audio data after buffer flushed"),t.forEach(function(n){e.hls.trigger(d.default.BUFFER_APPENDING,n)}),this.appended=!0,this.pendingData=[],this.state=B.PARSED):(this.state=B.IDLE,this.fragPrevious=null,this.tick())},Hi(a,[{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,h.logger.log("audio stream:"+t+"->"+e)}},get:function(){return this._state}}]),a}(lt),Xi=Yi,Ur=function(){if(typeof window<"u"&&window.VTTCue)return window.VTTCue;var o="auto",a={"":!0,lr:!0,rl:!0},i={start:!0,middle:!0,end:!0,left:!0,right:!0};function r(s){if(typeof s!="string")return!1;var l=a[s.toLowerCase()];return l?s.toLowerCase():!1}function e(s){if(typeof s!="string")return!1;var l=i[s.toLowerCase()];return l?s.toLowerCase():!1}function t(s){for(var l=1;l<arguments.length;l++){var u=arguments[l];for(var c in u)s[c]=u[c]}return s}function n(s,l,u){var c=this,v={};v.enumerable=!0,c.hasBeenReset=!1;var p="",R=!1,P=s,z=l,re=u,de=null,le="",ge=!0,ve="auto",_e="start",We=50,ct="middle",it=50,Lt="middle";Object.defineProperty(c,"id",t({},v,{get:function(){return p},set:function(Ee){p=""+Ee}})),Object.defineProperty(c,"pauseOnExit",t({},v,{get:function(){return R},set:function(Ee){R=!!Ee}})),Object.defineProperty(c,"startTime",t({},v,{get:function(){return P},set:function(Ee){if(typeof Ee!="number")throw new TypeError("Start time must be set to a number.");P=Ee,this.hasBeenReset=!0}})),Object.defineProperty(c,"endTime",t({},v,{get:function(){return z},set:function(Ee){if(typeof Ee!="number")throw new TypeError("End time must be set to a number.");z=Ee,this.hasBeenReset=!0}})),Object.defineProperty(c,"text",t({},v,{get:function(){return re},set:function(Ee){re=""+Ee,this.hasBeenReset=!0}})),Object.defineProperty(c,"region",t({},v,{get:function(){return de},set:function(Ee){de=Ee,this.hasBeenReset=!0}})),Object.defineProperty(c,"vertical",t({},v,{get:function(){return le},set:function(Ee){var ze=r(Ee);if(ze===!1)throw new SyntaxError("An invalid or illegal string was specified.");le=ze,this.hasBeenReset=!0}})),Object.defineProperty(c,"snapToLines",t({},v,{get:function(){return ge},set:function(Ee){ge=!!Ee,this.hasBeenReset=!0}})),Object.defineProperty(c,"line",t({},v,{get:function(){return ve},set:function(Ee){if(typeof Ee!="number"&&Ee!==o)throw new SyntaxError("An invalid number or illegal string was specified.");ve=Ee,this.hasBeenReset=!0}})),Object.defineProperty(c,"lineAlign",t({},v,{get:function(){return _e},set:function(Ee){var ze=e(Ee);if(!ze)throw new SyntaxError("An invalid or illegal string was specified.");_e=ze,this.hasBeenReset=!0}})),Object.defineProperty(c,"position",t({},v,{get:function(){return We},set:function(Ee){if(Ee<0||Ee>100)throw new Error("Position must be between 0 and 100.");We=Ee,this.hasBeenReset=!0}})),Object.defineProperty(c,"positionAlign",t({},v,{get:function(){return ct},set:function(Ee){var ze=e(Ee);if(!ze)throw new SyntaxError("An invalid or illegal string was specified.");ct=ze,this.hasBeenReset=!0}})),Object.defineProperty(c,"size",t({},v,{get:function(){return it},set:function(Ee){if(Ee<0||Ee>100)throw new Error("Size must be between 0 and 100.");it=Ee,this.hasBeenReset=!0}})),Object.defineProperty(c,"align",t({},v,{get:function(){return Lt},set:function(Ee){var ze=e(Ee);if(!ze)throw new SyntaxError("An invalid or illegal string was specified.");Lt=ze,this.hasBeenReset=!0}})),c.displayState=void 0}return n.prototype.getCueAsHTML=function(){var s=window.WebVTT;return s.convertCueToDOMTree(window,this.text)},n}(),zi=function(){return{decode:function(i){if(!i)return"";if(typeof i!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(i))}}};function Br(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new zi,this.regionList=[]}function qi(o){function a(r,e,t,n){return(r|0)*3600+(e|0)*60+(t|0)+(n|0)/1e3}var i=o.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return i?i[3]?a(i[1],i[2],i[3].replace(":",""),i[4]):i[1]>59?a(i[1],i[2],0,i[4]):a(0,i[1],i[2],i[4]):null}function Gr(){this.values=Object.create(null)}Gr.prototype={set:function(a,i){!this.get(a)&&i!==""&&(this.values[a]=i)},get:function(a,i,r){return r?this.has(a)?this.values[a]:i[r]:this.has(a)?this.values[a]:i},has:function(a){return a in this.values},alt:function(a,i,r){for(var e=0;e<r.length;++e)if(i===r[e]){this.set(a,i);break}},integer:function(a,i){/^-?\d+$/.test(i)&&this.set(a,parseInt(i,10))},percent:function(a,i){return i.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(i=parseFloat(i),i>=0&&i<=100)?(this.set(a,i),!0):!1}};function jr(o,a,i,r){var e=r?o.split(r):[o];for(var t in e)if(typeof e[t]=="string"){var n=e[t].split(i);if(n.length===2){var s=n[0],l=n[1];a(s,l)}}}var mr=new Ur(0,0,0),lr=mr.align==="middle"?"middle":"center";function $i(o,a,i){var r=o;function e(){var s=qi(o);if(s===null)throw new Error("Malformed timestamp: "+r);return o=o.replace(/^[^\sa-zA-Z-]+/,""),s}function t(s,l){var u=new Gr;jr(s,function(p,R){switch(p){case"region":for(var P=i.length-1;P>=0;P--)if(i[P].id===R){u.set(p,i[P].region);break}break;case"vertical":u.alt(p,R,["rl","lr"]);break;case"line":var z=R.split(","),re=z[0];u.integer(p,re),u.percent(p,re)&&u.set("snapToLines",!1),u.alt(p,re,["auto"]),z.length===2&&u.alt("lineAlign",z[1],["start",lr,"end"]);break;case"position":z=R.split(","),u.percent(p,z[0]),z.length===2&&u.alt("positionAlign",z[1],["start",lr,"end","line-left","line-right","auto"]);break;case"size":u.percent(p,R);break;case"align":u.alt(p,R,["start",lr,"end","left","right"]);break}},/:/,/\s/),l.region=u.get("region",null),l.vertical=u.get("vertical","");var c=u.get("line","auto");c==="auto"&&mr.line===-1&&(c=-1),l.line=c,l.lineAlign=u.get("lineAlign","start"),l.snapToLines=u.get("snapToLines",!0),l.size=u.get("size",100),l.align=u.get("align",lr);var v=u.get("position","auto");v==="auto"&&mr.position===50&&(v=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=v}function n(){o=o.replace(/^\s+/,"")}if(n(),a.startTime=e(),n(),o.substr(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+r);o=o.substr(3),n(),a.endTime=e(),n(),t(o,a)}function Kr(o){return o.replace(/<br(?: \/)?>/gi,`
`)}Br.prototype={parse:function(a){var i=this;a&&(i.buffer+=i.decoder.decode(a,{stream:!0}));function r(){var u=i.buffer,c=0;for(u=Kr(u);c<u.length&&u[c]!=="\r"&&u[c]!==`
`;)++c;var v=u.substr(0,c);return u[c]==="\r"&&++c,u[c]===`
`&&++c,i.buffer=u.substr(c),v}function e(u){jr(u,function(c,v){},/:/)}try{var t;if(i.state==="INITIAL"){if(!/\r\n|\n/.test(i.buffer))return this;t=r();var n=t.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!n||!n[0])throw new Error("Malformed WebVTT signature.");i.state="HEADER"}for(var s=!1;i.buffer;){if(!/\r\n|\n/.test(i.buffer))return this;switch(s?s=!1:t=r(),i.state){case"HEADER":/:/.test(t)?e(t):t||(i.state="ID");continue;case"NOTE":t||(i.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(t)){i.state="NOTE";break}if(!t)continue;if(i.cue=new Ur(0,0,""),i.state="CUE",t.indexOf("-->")===-1){i.cue.id=t;continue}case"CUE":try{$i(t,i.cue,i.regionList)}catch{i.cue=null,i.state="BADCUE";continue}i.state="CUETEXT";continue;case"CUETEXT":var l=t.indexOf("-->")!==-1;if(!t||l&&(s=!0)){i.oncue&&i.oncue(i.cue),i.cue=null,i.state="ID";continue}i.cue.text&&(i.cue.text+=`
`),i.cue.text+=t;continue;case"BADCUE":t||(i.state="ID");continue}}}catch{i.state==="CUETEXT"&&i.cue&&i.oncue&&i.oncue(i.cue),i.cue=null,i.state=i.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},flush:function(){var a=this;try{if(a.buffer+=a.decoder.decode(),(a.cue||a.state==="HEADER")&&(a.buffer+=`

`,a.parse()),a.state==="INITIAL")throw new Error("Malformed WebVTT signature.")}catch(i){throw i}return a.onflush&&a.onflush(),this}};var Qi=Br;function Zi(o,a,i,r){for(var e=[],t,n,s,l,u,c=window.VTTCue||TextTrackCue,v=0;v<r.rows.length;v++)if(t=r.rows[v],s=!0,l=0,u="",!t.isEmpty()){for(var p=0;p<t.chars.length;p++)t.chars[p].uchar.match(/\s/)&&s?l++:(u+=t.chars[p].uchar,s=!1);t.cueStartTime=a,a===i&&(i+=1e-4),n=new c(a,i,Kr(u.trim())),l>=16?l--:l++,navigator.userAgent.match(/Firefox\//)?n.line=v+1:n.line=v>7?v-2:v+1,n.align="left",n.position=Math.max(0,Math.min(100,100*(l/32))),e.push(n),o&&o.addCue(n)}return e}var Hr={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Wr=function(a){var i=a;return Hr.hasOwnProperty(a)&&(i=Hr[a]),String.fromCharCode(i)},Et=15,Rt=100,Ji={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},en={17:2,18:4,21:6,22:8,23:10,19:13,20:15},tn={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},rn={25:2,26:4,29:6,30:8,31:10,27:13,28:15},nn=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],Se;(function(o){o[o.ERROR=0]="ERROR",o[o.TEXT=1]="TEXT",o[o.WARNING=2]="WARNING",o[o.INFO=2]="INFO",o[o.DEBUG=3]="DEBUG",o[o.DATA=3]="DATA"})(Se||(Se={}));var an=function(){function o(){this.time=null,this.verboseLevel=Se.ERROR}var a=o.prototype;return a.log=function(r,e){this.verboseLevel>=r&&h.logger.log(this.time+" ["+r+"] "+e)},o}(),Ut=function(a){for(var i=[],r=0;r<a.length;r++)i.push(a[r].toString(16));return i},Vr=function(){function o(i,r,e,t,n){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=i||"white",this.underline=r||!1,this.italics=e||!1,this.background=t||"black",this.flash=n||!1}var a=o.prototype;return a.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},a.setStyles=function(r){for(var e=["foreground","underline","italics","background","flash"],t=0;t<e.length;t++){var n=e[t];r.hasOwnProperty(n)&&(this[n]=r[n])}},a.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},a.equals=function(r){return this.foreground===r.foreground&&this.underline===r.underline&&this.italics===r.italics&&this.background===r.background&&this.flash===r.flash},a.copy=function(r){this.foreground=r.foreground,this.underline=r.underline,this.italics=r.italics,this.background=r.background,this.flash=r.flash},a.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},o}(),sn=function(){function o(i,r,e,t,n,s){this.uchar=void 0,this.penState=void 0,this.uchar=i||" ",this.penState=new Vr(r,e,t,n,s)}var a=o.prototype;return a.reset=function(){this.uchar=" ",this.penState.reset()},a.setChar=function(r,e){this.uchar=r,this.penState.copy(e)},a.setPenState=function(r){this.penState.copy(r)},a.equals=function(r){return this.uchar===r.uchar&&this.penState.equals(r.penState)},a.copy=function(r){this.uchar=r.uchar,this.penState.copy(r.penState)},a.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},o}(),on=function(){function o(i){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var r=0;r<Rt;r++)this.chars.push(new sn);this.logger=i,this.pos=0,this.currPenState=new Vr}var a=o.prototype;return a.equals=function(r){for(var e=!0,t=0;t<Rt;t++)if(!this.chars[t].equals(r.chars[t])){e=!1;break}return e},a.copy=function(r){for(var e=0;e<Rt;e++)this.chars[e].copy(r.chars[e])},a.isEmpty=function(){for(var r=!0,e=0;e<Rt;e++)if(!this.chars[e].isEmpty()){r=!1;break}return r},a.setCursor=function(r){this.pos!==r&&(this.pos=r),this.pos<0?(this.logger.log(Se.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>Rt&&(this.logger.log(Se.DEBUG,"Too large cursor position "+this.pos),this.pos=Rt)},a.moveCursor=function(r){var e=this.pos+r;if(r>1)for(var t=this.pos+1;t<e+1;t++)this.chars[t].setPenState(this.currPenState);this.setCursor(e)},a.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},a.insertChar=function(r){r>=144&&this.backSpace();var e=Wr(r);if(this.pos>=Rt){this.logger.log(Se.ERROR,"Cannot insert "+r.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1)},a.clearFromPos=function(r){var e;for(e=r;e<Rt;e++)this.chars[e].reset()},a.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},a.clearToEndOfRow=function(){this.clearFromPos(this.pos)},a.getTextString=function(){for(var r=[],e=!0,t=0;t<Rt;t++){var n=this.chars[t].uchar;n!==" "&&(e=!1),r.push(n)}return e?"":r.join("")},a.setPenStyles=function(r){this.currPenState.setStyles(r);var e=this.chars[this.pos];e.setPenState(this.currPenState)},o}(),xr=function(){function o(i){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var r=0;r<Et;r++)this.rows.push(new on(i));this.logger=i,this.currRow=Et-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var a=o.prototype;return a.reset=function(){for(var r=0;r<Et;r++)this.rows[r].clear();this.currRow=Et-1},a.equals=function(r){for(var e=!0,t=0;t<Et;t++)if(!this.rows[t].equals(r.rows[t])){e=!1;break}return e},a.copy=function(r){for(var e=0;e<Et;e++)this.rows[e].copy(r.rows[e])},a.isEmpty=function(){for(var r=!0,e=0;e<Et;e++)if(!this.rows[e].isEmpty()){r=!1;break}return r},a.backSpace=function(){var r=this.rows[this.currRow];r.backSpace()},a.clearToEndOfRow=function(){var r=this.rows[this.currRow];r.clearToEndOfRow()},a.insertChar=function(r){var e=this.rows[this.currRow];e.insertChar(r)},a.setPen=function(r){var e=this.rows[this.currRow];e.setPenStyles(r)},a.moveCursor=function(r){var e=this.rows[this.currRow];e.moveCursor(r)},a.setCursor=function(r){this.logger.log(Se.INFO,"setCursor: "+r);var e=this.rows[this.currRow];e.setCursor(r)},a.setPAC=function(r){this.logger.log(Se.INFO,"pacData = "+JSON.stringify(r));var e=r.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var t=0;t<Et;t++)this.rows[t].clear();var n=this.currRow+1-this.nrRollUpRows,s=this.lastOutputScreen;if(s){var l=s.rows[n].cueStartTime,u=this.logger.time;if(l&&u!==null&&l<u)for(var c=0;c<this.nrRollUpRows;c++)this.rows[e-this.nrRollUpRows+c+1].copy(s.rows[n+c])}}this.currRow=e;var v=this.rows[this.currRow];if(r.indent!==null){var p=r.indent,R=Math.max(p-1,0);v.setCursor(r.indent),r.color=v.chars[R].penState.foreground}var P={foreground:r.color,underline:r.underline,italics:r.italics,background:"black",flash:!1};this.setPen(P)},a.setBkgData=function(r){this.logger.log(Se.INFO,"bkgData = "+JSON.stringify(r)),this.backSpace(),this.setPen(r),this.insertChar(32)},a.setRollUpRows=function(r){this.nrRollUpRows=r},a.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(Se.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(Se.TEXT,this.getDisplayText());var r=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(r,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),this.logger.log(Se.INFO,"Rolling up")},a.getDisplayText=function(r){r=r||!1;for(var e=[],t="",n=-1,s=0;s<Et;s++){var l=this.rows[s].getTextString();l&&(n=s+1,r?e.push("Row "+n+": '"+l+"'"):e.push(l.trim()))}return e.length>0&&(r?t="["+e.join(" | ")+"]":t=e.join(`
`)),t},a.getTextAndFormat=function(){return this.rows},o}(),Yr=function(){function o(i,r,e){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=i,this.outputFilter=r,this.mode=null,this.verbose=0,this.displayedMemory=new xr(e),this.nonDisplayedMemory=new xr(e),this.lastOutputScreen=new xr(e),this.currRollUpRow=this.displayedMemory.rows[Et-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=e}var a=o.prototype;return a.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Et-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},a.getHandler=function(){return this.outputFilter},a.setHandler=function(r){this.outputFilter=r},a.setPAC=function(r){this.writeScreen.setPAC(r)},a.setBkgData=function(r){this.writeScreen.setBkgData(r)},a.setMode=function(r){r!==this.mode&&(this.mode=r,this.logger.log(Se.INFO,"MODE="+r),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=r)},a.insertChars=function(r){for(var e=0;e<r.length;e++)this.writeScreen.insertChar(r[e]);var t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(Se.INFO,t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(Se.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},a.ccRCL=function(){this.logger.log(Se.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},a.ccBS=function(){this.logger.log(Se.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},a.ccAOF=function(){},a.ccAON=function(){},a.ccDER=function(){this.logger.log(Se.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},a.ccRU=function(r){this.logger.log(Se.INFO,"RU("+r+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(r)},a.ccFON=function(){this.logger.log(Se.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},a.ccRDC=function(){this.logger.log(Se.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},a.ccTR=function(){this.logger.log(Se.INFO,"TR"),this.setMode("MODE_TEXT")},a.ccRTD=function(){this.logger.log(Se.INFO,"RTD"),this.setMode("MODE_TEXT")},a.ccEDM=function(){this.logger.log(Se.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},a.ccCR=function(){this.logger.log(Se.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},a.ccENM=function(){this.logger.log(Se.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},a.ccEOC=function(){if(this.logger.log(Se.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var r=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=r,this.writeScreen=this.nonDisplayedMemory,this.logger.log(Se.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},a.ccTO=function(r){this.logger.log(Se.INFO,"TO("+r+") - Tab Offset"),this.writeScreen.moveCursor(r)},a.ccMIDROW=function(r){var e={flash:!1};if(e.underline=r%2===1,e.italics=r>=46,e.italics)e.foreground="white";else{var t=Math.floor(r/2)-16,n=["white","green","blue","cyan","red","yellow","magenta"];e.foreground=n[t]}this.logger.log(Se.INFO,"MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)},a.outputDataUpdate=function(r){r===void 0&&(r=!1);var e=this.logger.time;e!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=e:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),r&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e),this.lastOutputScreen.copy(this.displayedMemory))},a.cueSplitAtTime=function(r){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,r,this.displayedMemory),this.cueStartTime=r))},o}(),ln=function(){function o(i,r,e){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var t=new an;this.channels=[null,new Yr(i,r,t),new Yr(i+1,e,t)],this.cmdHistory=zr(),this.logger=t}var a=o.prototype;return a.getHandler=function(r){return this.channels[r].getHandler()},a.setHandler=function(r,e){this.channels[r].setHandler(e)},a.addData=function(r,e){var t,n,s,l=!1;this.logger.time=r;for(var u=0;u<e.length;u+=2)if(n=e[u]&127,s=e[u+1]&127,!(n===0&&s===0)){if(this.logger.log(Se.DATA,"["+Ut([e[u],e[u+1]])+"] -> ("+Ut([n,s])+")"),t=this.parseCmd(n,s),t||(t=this.parseMidrow(n,s)),t||(t=this.parsePAC(n,s)),t||(t=this.parseBackgroundAttributes(n,s)),!t&&(l=this.parseChars(n,s),l)){var c=this.currentChannel;if(c&&c>0){var v=this.channels[c];v.insertChars(l)}else this.logger.log(Se.WARNING,"No channel found yet. TEXT-MODE?")}!t&&!l&&this.logger.log(Se.WARNING,"Couldn't parse cleaned data "+Ut([n,s])+" orig: "+Ut([e[u],e[u+1]]))}},a.parseCmd=function(r,e){var t=this.cmdHistory,n=(r===20||r===28||r===21||r===29)&&e>=32&&e<=47,s=(r===23||r===31)&&e>=33&&e<=35;if(!(n||s))return!1;if(Xr(r,e,t))return Kt(null,null,t),this.logger.log(Se.DEBUG,"Repeated command ("+Ut([r,e])+") is dropped"),!0;var l=r===20||r===21||r===23?1:2,u=this.channels[l];return r===20||r===21||r===28||r===29?e===32?u.ccRCL():e===33?u.ccBS():e===34?u.ccAOF():e===35?u.ccAON():e===36?u.ccDER():e===37?u.ccRU(2):e===38?u.ccRU(3):e===39?u.ccRU(4):e===40?u.ccFON():e===41?u.ccRDC():e===42?u.ccTR():e===43?u.ccRTD():e===44?u.ccEDM():e===45?u.ccCR():e===46?u.ccENM():e===47&&u.ccEOC():u.ccTO(e-32),Kt(r,e,t),this.currentChannel=l,!0},a.parseMidrow=function(r,e){var t=0;if((r===17||r===25)&&e>=32&&e<=47){if(r===17?t=1:t=2,t!==this.currentChannel)return this.logger.log(Se.ERROR,"Mismatch channel in midrow parsing"),!1;var n=this.channels[t];return n?(n.ccMIDROW(e),this.logger.log(Se.DEBUG,"MIDROW ("+Ut([r,e])+")"),!0):!1}return!1},a.parsePAC=function(r,e){var t,n=this.cmdHistory,s=(r>=17&&r<=23||r>=25&&r<=31)&&e>=64&&e<=127,l=(r===16||r===24)&&e>=64&&e<=95;if(!(s||l))return!1;if(Xr(r,e,n))return Kt(null,null,n),!0;var u=r<=23?1:2;e>=64&&e<=95?t=u===1?Ji[r]:tn[r]:t=u===1?en[r]:rn[r];var c=this.channels[u];return c?(c.setPAC(this.interpretPAC(t,e)),Kt(r,e,n),this.currentChannel=u,!0):!1},a.interpretPAC=function(r,e){var t=e,n={color:null,italics:!1,indent:null,underline:!1,row:r};return e>95?t=e-96:t=e-64,n.underline=(t&1)===1,t<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(t/2)]:t<=15?(n.italics=!0,n.color="white"):n.indent=Math.floor((t-16)/2)*4,n},a.parseChars=function(r,e){var t,n=null,s=null;if(r>=25?(t=2,s=r-8):(t=1,s=r),s>=17&&s<=19){var l=e;s===17?l=e+80:s===18?l=e+112:l=e+144,this.logger.log(Se.INFO,"Special char '"+Wr(l)+"' in channel "+t),n=[l]}else r>=32&&r<=127&&(n=e===0?[r]:[r,e]);if(n){var u=Ut(n);this.logger.log(Se.DEBUG,"Char codes =  "+u.join(",")),Kt(r,e,this.cmdHistory)}return n},a.parseBackgroundAttributes=function(r,e){var t=(r===16||r===24)&&e>=32&&e<=47,n=(r===23||r===31)&&e>=45&&e<=47;if(!(t||n))return!1;var s,l={};r===16||r===24?(s=Math.floor((e-32)/2),l.background=nn[s],e%2===1&&(l.background=l.background+"_semi")):e===45?l.background="transparent":(l.foreground="black",e===47&&(l.underline=!0));var u=r<=23?1:2,c=this.channels[u];return c.setBkgData(l),Kt(r,e,this.cmdHistory),!0},a.reset=function(){for(var r=0;r<Object.keys(this.channels).length;r++){var e=this.channels[r];e&&e.reset()}this.cmdHistory=zr()},a.cueSplitAtTime=function(r){for(var e=0;e<this.channels.length;e++){var t=this.channels[e];t&&t.cueSplitAtTime(r)}},o}();function Kt(o,a,i){i.a=o,i.b=a}function Xr(o,a,i){return i.a===o&&i.b===a}function zr(){return{a:null,b:null}}var qr=ln,ur=function(){function o(i,r){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=i,this.trackName=r}var a=o.prototype;return a.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},a.newCue=function(r,e,t){(this.startTime===null||this.startTime>r)&&(this.startTime=r),this.endTime=e,this.screen=t,this.timelineController.createCaptionsTrack(this.trackName)},a.reset=function(){this.cueRanges=[]},o}(),yr=function(a,i,r){return a.substr(r||0,i.length)===i},un=function(a){var i=parseInt(a.substr(-3)),r=parseInt(a.substr(-6,2)),e=parseInt(a.substr(-9,2)),t=a.length>9?parseInt(a.substr(0,a.indexOf(":"))):0;if(!Object(q.isFiniteNumber)(i)||!Object(q.isFiniteNumber)(r)||!Object(q.isFiniteNumber)(e)||!Object(q.isFiniteNumber)(t))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+a);return i+=1e3*r,i+=60*1e3*e,i+=60*60*1e3*t,i},Er=function(a){for(var i=5381,r=a.length;r;)i=i*33^a.charCodeAt(--r);return(i>>>0).toString()},fn=function(a,i,r){var e=a[i],t=a[e.prevCC];if(!t||!t.new&&e.new){a.ccOffset=a.presentationOffset=e.start,e.new=!1;return}for(;t&&t.new;)a.ccOffset+=e.start-t.start,e.new=!1,e=t,t=a[e.prevCC];a.presentationOffset=r},dn={parse:function(a,i,r,e,t,n){var s=/\r\n|\n\r|\n|\r/g,l=Object($t.utf8ArrayToStr)(new Uint8Array(a)).trim().replace(s,`
`).split(`
`),u="00:00.000",c=0,v=0,p=0,R=[],P,z=!0,re=!1,de=new Qi;de.oncue=function(le){var ge=r[e],ve=r.ccOffset;ge&&ge.new&&(v!==void 0?ve=r.ccOffset=ge.start:fn(r,e,p)),p&&(ve=p-r.presentationOffset),re&&(le.startTime+=ve-v,le.endTime+=ve-v),le.id=Er(le.startTime.toString())+Er(le.endTime.toString())+Er(le.text),le.text=decodeURIComponent(encodeURIComponent(le.text)),le.endTime>0&&R.push(le)},de.onparsingerror=function(le){P=le},de.onflush=function(){if(P&&n){n(P);return}t(R)},l.forEach(function(le){if(z)if(yr(le,"X-TIMESTAMP-MAP=")){z=!1,re=!0,le.substr(16).split(",").forEach(function(ge){yr(ge,"LOCAL:")?u=ge.substr(6):yr(ge,"MPEGTS:")&&(c=parseInt(ge.substr(7)))});try{i+(r[e].start*9e4||0)<0&&(i+=8589934592),c-=i,v=un(u)/1e3,p=c/9e4}catch(ge){re=!1,P=ge}return}else le===""&&(z=!1);de.parse(le+`
`)}),de.flush()}},cn=dn;function fr(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function hn(o,a){o.prototype=Object.create(a.prototype),o.prototype.constructor=o,o.__proto__=a}var gn=function(o){hn(a,o);function a(r){var e;if(e=o.call(this,r,d.default.MEDIA_ATTACHING,d.default.MEDIA_DETACHING,d.default.FRAG_PARSING_USERDATA,d.default.FRAG_DECRYPTED,d.default.MANIFEST_LOADING,d.default.MANIFEST_LOADED,d.default.FRAG_LOADED,d.default.INIT_PTS_FOUND)||this,e.media=null,e.config=void 0,e.enabled=!0,e.Cues=void 0,e.textTracks=[],e.tracks=[],e.initPTS=[],e.unparsedVttFrags=[],e.captionsTracks={},e.nonNativeCaptionsTracks={},e.captionsProperties=void 0,e.cea608Parser1=void 0,e.cea608Parser2=void 0,e.lastSn=-1,e.prevCC=-1,e.vttCCs=$r(),e.hls=r,e.config=r.config,e.Cues=r.config.cueHandler,e.captionsProperties={textTrack1:{label:e.config.captionsTextTrack1Label,languageCode:e.config.captionsTextTrack1LanguageCode},textTrack2:{label:e.config.captionsTextTrack2Label,languageCode:e.config.captionsTextTrack2LanguageCode},textTrack3:{label:e.config.captionsTextTrack3Label,languageCode:e.config.captionsTextTrack3LanguageCode},textTrack4:{label:e.config.captionsTextTrack4Label,languageCode:e.config.captionsTextTrack4LanguageCode}},e.config.enableCEA708Captions){var t=new ur(fr(e),"textTrack1"),n=new ur(fr(e),"textTrack2"),s=new ur(fr(e),"textTrack3"),l=new ur(fr(e),"textTrack4");e.cea608Parser1=new qr(1,t,n),e.cea608Parser2=new qr(3,s,l)}return e}var i=a.prototype;return i.addCues=function(e,t,n,s,l){for(var u=!1,c=l.length;c--;){var v=l[c],p=pn(v[0],v[1],t,n);if(p>=0&&(v[0]=Math.min(v[0],t),v[1]=Math.max(v[1],n),u=!0,p/(n-t)>.5))return}if(u||l.push([t,n]),this.config.renderTextTracksNatively)this.Cues.newCue(this.captionsTracks[e],t,n,s);else{var R=this.Cues.newCue(null,t,n,s);this.hls.trigger(d.default.CUES_PARSED,{type:"captions",cues:R,track:e})}},i.onInitPtsFound=function(e){var t=this,n=e.frag,s=e.id,l=e.initPTS,u=this.unparsedVttFrags;s==="main"&&(this.initPTS[n.cc]=l),u.length&&(this.unparsedVttFrags=[],u.forEach(function(c){t.onFragLoaded(c)}))},i.getExistingTrack=function(e){var t=this.media;if(t)for(var n=0;n<t.textTracks.length;n++){var s=t.textTracks[n];if(s[e])return s}return null},i.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},i.createNativeTrack=function(e){if(!this.captionsTracks[e]){var t=this.captionsProperties,n=this.captionsTracks,s=this.media,l=t[e],u=l.label,c=l.languageCode,v=this.getExistingTrack(e);if(v)n[e]=v,Nt(n[e]),Gt(n[e],s);else{var p=this.createTextTrack("captions",u,c);p&&(p[e]=!0,n[e]=p)}}},i.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var t=this.captionsProperties[e];if(t){var n=t.label,s={_id:e,label:n,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(d.default.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}}},i.createTextTrack=function(e,t,n){var s=this.media;if(s)return s.addTextTrack(e,t,n)},i.destroy=function(){o.prototype.destroy.call(this)},i.onMediaAttaching=function(e){this.media=e.media,this._cleanTracks()},i.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(t){Nt(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}},i.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs=$r(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={}},i._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var n=0;n<t.length;n++)Nt(t[n])}},i.onManifestLoaded=function(e){var t=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset()),this.config.enableWebVTT){var n=e.subtitles||[],s=this.tracks&&n&&this.tracks.length===n.length;if(this.tracks=e.subtitles||[],this.config.renderTextTracksNatively){var l=this.media?this.media.textTracks:[];this.tracks.forEach(function(c,v){var p;if(v<l.length){for(var R=null,P=0;P<l.length;P++)if(vn(l[P],c)){R=l[P];break}R&&(p=R)}p||(p=t.createTextTrack("subtitles",c.name,c.lang)),c.default?p.mode=t.hls.subtitleDisplay?"showing":"hidden":p.mode="disabled",t.textTracks.push(p)})}else if(!s&&this.tracks&&this.tracks.length){var u=this.tracks.map(function(c){return{label:c.name,kind:c.type.toLowerCase(),default:c.default,subtitleTrack:c}});this.hls.trigger(d.default.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:u})}}this.config.enableCEA708Captions&&e.captions&&e.captions.forEach(function(c){var v=/(?:CC|SERVICE)([1-4])/.exec(c.instreamId);if(v){var p="textTrack"+v[1],R=t.captionsProperties[p];R&&(R.label=c.name,c.lang&&(R.languageCode=c.lang),R.media=c)}})},i.onFragLoaded=function(e){var t=e.frag,n=e.payload,s=this.cea608Parser1,l=this.cea608Parser2,u=this.initPTS,c=this.lastSn,v=this.unparsedVttFrags;if(t.type==="main"){var p=t.sn;t.sn!==c+1&&s&&l&&(s.reset(),l.reset()),this.lastSn=p}else if(t.type==="subtitle")if(n.byteLength){if(!Object(q.isFiniteNumber)(u[t.cc])){v.push(e),u.length&&this.hls.trigger(d.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t});return}var R=t.decryptdata;(R==null||R.key==null||R.method!=="AES-128")&&this._parseVTTs(t,n)}else this.hls.trigger(d.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})},i._parseVTTs=function(e,t){var n=this,s=this.hls,l=this.prevCC,u=this.textTracks,c=this.vttCCs;c[e.cc]||(c[e.cc]={start:e.start,prevCC:l,new:!0},this.prevCC=e.cc),cn.parse(t,this.initPTS[e.cc],c,e.cc,function(v){if(n.config.renderTextTracksNatively){var p=u[e.level];if(p.mode==="disabled"){s.trigger(d.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e});return}v.forEach(function(P){if(!p.cues.getCueById(P.id))try{if(p.addCue(P),!p.cues.getCueById(P.id))throw new Error("addCue is failed for: "+P)}catch(re){h.logger.debug("Failed occurred on adding cues: "+re);var z=new window.TextTrackCue(P.startTime,P.endTime,P.text);z.id=P.id,p.addCue(z)}})}else{var R=n.tracks[e.level].default?"default":"subtitles"+e.level;s.trigger(d.default.CUES_PARSED,{type:"subtitles",cues:v,track:R})}s.trigger(d.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(v){h.logger.log("Failed to parse VTT cue: "+v),s.trigger(d.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})})},i.onFragDecrypted=function(e){var t=e.frag,n=e.payload;if(t.type==="subtitle"){if(!Object(q.isFiniteNumber)(this.initPTS[t.cc])){this.unparsedVttFrags.push(e);return}this._parseVTTs(t,n)}},i.onFragParsingUserdata=function(e){var t=this.cea608Parser1,n=this.cea608Parser2;if(!(!this.enabled||!(t&&n)))for(var s=0;s<e.samples.length;s++){var l=e.samples[s].bytes;if(l){var u=this.extractCea608Data(l);t.addData(e.samples[s].pts,u[0]),n.addData(e.samples[s].pts,u[1])}}},i.extractCea608Data=function(e){for(var t=e[0]&31,n=2,s=[[],[]],l=0;l<t;l++){var u=e[n++],c=127&e[n++],v=127&e[n++],p=(4&u)!==0,R=3&u;c===0&&v===0||p&&(R===0||R===1)&&(s[R].push(c),s[R].push(v))}return s},a}(S);function vn(o,a){return o&&o.label===a.name&&!(o.textTrack1||o.textTrack2)}function pn(o,a,i,r){return Math.min(a,r)-Math.max(o,i)}function $r(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}}}var mn=gn;function Qr(o,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function xn(o,a,i){return a&&Qr(o.prototype,a),i&&Qr(o,i),o}function yn(o,a){o.prototype=Object.create(a.prototype),o.prototype.constructor=o,o.__proto__=a}var En=function(o){yn(a,o);function a(r){var e;return e=o.call(this,r,d.default.MEDIA_ATTACHED,d.default.MEDIA_DETACHING,d.default.MANIFEST_LOADED,d.default.SUBTITLE_TRACK_LOADED)||this,e.tracks=[],e.trackId=-1,e.media=null,e.stopped=!0,e.subtitleDisplay=!0,e.queuedDefaultTrack=null,e}var i=a.prototype;return i.destroy=function(){S.prototype.destroy.call(this)},i.onMediaAttached=function(e){var t=this;this.media=e.media,this.media&&(Object(q.isFiniteNumber)(this.queuedDefaultTrack)&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=null),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){t.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},i.onMediaDetaching=function(){if(this.media){this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),Object(q.isFiniteNumber)(this.subtitleTrack)&&(this.queuedDefaultTrack=this.subtitleTrack);var e=Tr(this.media.textTracks);e.forEach(function(t){Nt(t)}),this.subtitleTrack=-1,this.media=null}},i.onManifestLoaded=function(e){var t=this,n=e.subtitles||[];this.tracks=n,this.hls.trigger(d.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:n}),n.forEach(function(s){s.default&&(t.media?t.subtitleTrack=s.id:t.queuedDefaultTrack=s.id)})},i.onSubtitleTrackLoaded=function(e){var t=this,n=e.id,s=e.details,l=this.trackId,u=this.tracks,c=u[l];if(n>=u.length||n!==l||!c||this.stopped){this._clearReloadTimer();return}if(h.logger.log("subtitle track "+n+" loaded"),s.live){var v=xe(c.details,s,e.stats.trequest);h.logger.log("Reloading live subtitle playlist in "+v+"ms"),this.timer=setTimeout(function(){t._loadCurrentTrack()},v)}else this._clearReloadTimer()},i.startLoad=function(){this.stopped=!1,this._loadCurrentTrack()},i.stopLoad=function(){this.stopped=!0,this._clearReloadTimer()},i._clearReloadTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},i._loadCurrentTrack=function(){var e=this.trackId,t=this.tracks,n=this.hls,s=t[e];e<0||!s||s.details&&!s.details.live||(h.logger.log("Loading subtitle track "+e),n.trigger(d.default.SUBTITLE_TRACK_LOADING,{url:s.url,id:e}))},i._toggleTrackModes=function(e){var t=this.media,n=this.subtitleDisplay,s=this.trackId;if(t){var l=Tr(t.textTracks);if(e===-1)[].slice.call(l).forEach(function(v){v.mode="disabled"});else{var u=l[s];u&&(u.mode="disabled")}var c=l[e];c&&(c.mode=n?"showing":"hidden")}},i._setSubtitleTrackInternal=function(e){var t=this.hls,n=this.tracks;!Object(q.isFiniteNumber)(e)||e<-1||e>=n.length||(this.trackId=e,h.logger.log("Switching to subtitle track "+e),t.trigger(d.default.SUBTITLE_TRACK_SWITCH,{id:e}),this._loadCurrentTrack())},i._onTextTracksChanged=function(){if(!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var e=-1,t=Tr(this.media.textTracks),n=0;n<t.length;n++)if(t[n].mode==="hidden")e=n;else if(t[n].mode==="showing"){e=n;break}this.subtitleTrack=e}},xn(a,[{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.trackId!==e&&(this._toggleTrackModes(e),this._setSubtitleTrackInternal(e))}}]),a}(S);function Tr(o){for(var a=[],i=0;i<o.length;i++){var r=o[i];r.kind==="subtitles"&&r.label&&a.push(o[i])}return a}var Tn=En,Sn=L("./src/crypt/decrypter.js");function _n(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function An(o,a){o.prototype=Object.create(a.prototype),o.prototype.constructor=o,o.__proto__=a}var bn=window,Zr=bn.performance,Sr=500,Rn=function(o){An(a,o);function a(r,e){var t;return t=o.call(this,r,d.default.MEDIA_ATTACHED,d.default.MEDIA_DETACHING,d.default.ERROR,d.default.KEY_LOADED,d.default.FRAG_LOADED,d.default.SUBTITLE_TRACKS_UPDATED,d.default.SUBTITLE_TRACK_SWITCH,d.default.SUBTITLE_TRACK_LOADED,d.default.SUBTITLE_FRAG_PROCESSED,d.default.LEVEL_UPDATED)||this,t.fragmentTracker=e,t.config=r.config,t.state=B.STOPPED,t.tracks=[],t.tracksBuffered=[],t.currentTrackId=-1,t.decrypter=new Sn.default(r,r.config),t.lastAVStart=0,t._onMediaSeeking=t.onMediaSeeking.bind(_n(t)),t}var i=a.prototype;return i.startLoad=function(){this.stopLoad(),this.state=B.IDLE;var e=this.tracks[this.currentTrackId];e&&e.details&&(this.setInterval(Sr),this.tick())},i.onSubtitleFragProcessed=function(e){var t=e.frag,n=e.success;if(this.fragPrevious=t,this.state=B.IDLE,!!n){var s=this.tracksBuffered[this.currentTrackId];if(s){for(var l,u=t.start,c=0;c<s.length;c++)if(u>=s[c].start&&u<=s[c].end){l=s[c];break}var v=t.start+t.duration;l?l.end=v:(l={start:u,end:v},s.push(l))}}},i.onMediaAttached=function(e){var t=e.media;this.media=t,t.addEventListener("seeking",this._onMediaSeeking),this.state=B.IDLE},i.onMediaDetaching=function(){var e=this;this.media&&(this.media.removeEventListener("seeking",this._onMediaSeeking),this.fragmentTracker.removeAllFragments(),this.currentTrackId=-1,this.tracks.forEach(function(t){e.tracksBuffered[t.id]=[]}),this.media=null,this.state=B.STOPPED)},i.onError=function(e){var t=e.frag;!t||t.type!=="subtitle"||(this.fragCurrent&&this.fragCurrent.loader&&this.fragCurrent.loader.abort(),this.state=B.IDLE)},i.onSubtitleTracksUpdated=function(e){var t=this;h.logger.log("subtitle tracks updated"),this.tracksBuffered=[],this.tracks=e.subtitleTracks,this.tracks.forEach(function(n){t.tracksBuffered[n.id]=[]})},i.onSubtitleTrackSwitch=function(e){if(this.currentTrackId=e.id,!this.tracks||!this.tracks.length||this.currentTrackId===-1){this.clearInterval();return}var t=this.tracks[this.currentTrackId];t&&t.details&&this.setInterval(Sr)},i.onSubtitleTrackLoaded=function(e){var t=e.id,n=e.details,s=this.currentTrackId,l=this.tracks,u=l[s];t>=l.length||t!==s||!u||(n.live&&fe(u.details,n,this.lastAVStart),u.details=n,this.setInterval(Sr))},i.onKeyLoaded=function(){this.state===B.KEY_LOADING&&(this.state=B.IDLE)},i.onFragLoaded=function(e){var t=this.fragCurrent,n=e.frag.decryptdata,s=e.frag,l=this.hls;if(this.state===B.FRAG_LOADING&&t&&e.frag.type==="subtitle"&&t.sn===e.frag.sn&&e.payload.byteLength>0&&n&&n.key&&n.method==="AES-128"){var u=Zr.now();this.decrypter.decrypt(e.payload,n.key.buffer,n.iv.buffer,function(c){var v=Zr.now();l.trigger(d.default.FRAG_DECRYPTED,{frag:s,payload:c,stats:{tstart:u,tdecrypt:v}})})}},i.onLevelUpdated=function(e){var t=e.details,n=t.fragments;this.lastAVStart=n.length?n[0].start:0},i.doTick=function(){if(!this.media){this.state=B.IDLE;return}switch(this.state){case B.IDLE:{var e=this.config,t=this.currentTrackId,n=this.fragmentTracker,s=this.media,l=this.tracks;if(!l||!l[t]||!l[t].details)break;var u=e.maxBufferHole,c=e.maxFragLookUpTolerance,v=Math.min(e.maxBufferLength,e.maxMaxBufferLength),p=x.bufferedInfo(this._getBuffered(),s.currentTime,u),R=p.end,P=p.len,z=l[t].details,re=z.fragments,de=re.length,le=re[de-1].start+re[de-1].duration;if(P>v)return;var ge,ve=this.fragPrevious;R<le?(ve&&z.hasProgramDateTime&&(ge=ot(re,ve.endProgramDateTime,c)),ge||(ge=Xe(ve,re,R,c))):ge=re[de-1],ge&&ge.encrypted?(h.logger.log("Loading key for "+ge.sn),this.state=B.KEY_LOADING,this.hls.trigger(d.default.KEY_LOADING,{frag:ge})):ge&&n.getState(ge)===He.NOT_LOADED&&(this.fragCurrent=ge,this.state=B.FRAG_LOADING,this.hls.trigger(d.default.FRAG_LOADING,{frag:ge}))}}},i.stopLoad=function(){this.lastAVStart=0,this.fragPrevious=null,o.prototype.stopLoad.call(this)},i._getBuffered=function(){return this.tracksBuffered[this.currentTrackId]||[]},i.onMediaSeeking=function(){if(this.fragCurrent){var e=this.media?this.media.currentTime:0,t=this.config.maxFragLookUpTolerance,n=this.fragCurrent.start-t,s=this.fragCurrent.start+this.fragCurrent.duration+t;(e<n||e>s)&&(this.fragCurrent.loader&&this.fragCurrent.loader.abort(),this.fragmentTracker.removeFragment(this.fragCurrent),this.fragCurrent=null,this.fragPrevious=null,this.state=B.IDLE,this.tick())}},a}(lt),Ht;(function(o){o.WIDEVINE="com.widevine.alpha",o.PLAYREADY="com.microsoft.playready"})(Ht||(Ht={}));var Ln=function(){return typeof window<"u"&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null}();function Jr(o,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function wn(o,a,i){return a&&Jr(o.prototype,a),i&&Jr(o,i),o}function Dn(o,a){o.prototype=Object.create(a.prototype),o.prototype.constructor=o,o.__proto__=a}var ei=3,In=function(a,i,r){var e={audioCapabilities:[],videoCapabilities:[]};return a.forEach(function(t){e.audioCapabilities.push({contentType:'audio/mp4; codecs="'+t+'"',robustness:r.audioRobustness||""})}),i.forEach(function(t){e.videoCapabilities.push({contentType:'video/mp4; codecs="'+t+'"',robustness:r.videoRobustness||""})}),[e]},On=function(a,i,r,e){switch(a){case Ht.WIDEVINE:return In(i,r,e);default:throw new Error("Unknown key-system: "+a)}},Fn=function(o){Dn(a,o);function a(r){var e;return e=o.call(this,r,d.default.MEDIA_ATTACHED,d.default.MEDIA_DETACHED,d.default.MANIFEST_PARSED)||this,e._widevineLicenseUrl=void 0,e._licenseXhrSetup=void 0,e._emeEnabled=void 0,e._requestMediaKeySystemAccess=void 0,e._drmSystemOptions=void 0,e._config=void 0,e._mediaKeysList=[],e._media=null,e._hasSetMediaKeys=!1,e._requestLicenseFailureCount=0,e.mediaKeysPromise=null,e._onMediaEncrypted=function(t){if(h.logger.log('Media is encrypted using "'+t.initDataType+'" init data type'),!e.mediaKeysPromise){h.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),e.hls.trigger(d.default.ERROR,{type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var n=function(l){e._media&&(e._attemptSetMediaKeys(l),e._generateRequestWithPreferredKeySession(t.initDataType,t.initData))};e.mediaKeysPromise.then(n).catch(n)},e._config=r.config,e._widevineLicenseUrl=e._config.widevineLicenseUrl,e._licenseXhrSetup=e._config.licenseXhrSetup,e._emeEnabled=e._config.emeEnabled,e._requestMediaKeySystemAccess=e._config.requestMediaKeySystemAccessFunc,e._drmSystemOptions=r.config.drmSystemOptions,e}var i=a.prototype;return i.getLicenseServerUrl=function(e){switch(e){case Ht.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+e+'"')},i._attemptKeySystemAccess=function(e,t,n){var s=this,l=On(e,t,n,this._drmSystemOptions);h.logger.log("Requesting encrypted media key-system access");var u=this.requestMediaKeySystemAccess(e,l);this.mediaKeysPromise=u.then(function(c){return s._onMediaKeySystemAccessObtained(e,c)}),u.catch(function(c){h.logger.error('Failed to obtain key-system "'+e+'" access:',c)})},i._onMediaKeySystemAccessObtained=function(e,t){var n=this;h.logger.log('Access for key-system "'+e+'" obtained');var s={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:e};this._mediaKeysList.push(s);var l=Promise.resolve().then(function(){return t.createMediaKeys()}).then(function(u){return s.mediaKeys=u,h.logger.log('Media-keys created for key-system "'+e+'"'),n._onMediaKeysCreated(),u});return l.catch(function(u){h.logger.error("Failed to create media-keys:",u)}),l},i._onMediaKeysCreated=function(){var e=this;this._mediaKeysList.forEach(function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),e._onNewMediaKeySession(t.mediaKeysSession))})},i._onNewMediaKeySession=function(e){var t=this;h.logger.log("New key-system session "+e.sessionId),e.addEventListener("message",function(n){t._onKeySessionMessage(e,n.message)},!1)},i._onKeySessionMessage=function(e,t){h.logger.log("Got EME message event, creating license request"),this._requestLicense(t,function(n){h.logger.log("Received license data (length: "+(n&&n.byteLength)+"), updating key-session"),e.update(n)})},i._attemptSetMediaKeys=function(e){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var t=this._mediaKeysList[0];if(!t||!t.mediaKeys){h.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(d.default.ERROR,{type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}h.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(t.mediaKeys),this._hasSetMediaKeys=!0}},i._generateRequestWithPreferredKeySession=function(e,t){var n=this,s=this._mediaKeysList[0];if(!s){h.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(d.default.ERROR,{type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(s.mediaKeysSessionInitialized){h.logger.warn("Key-Session already initialized but requested again");return}var l=s.mediaKeysSession;if(!l){h.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(d.default.ERROR,{type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!t){h.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(d.default.ERROR,{type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}h.logger.log('Generating key-session request for "'+e+'" init data type'),s.mediaKeysSessionInitialized=!0,l.generateRequest(e,t).then(function(){h.logger.debug("Key-session generation succeeded")}).catch(function(u){h.logger.error("Error generating key-session request:",u),n.hls.trigger(d.default.ERROR,{type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},i._createLicenseXhr=function(e,t,n){var s=new XMLHttpRequest,l=this._licenseXhrSetup;try{if(l)try{l(s,e)}catch{s.open("POST",e,!0),l(s,e)}s.readyState||s.open("POST",e,!0)}catch(u){throw new Error("issue setting up KeySystem license XHR "+u)}return s.responseType="arraybuffer",s.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,s,e,t,n),s},i._onLicenseRequestReadyStageChange=function(e,t,n,s){switch(e.readyState){case 4:if(e.status===200)this._requestLicenseFailureCount=0,h.logger.log("License request succeeded"),e.responseType!=="arraybuffer"&&h.logger.warn("xhr response type was not set to the expected arraybuffer for license request"),s(e.response);else{if(h.logger.error("License Request XHR failed ("+t+"). Status: "+e.status+" ("+e.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>ei){this.hls.trigger(d.default.ERROR,{type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var l=ei-this._requestLicenseFailureCount+1;h.logger.warn("Retrying license request, "+l+" attempts left"),this._requestLicense(n,s)}break}},i._generateLicenseRequestChallenge=function(e,t){switch(e.mediaKeySystemDomain){case Ht.WIDEVINE:return t}throw new Error("unsupported key-system: "+e.mediaKeySystemDomain)},i._requestLicense=function(e,t){h.logger.log("Requesting content license for key-system");var n=this._mediaKeysList[0];if(!n){h.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(d.default.ERROR,{type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var s=this.getLicenseServerUrl(n.mediaKeySystemDomain),l=this._createLicenseXhr(s,e,t);h.logger.log("Sending license request to URL: "+s);var u=this._generateLicenseRequestChallenge(n,e);l.send(u)}catch(c){h.logger.error("Failure requesting DRM license: "+c),this.hls.trigger(d.default.ERROR,{type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},i.onMediaAttached=function(e){if(this._emeEnabled){var t=e.media;this._media=t,t.addEventListener("encrypted",this._onMediaEncrypted)}},i.onMediaDetached=function(){var e=this._media,t=this._mediaKeysList;e&&(e.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(t.map(function(n){if(n.mediaKeysSession)return n.mediaKeysSession.close().catch(function(){})})).then(function(){return e.setMediaKeys(null)}).catch(function(){}))},i.onManifestParsed=function(e){if(this._emeEnabled){var t=e.levels.map(function(s){return s.audioCodec}),n=e.levels.map(function(s){return s.videoCodec});this._attemptKeySystemAccess(Ht.WIDEVINE,t,n)}},wn(a,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),a}(S),Cn=Fn;function ti(o,a){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(o);a&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable})),i.push.apply(i,r)}return i}function ri(o){for(var a=1;a<arguments.length;a++){var i=arguments[a]!=null?arguments[a]:{};a%2?ti(Object(i),!0).forEach(function(r){kn(o,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):ti(Object(i)).forEach(function(r){Object.defineProperty(o,r,Object.getOwnPropertyDescriptor(i,r))})}return o}function kn(o,a,i){return a in o?Object.defineProperty(o,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[a]=i,o}var Pn=ri(ri({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:60*1e3*1e3,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Ui,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:Ai,bufferController:Li,capLevelController:Oi,fpsController:Mi,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:Ln,testBandwidth:!0},Mn()),{},{subtitleStreamController:Rn,subtitleTrackController:Tn,timelineController:mn,audioStreamController:Xi,audioTrackController:Ki,emeController:Cn});function Mn(){return{cueHandler:F,enableCEA708Captions:!0,enableWebVTT:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function ii(o,a){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(o);a&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable})),i.push.apply(i,r)}return i}function ni(o){for(var a=1;a<arguments.length;a++){var i=arguments[a]!=null?arguments[a]:{};a%2?ii(Object(i),!0).forEach(function(r){Nn(o,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):ii(Object(i)).forEach(function(r){Object.defineProperty(o,r,Object.getOwnPropertyDescriptor(i,r))})}return o}function Nn(o,a,i){return a in o?Object.defineProperty(o,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[a]=i,o}function Ze(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function ai(o,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function si(o,a,i){return a&&ai(o.prototype,a),i&&ai(o,i),o}function Un(o,a){o.prototype=Object.create(a.prototype),o.prototype.constructor=o,o.__proto__=a}var oi=function(o){Un(a,o),a.isSupported=function(){return pr()},si(a,null,[{key:"version",get:function(){return"0.14.17"}},{key:"Events",get:function(){return d.default}},{key:"ErrorTypes",get:function(){return A.ErrorTypes}},{key:"ErrorDetails",get:function(){return A.ErrorDetails}},{key:"DefaultConfig",get:function(){return a.defaultConfig?a.defaultConfig:Pn},set:function(e){a.defaultConfig=e}}]);function a(r){var e;r===void 0&&(r={}),e=o.call(this)||this,e.config=void 0,e._autoLevelCapping=void 0,e.abrController=void 0,e.capLevelController=void 0,e.levelController=void 0,e.streamController=void 0,e.networkControllers=void 0,e.audioTrackController=void 0,e.subtitleTrackController=void 0,e.emeController=void 0,e.coreComponents=void 0,e.media=null,e.url=null;var t=a.DefaultConfig;if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");e.config=ni(ni({},t),r);var n=Ze(e),s=n.config;if(s.liveMaxLatencyDurationCount!==void 0&&s.liveMaxLatencyDurationCount<=s.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(s.liveMaxLatencyDuration!==void 0&&(s.liveSyncDuration===void 0||s.liveMaxLatencyDuration<=s.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(h.enableLogs)(s.debug),e._autoLevelCapping=-1;var l=e.abrController=new s.abrController(Ze(e)),u=new s.bufferController(Ze(e)),c=e.capLevelController=new s.capLevelController(Ze(e)),v=new s.fpsController(Ze(e)),p=new nt(Ze(e)),R=new qe(Ze(e)),P=new Tt(Ze(e)),z=new vr(Ze(e)),re=e.levelController=new gr(Ze(e)),de=new Bt(Ze(e)),le=e.streamController=new ir(Ze(e),de),ge=[re,le],ve=s.audioStreamController;ve&&ge.push(new ve(Ze(e),de)),e.networkControllers=ge;var _e=[p,R,P,l,u,c,v,z,de];if(ve=s.audioTrackController,ve){var We=new ve(Ze(e));e.audioTrackController=We,_e.push(We)}if(ve=s.subtitleTrackController,ve){var ct=new ve(Ze(e));e.subtitleTrackController=ct,ge.push(ct)}if(ve=s.emeController,ve){var it=new ve(Ze(e));e.emeController=it,_e.push(it)}return ve=s.subtitleStreamController,ve&&ge.push(new ve(Ze(e),de)),ve=s.timelineController,ve&&_e.push(new ve(Ze(e))),e.coreComponents=_e,e}var i=a.prototype;return i.destroy=function(){h.logger.log("destroy"),this.trigger(d.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(e){e.destroy()}),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1},i.attachMedia=function(e){h.logger.log("attachMedia"),this.media=e,this.trigger(d.default.MEDIA_ATTACHING,{media:e})},i.detachMedia=function(){h.logger.log("detachMedia"),this.trigger(d.default.MEDIA_DETACHING),this.media=null},i.loadSource=function(e){e=G.buildAbsoluteURL(window.location.href,e,{alwaysNormalize:!0}),h.logger.log("loadSource:"+e),this.url=e,this.trigger(d.default.MANIFEST_LOADING,{url:e})},i.startLoad=function(e){e===void 0&&(e=-1),h.logger.log("startLoad("+e+")"),this.networkControllers.forEach(function(t){t.startLoad(e)})},i.stopLoad=function(){h.logger.log("stopLoad"),this.networkControllers.forEach(function(e){e.stopLoad()})},i.swapAudioCodec=function(){h.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},i.recoverMediaError=function(){h.logger.log("recoverMediaError");var e=this.media;this.detachMedia(),e&&this.attachMedia(e)},i.removeLevel=function(e,t){t===void 0&&(t=0),this.levelController.removeLevel(e,t)},si(a,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){h.logger.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){h.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){h.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){h.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){h.logger.log("set startLevel:"+e),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",set:function(e){var t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){h.logger.log("set autoLevelCapping:"+e),this._autoLevelCapping=e}},{key:"bandwidthEstimate",get:function(){var e=this.abrController._bwEstimator;return e?e.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var e=this.levels,t=this.config.minAutoBitrate,n=e?e.length:0,s=0;s<n;s++){var l=e[s].realBitrate?Math.max(e[s].realBitrate,e[s].bitrate):e[s].bitrate;if(l>t)return s}return 0}},{key:"maxAutoLevel",get:function(){var e=this.levels,t=this.autoLevelCapping,n;return t===-1&&e&&e.length?n=e.length-1:n=t,n}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return e?e.subtitleDisplay:!1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}}]),a}(M);oi.defaultConfig=void 0},"./src/polyfills/number.js":function(C,O,L){L.r(O),L.d(O,"isFiniteNumber",function(){return F}),L.d(O,"MAX_SAFE_INTEGER",function(){return G});var F=Number.isFinite||function(A){return typeof A=="number"&&isFinite(A)},G=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/utils/get-self-scope.js":function(C,O,L){L.r(O),L.d(O,"getSelfScope",function(){return F});function F(){return typeof window>"u"?self:window}},"./src/utils/logger.js":function(C,O,L){L.r(O),L.d(O,"enableLogs",function(){return S}),L.d(O,"logger",function(){return I});var F=L("./src/utils/get-self-scope.js");function G(){}var A={trace:G,debug:G,log:G,warn:G,info:G,error:G},q=A;function d(_,k){return k="["+_+"] > "+k,k}var h=Object(F.getSelfScope)();function X(_){var k=h.console[_];return k?function(){for(var N=arguments.length,U=new Array(N),ee=0;ee<N;ee++)U[ee]=arguments[ee];U[0]&&(U[0]=d(_,U[0])),k.apply(h.console,U)}:G}function E(_){for(var k=arguments.length,N=new Array(k>1?k-1:0),U=1;U<k;U++)N[U-1]=arguments[U];N.forEach(function(ee){q[ee]=_[ee]?_[ee].bind(_):X(ee)})}var S=function(k){if(h.console&&k===!0||typeof k=="object"){E(k,"debug","log","info","warn","error");try{q.log()}catch{q=A}}else q=A},I=q}}).default})})(hi);var ca=hi.exports;const Ft=Hn(ca);var tr=globalThis&&globalThis.__assign||function(){return tr=Object.assign||function(H){for(var Z,C=1,O=arguments.length;C<O;C++){Z=arguments[C];for(var L in Z)Object.prototype.hasOwnProperty.call(Z,L)&&(H[L]=Z[L])}return H},tr.apply(this,arguments)},ha=globalThis&&globalThis.__rest||function(H,Z){var C={};for(var O in H)Object.prototype.hasOwnProperty.call(H,O)&&Z.indexOf(O)<0&&(C[O]=H[O]);if(H!=null&&typeof Object.getOwnPropertySymbols=="function")for(var L=0,O=Object.getOwnPropertySymbols(H);L<O.length;L++)Z.indexOf(O[L])<0&&Object.prototype.propertyIsEnumerable.call(H,O[L])&&(C[O[L]]=H[O[L]]);return C};function ga(H){var Z=H.hlsConfig,C=H.playerRef,O=C===void 0?Dt.createRef():C,L=H.src,F=H.autoPlay,G=ha(H,["hlsConfig","playerRef","src","autoPlay"]);return At.useEffect(function(){var A;function q(){A!=null&&A.destroy();var d=new Ft(tr({enableWorker:!1},Z));O.current!=null&&d.attachMedia(O.current),d.on(Ft.Events.MEDIA_ATTACHED,function(){d.loadSource(L),d.on(Ft.Events.MANIFEST_PARSED,function(){var h;F&&((h=O==null?void 0:O.current)===null||h===void 0||h.play().catch(function(){return console.log("Unable to autoplay prior to user interaction with the dom.")}))})}),d.on(Ft.Events.ERROR,function(h,X){if(X.fatal)switch(X.type){case Ft.ErrorTypes.NETWORK_ERROR:d.startLoad();break;case Ft.ErrorTypes.MEDIA_ERROR:d.recoverMediaError();break;default:q();break}}),A=d}return Ft.isSupported()&&q(),function(){A!=null&&A.destroy()}},[F,Z,O,L]),Ft.isSupported()?Dt.createElement("video",tr({ref:O},G)):Dt.createElement("video",tr({ref:O,src:L,autoPlay:F},G))}var Rr=globalThis&&globalThis.__assign||function(){return Rr=Object.assign||function(H){for(var Z,C=1,O=arguments.length;C<O;C++){Z=arguments[C];for(var L in Z)Object.prototype.hasOwnProperty.call(Z,L)&&(H[L]=Z[L])}return H},Rr.apply(this,arguments)},va=globalThis&&globalThis.__rest||function(H,Z){var C={};for(var O in H)Object.prototype.hasOwnProperty.call(H,O)&&Z.indexOf(O)<0&&(C[O]=H[O]);if(H!=null&&typeof Object.getOwnPropertySymbols=="function")for(var L=0,O=Object.getOwnPropertySymbols(H);L<O.length;L++)Z.indexOf(O[L])<0&&Object.prototype.propertyIsEnumerable.call(H,O[L])&&(C[O[L]]=H[O[L]]);return C};function wr(H){var Z=function(C){var O=C.bgStyle,L=C.borderRadius,F=C.iconFillColor,G=C.round,A=C.size,q=va(C,["bgStyle","borderRadius","iconFillColor","round","size"]);return Dt.createElement("svg",Rr({viewBox:"0 0 64 64",width:A,height:A},q),G?Dt.createElement("circle",{cx:"32",cy:"32",r:"31",fill:H.color,style:O}):Dt.createElement("rect",{width:"64",height:"64",rx:L,ry:L,fill:H.color,style:O}),Dt.createElement("path",{d:H.path,fill:F}))};return Z.defaultProps={bgStyle:{},borderRadius:0,iconFillColor:"white",size:64},Z}function Dr(H){var Z=Object.entries(H).filter(function(C){var O=C[1];return O!=null}).map(function(C){var O=C[0],L=C[1];return"".concat(encodeURIComponent(O),"=").concat(encodeURIComponent(String(L)))});return Z.length>0?"?".concat(Z.join("&")):""}var pa=globalThis&&globalThis.__extends||function(){var H=function(Z,C){return H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(O,L){O.__proto__=L}||function(O,L){for(var F in L)Object.prototype.hasOwnProperty.call(L,F)&&(O[F]=L[F])},H(Z,C)};return function(Z,C){if(typeof C!="function"&&C!==null)throw new TypeError("Class extends value "+String(C)+" is not a constructor or null");H(Z,C);function O(){this.constructor=Z}Z.prototype=C===null?Object.create(C):(O.prototype=C.prototype,new O)}}(),wt=globalThis&&globalThis.__assign||function(){return wt=Object.assign||function(H){for(var Z,C=1,O=arguments.length;C<O;C++){Z=arguments[C];for(var L in Z)Object.prototype.hasOwnProperty.call(Z,L)&&(H[L]=Z[L])}return H},wt.apply(this,arguments)},ma=globalThis&&globalThis.__awaiter||function(H,Z,C,O){function L(F){return F instanceof C?F:new C(function(G){G(F)})}return new(C||(C=Promise))(function(F,G){function A(h){try{d(O.next(h))}catch(X){G(X)}}function q(h){try{d(O.throw(h))}catch(X){G(X)}}function d(h){h.done?F(h.value):L(h.value).then(A,q)}d((O=O.apply(H,Z||[])).next())})},xa=globalThis&&globalThis.__generator||function(H,Z){var C={label:0,sent:function(){if(F[0]&1)throw F[1];return F[1]},trys:[],ops:[]},O,L,F,G;return G={next:A(0),throw:A(1),return:A(2)},typeof Symbol=="function"&&(G[Symbol.iterator]=function(){return this}),G;function A(d){return function(h){return q([d,h])}}function q(d){if(O)throw new TypeError("Generator is already executing.");for(;C;)try{if(O=1,L&&(F=d[0]&2?L.return:d[0]?L.throw||((F=L.return)&&F.call(L),0):L.next)&&!(F=F.call(L,d[1])).done)return F;switch(L=0,F&&(d=[d[0]&2,F.value]),d[0]){case 0:case 1:F=d;break;case 4:return C.label++,{value:d[1],done:!1};case 5:C.label++,L=d[1],d=[0];continue;case 7:d=C.ops.pop(),C.trys.pop();continue;default:if(F=C.trys,!(F=F.length>0&&F[F.length-1])&&(d[0]===6||d[0]===2)){C=0;continue}if(d[0]===3&&(!F||d[1]>F[0]&&d[1]<F[3])){C.label=d[1];break}if(d[0]===6&&C.label<F[1]){C.label=F[1],F=d;break}if(F&&C.label<F[2]){C.label=F[2],C.ops.push(d);break}F[2]&&C.ops.pop(),C.trys.pop();continue}d=Z.call(H,C)}catch(h){d=[6,h],L=0}finally{O=F=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}},gi=globalThis&&globalThis.__rest||function(H,Z){var C={};for(var O in H)Object.prototype.hasOwnProperty.call(H,O)&&Z.indexOf(O)<0&&(C[O]=H[O]);if(H!=null&&typeof Object.getOwnPropertySymbols=="function")for(var L=0,O=Object.getOwnPropertySymbols(H);L<O.length;L++)Z.indexOf(O[L])<0&&Object.prototype.propertyIsEnumerable.call(H,O[L])&&(C[O[L]]=H[O[L]]);return C},ya=function(H){return!!H&&(typeof H=="object"||typeof H=="function")&&typeof H.then=="function"},Ea=function(H,Z){return{left:window.outerWidth/2+(window.screenX||window.screenLeft||0)-H/2,top:window.outerHeight/2+(window.screenY||window.screenTop||0)-Z/2}},Ta=function(H,Z){return{top:(window.screen.height-Z)/2,left:(window.screen.width-H)/2}};function Sa(H,Z,C){var O=Z.height,L=Z.width,F=gi(Z,["height","width"]),G=wt({height:O,width:L,location:"no",toolbar:"no",status:"no",directories:"no",menubar:"no",scrollbars:"yes",resizable:"no",centerscreen:"yes",chrome:"yes"},F),A=window.open(H,"",Object.keys(G).map(function(d){return"".concat(d,"=").concat(G[d])}).join(", "));if(C)var q=window.setInterval(function(){try{(A===null||A.closed)&&(window.clearInterval(q),C(A))}catch(d){console.error(d)}},1e3);return A}var _a=function(H){pa(Z,H);function Z(){var C=H!==null&&H.apply(this,arguments)||this;return C.openShareDialog=function(O){var L=C.props,F=L.onShareWindowClose,G=L.windowHeight,A=G===void 0?400:G,q=L.windowPosition,d=q===void 0?"windowCenter":q,h=L.windowWidth,X=h===void 0?550:h,E=wt({height:A,width:X},d==="windowCenter"?Ea(X,A):Ta(X,A));Sa(O,E,F)},C.handleClick=function(O){return ma(C,void 0,void 0,function(){var L,F,G,A,q,d,h,X,E,S;return xa(this,function(I){switch(I.label){case 0:return L=this.props,F=L.beforeOnClick,G=L.disabled,A=L.networkLink,q=L.onClick,d=L.url,h=L.openShareDialogOnClick,X=L.opts,E=A(d,X),G?[2]:(O.preventDefault(),F?(S=F(),ya(S)?[4,S]:[3,2]):[3,2]);case 1:I.sent(),I.label=2;case 2:return h&&this.openShareDialog(E),q&&q(O,E),[2]}})})},C}return Z.prototype.render=function(){var C=this.props;C.beforeOnClick;var O=C.children,L=C.className,F=C.disabled,G=C.disabledStyle,A=C.forwardedRef;C.networkLink;var q=C.networkName;C.onShareWindowClose,C.openShareDialogOnClick,C.opts;var d=C.resetButtonStyle,h=C.style;C.url,C.windowHeight,C.windowPosition,C.windowWidth;var X=gi(C,["beforeOnClick","children","className","disabled","disabledStyle","forwardedRef","networkLink","networkName","onShareWindowClose","openShareDialogOnClick","opts","resetButtonStyle","style","url","windowHeight","windowPosition","windowWidth"]),E=Wn("react-share__ShareButton",{"react-share__ShareButton--disabled":!!F,disabled:!!F},L),S=wt(wt(d?{backgroundColor:"transparent",border:"none",padding:0,font:"inherit",color:"inherit",cursor:"pointer"}:{},h),F&&G);return Dt.createElement("button",wt({},X,{"aria-label":X["aria-label"]||q,className:E,onClick:this.handleClick,ref:A,style:S}),O)},Z.defaultProps={disabledStyle:{opacity:.6},openShareDialogOnClick:!0,resetButtonStyle:!0},Z}(At.Component);const Aa=_a;var cr=globalThis&&globalThis.__assign||function(){return cr=Object.assign||function(H){for(var Z,C=1,O=arguments.length;C<O;C++){Z=arguments[C];for(var L in Z)Object.prototype.hasOwnProperty.call(Z,L)&&(H[L]=Z[L])}return H},cr.apply(this,arguments)};function Ir(H,Z,C,O){function L(F,G){var A=C(F),q=cr({},F),d=Object.keys(A);return d.forEach(function(h){delete q[h]}),Dt.createElement(Aa,cr({},O,q,{forwardedRef:G,networkName:H,networkLink:Z,opts:C(F)}))}return L.displayName="ShareButton-".concat(H),At.forwardRef(L)}var ba=wr({color:"#3b5998",networkName:"facebook",path:"M34.1,47V33.3h4.6l0.7-5.3h-5.3v-3.4c0-1.5,0.4-2.6,2.6-2.6l2.8,0v-4.8c-0.5-0.1-2.2-0.2-4.1-0.2 c-4.1,0-6.9,2.5-6.9,7V28H24v5.3h4.6V47H34.1z"});const Ra=ba;var La=globalThis&&globalThis.__extends||function(){var H=function(Z,C){return H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(O,L){O.__proto__=L}||function(O,L){for(var F in L)Object.prototype.hasOwnProperty.call(L,F)&&(O[F]=L[F])},H(Z,C)};return function(Z,C){if(typeof C!="function"&&C!==null)throw new TypeError("Class extends value "+String(C)+" is not a constructor or null");H(Z,C);function O(){this.constructor=Z}Z.prototype=C===null?Object.create(C):(O.prototype=C.prototype,new O)}}(),wa=function(H){La(Z,H);function Z(C){var O=H.call(this,C)||this;return O.name="AssertionError",O}return Z}(Error);function rr(H,Z){if(!H)throw new wa(Z)}function Da(H,Z){var C=Z.quote,O=Z.hashtag;return rr(H,"facebook.url"),"https://www.facebook.com/sharer/sharer.php"+Dr({u:H,quote:C,hashtag:O})}var Ia=Ir("facebook",Da,function(H){return{quote:H.quote,hashtag:H.hashtag}},{windowWidth:550,windowHeight:400});const Oa=Ia;var Fa=wr({color:"#00aced",networkName:"twitter",path:"M48,22.1c-1.2,0.5-2.4,0.9-3.8,1c1.4-0.8,2.4-2.1,2.9-3.6c-1.3,0.8-2.7,1.3-4.2,1.6 C41.7,19.8,40,19,38.2,19c-3.6,0-6.6,2.9-6.6,6.6c0,0.5,0.1,1,0.2,1.5c-5.5-0.3-10.3-2.9-13.5-6.9c-0.6,1-0.9,2.1-0.9,3.3 c0,2.3,1.2,4.3,2.9,5.5c-1.1,0-2.1-0.3-3-0.8c0,0,0,0.1,0,0.1c0,3.2,2.3,5.8,5.3,6.4c-0.6,0.1-1.1,0.2-1.7,0.2c-0.4,0-0.8,0-1.2-0.1 c0.8,2.6,3.3,4.5,6.1,4.6c-2.2,1.8-5.1,2.8-8.2,2.8c-0.5,0-1.1,0-1.6-0.1c2.9,1.9,6.4,2.9,10.1,2.9c12.1,0,18.7-10,18.7-18.7 c0-0.3,0-0.6,0-0.8C46,24.5,47.1,23.4,48,22.1z"});const Ca=Fa;function ka(H,Z){var C=Z.title,O=Z.via,L=Z.hashtags,F=L===void 0?[]:L,G=Z.related,A=G===void 0?[]:G;return rr(H,"twitter.url"),rr(Array.isArray(F),"twitter.hashtags is not an array"),rr(Array.isArray(A),"twitter.related is not an array"),"https://twitter.com/share"+Dr({url:H,text:C,via:O,hashtags:F.length>0?F.join(","):void 0,related:A.length>0?A.join(","):void 0})}var Pa=Ir("twitter",ka,function(H){return{hashtags:H.hashtags,title:H.title,via:H.via,related:H.related}},{windowWidth:550,windowHeight:400});const Ma=Pa;var Na=wr({color:"#25D366",networkName:"whatsapp",path:"m42.32286,33.93287c-0.5178,-0.2589 -3.04726,-1.49644 -3.52105,-1.66732c-0.4712,-0.17346 -0.81554,-0.2589 -1.15987,0.2589c-0.34175,0.51004 -1.33075,1.66474 -1.63108,2.00648c-0.30032,0.33658 -0.60064,0.36247 -1.11327,0.12945c-0.5178,-0.2589 -2.17994,-0.80259 -4.14759,-2.56312c-1.53269,-1.37217 -2.56312,-3.05503 -2.86603,-3.57283c-0.30033,-0.5178 -0.03366,-0.80259 0.22524,-1.06149c0.23301,-0.23301 0.5178,-0.59547 0.7767,-0.90616c0.25372,-0.31068 0.33657,-0.5178 0.51262,-0.85437c0.17088,-0.36246 0.08544,-0.64725 -0.04402,-0.90615c-0.12945,-0.2589 -1.15987,-2.79613 -1.58964,-3.80584c-0.41424,-1.00971 -0.84142,-0.88027 -1.15987,-0.88027c-0.29773,-0.02588 -0.64208,-0.02588 -0.98382,-0.02588c-0.34693,0 -0.90616,0.12945 -1.37736,0.62136c-0.4712,0.5178 -1.80194,1.76053 -1.80194,4.27186c0,2.51134 1.84596,4.945 2.10227,5.30747c0.2589,0.33657 3.63497,5.51458 8.80262,7.74113c1.23237,0.5178 2.1903,0.82848 2.94111,1.08738c1.23237,0.38836 2.35599,0.33657 3.24402,0.20712c0.99159,-0.15534 3.04985,-1.24272 3.47963,-2.45956c0.44013,-1.21683 0.44013,-2.22654 0.31068,-2.45955c-0.12945,-0.23301 -0.46601,-0.36247 -0.98382,-0.59548m-9.40068,12.84407l-0.02589,0c-3.05503,0 -6.08417,-0.82849 -8.72495,-2.38189l-0.62136,-0.37023l-6.47252,1.68286l1.73463,-6.29129l-0.41424,-0.64725c-1.70875,-2.71846 -2.6149,-5.85116 -2.6149,-9.07706c0,-9.39809 7.68934,-17.06155 17.15993,-17.06155c4.58253,0 8.88029,1.78642 12.11655,5.02268c3.23625,3.21036 5.02267,7.50812 5.02267,12.06476c-0.0078,9.3981 -7.69712,17.06155 -17.14699,17.06155m14.58906,-31.58846c-3.93529,-3.80584 -9.1133,-5.95471 -14.62789,-5.95471c-11.36055,0 -20.60848,9.2065 -20.61625,20.52564c0,3.61684 0.94757,7.14565 2.75211,10.26282l-2.92557,10.63564l10.93337,-2.85309c3.0136,1.63108 6.4052,2.4958 9.85634,2.49839l0.01037,0c11.36574,0 20.61884,-9.2091 20.62403,-20.53082c0,-5.48093 -2.14111,-10.64081 -6.03239,-14.51915"});const Ua=Na;function Ba(){return/(android|iphone|ipad|mobile)/i.test(navigator.userAgent)}function Ga(H,Z){var C=Z.title,O=Z.separator;return rr(H,"whatsapp.url"),"https://"+(Ba()?"api":"web")+".whatsapp.com/send"+Dr({text:C?C+O+H:H})}var ja=Ir("whatsapp",Ga,function(H){return{title:H.title,separator:H.separator||" "}},{windowWidth:550,windowHeight:400});const Ka=ja;const qa=()=>{var qe,ht,Ye,Tt;const[H,Z]=At.useState(!1),[C,{open:O,close:L}]=ui(!1),[F,{open:G,close:A}]=ui(!1),q=sessionStorage.getItem("profileId"),[d]=di(ci),h=sessionStorage.getItem("contentId"),X=At.useRef(null),E=(d==null?void 0:d.role)==="user",S=h==null?void 0:h.toString(),I=(q==null?void 0:q.toString())||"0",_=Vn(E,S,I,O,G),k=Yn(E,S,O),{data:N,isLoading:U}=E?_:k,ee=N==null?void 0:N.data.data,{data:K,isLoading:V}=Xn(h==null?void 0:h.toString()),te=(qe=K==null?void 0:K.data)==null?void 0:qe.data.recommended_contents,ae=(Ye=(ht=N==null?void 0:N.data)==null?void 0:ht.data)==null?void 0:Ye.media,ie=ae==null?void 0:ae[0],oe=(Tt=N==null?void 0:N.data.data.sub_categories)==null?void 0:Tt[0],[ue,be]=At.useState(0),{mutate:Ce}=zn(),{mutate:ke}=qn(),[De,ut]=At.useState(0),{mutate:Fe}=$n();At.useEffect(()=>{setInterval(()=>{ut(ye=>ye+1)},5e3)},[]);const[Ge,Ke]=At.useState(0);At.useEffect(()=>{const ye=new AbortController;return(async()=>{var Bt,y,D,x,f;if(De>0&&ue>0&&!((Bt=X.current)!=null&&Bt.paused))try{(d==null?void 0:d.role)==="user"?(Ce({profile_id:Number(q),content_id:Number(h),status:"ongoing",pages_read:Math.ceil(ue),timespent:Math.ceil(ue)},{onSuccess(g){return Ke(Math.ceil(ue)),g},onError(g){Ot.show({title:"Notification",message:Xt(g)})}}),Fe({content_id:Number(h),profile_id:Number(q),timespent:Math.ceil(ue)-Ge,sub_category_id:(f=(x=(D=(y=N==null?void 0:N.data)==null?void 0:y.data)==null?void 0:D.sub_categories)==null?void 0:x[0])==null?void 0:f.sub_category_id})):ke({content_id:Number(h),status:"ongoing",pages_read:Math.ceil(ue),timespent:Math.ceil(ue)},{onSuccess(g){return Ke(Math.ceil(ue)),g},onError(g){Ot.show({title:"Notification",message:Xt(g)})}})}catch{}})(),()=>{ye.abort()}},[De]);function Pe(ye){return ye<10?"0"+ye:ye}const Me=new Date,je=Me.getHours(),me=Me.getMinutes(),Je=Me.getSeconds(),Ie=Pe(je)+":"+Pe(me)+":"+Pe(Je),vt=async()=>{na(`${(d==null?void 0:d.role)=="teacher"?"teacher":(d==null?void 0:d.role)=="user"?"parent":"school"}_lesson_completed`,{user_id:d==null?void 0:d.user_id,profile_id:sessionStorage.getItem("profileId")||0,lession_id:sessionStorage.getItem("coontentId"),lession_category:"African Languages",media_type:"vidoe",end_time:Ie});try{(d==null?void 0:d.role)==="user"?Ce({profile_id:Number(q),content_id:Number(h),status:"ongoing",pages_read:Math.ceil(ue),timespent:Math.ceil(ue)},{onSuccess(ye){return Ke(Math.ceil(ue)),ye},onError(ye){Ot.show({title:"Notification",message:Xt(ye)})}}):ke({content_id:Number(h),status:"ongoing",pages_read:Math.ceil(ue),timespent:Math.ceil(ue)},{onSuccess(ye){return Ke(Math.ceil(ue)),ye},onError(ye){Ot.show({title:"Notification",message:Xt(ye)})}})}catch{}},{data:dt,refetch:Ae}=Qn(q),Ve=dt==null?void 0:dt.data.data.records,{mutate:et}=Zn(),{mutate:nt}=Jn(),st=Ve==null?void 0:Ve.filter(ye=>ye.id===Number(h)),bt=()=>{(st==null?void 0:st.length)===0||st===void 0?et({content_id:Number(h),profile_id:Number(q)},{onSuccess(){Ae(),Ot.show({title:"Notification",message:(ie==null?void 0:ie.name)+" added to list"})},onError(ye){Ot.show({title:"Notification",message:Xt(ye)})}}):nt({content_id:Number(h),profile_id:Number(q)},{onSuccess(){Ae(),Ot.show({title:"Notification",message:(ie==null?void 0:ie.name)+" removed from the list"})},onError(ye){Ot.show({title:"Notification",message:Xt(ye)})}})};return se.jsxs(se.Fragment,{children:[se.jsx(fi,{radius:10,padding:30,size:"md",opened:C,onClose:L,overlayProps:{blur:10},closeOnClickOutside:!1,withCloseButton:!1,centered:!0,children:se.jsx(aa,{onCancel:L})}),se.jsx(fi,{radius:10,padding:30,size:"md",opened:F,onClose:A,overlayProps:{blur:10},closeOnClickOutside:!1,withCloseButton:!1,centered:!0,children:se.jsx(sa,{onCancel:A})}),se.jsx(ea,{bgColor:"#fff7fd",children:se.jsx(ta,{children:se.jsxs("div",{className:" min-h-[calc(92vh-60px)] h-[100%] flex flex-col  bg-[#fff7fd]",children:[se.jsx("div",{className:"",children:se.jsx(Ar,{visible:U,radius:"xl",children:se.jsx(la,{category:"Africanlanguages",lanType:oe==null?void 0:oe.sub_category_name,title:ie&&ie.name})})}),H?se.jsx(Wa,{}):se.jsxs(se.Fragment,{children:[se.jsxs("div",{className:"  flex-grow mt-5  gap-10 rounded-3xl flex w-[100%]",children:[se.jsx(Ar,{visible:U,children:se.jsxs("div",{className:"  basis-full  flex flex-col",children:[se.jsxs("div",{className:"basis",children:[se.jsxs("div",{className:"  rounded-t-3xl flex flex-col relative group",children:[se.jsx("button",{onClick:()=>Z(!1),className:"py-3  text-[#8530C1]    z-50 px-8 hidden gap-4 justify-center items-center rounded-3xl bg-white right-8  top-4 absolute",children:"Finish"}),(ie==null?void 0:ie.file)&&se.jsx(ga,{className:" rounded-t-3xl flex-grow",src:ie==null?void 0:ie.file,autoPlay:!0,controls:!0,playerRef:X,onEnded:()=>{vt()},onTimeUpdate:ye=>{be(+ye.currentTarget.currentTime)},width:"100%",height:"200px"})]}),se.jsxs("div",{className:" bg-white py-8  rounded-b-3xl px-24 flex justify-between  items-center",children:[se.jsx("p",{className:"text-[20px] font-bold ",children:ie==null?void 0:ie.name}),se.jsxs("p",{className:"flex gap-5 text-[#8530C1]",children:[se.jsxs("button",{onClick:bt,className:"py-3 px-7 flex gap-4 justify-center items-center rounded-3xl bg-[#FBECFF]",children:[se.jsx("img",{loading:"lazy",src:fa,alt:"icon",className:"w-[20px]"}),se.jsx("span",{children:"Save"})]}),se.jsxs(Yt,{shadow:"md",width:200,children:[se.jsx(Yt.Target,{children:se.jsxs("button",{className:"py-3 px-7 flex gap-4 justify-center items-center rounded-3xl bg-[#FBECFF]",children:[se.jsx("img",{loading:"lazy",src:da,alt:"icon",className:"w-[20px]"}),se.jsx("span",{children:"Share"})]})}),se.jsx(Yt.Dropdown,{children:se.jsxs("div",{className:"flex justify-center items-center",children:[se.jsx(Yt.Item,{children:se.jsx(Ma,{url:ie==null?void 0:ie.file,children:se.jsx(Ca,{size:30})})}),se.jsx(Yt.Item,{children:se.jsx(Oa,{url:ie==null?void 0:ie.file,children:se.jsx(Ra,{size:30})})}),se.jsx(Yt.Item,{children:se.jsx(Ka,{url:ie==null?void 0:ie.file,children:se.jsx(Ua,{size:30})})})]})})]})]})]}),se.jsx("div",{className:"mt-4 bg-white left-10 p-10 rounded-3xl leading-10",children:se.jsx("p",{dangerouslySetInnerHTML:{__html:`${ee==null?void 0:ee.web_synopsis}`}})})]}),se.jsx("div",{})]})}),se.jsxs("div",{className:"  basis-3/6 rounded-3xl bg-white px-10",children:[se.jsx("h1",{className:"text-[24px]  font-semibold font-Recoleta my-3 ",children:"Recommended Videos"}),se.jsx("div",{children:V?Array(6).fill(1).map((ye,He)=>se.jsx(Ar,{height:100,className:"mb-5",visible:V,children:ye},He)):K&&(te==null?void 0:te.slice(1,6).map((ye,He)=>se.jsx(Ha,{subCategory:oe==null?void 0:oe.sub_category_name,...ye},He)))})]})]}),se.jsx(oa,{})]})]})})})]})},Ha=({name:H,thumbnail:Z,slug:C,id:O,subCategory:L})=>{const F=Lr(),G=()=>{F(`../languages/${L}/${C}`),sessionStorage.setItem("contentId",O==null?void 0:O.toString())};return se.jsxs("div",{onClick:G,className:"flex h-[100px] gap-4 bg-[#fffbff]  items-center my-8  rounded-2xl border-[2px] border-[#fbeff8] cursor-pointer",children:[se.jsx(ra.LazyLoadImage,{src:Z,placeholderSrc:ia,effect:"blur",className:" rounded-xl",wrapperClassName:"",width:100,height:100}),se.jsx("span",{className:" text-black text-[16px]  font-Hanken font-semibold",children:H})]})},Wa=()=>{const H=Lr();return se.jsx("div",{className:" h-full flex-grow mt-4 flex justify-center bg-white rounded-3xl items-center",children:se.jsxs("div",{children:[se.jsx("p",{className:"flex justify-center items-center",children:se.jsx("img",{loading:"lazy",src:ua,alt:"congrats",className:"w-[200px]"})}),se.jsxs("div",{className:"text-center",children:[se.jsx("h1",{className:"text-[30px] font-Recoleta font-bold",children:"Well Done!"}),se.jsx("p",{className:"text-[#7E7E89] text-[18px]",children:"You have just finished watching Chisom’s Eco-friendly Visit."})]}),se.jsxs("p",{className:"flex flex-col gap-y-5 mt-16",children:[se.jsx("button",{onClick:()=>H("quiz"),className:"px-16 py-3 bg-[#8530C1] text-white rounded-2xl",children:"Take quiz"}),se.jsx("button",{className:"text-[18px]",children:"Later"})]})]})})};export{qa as default};
